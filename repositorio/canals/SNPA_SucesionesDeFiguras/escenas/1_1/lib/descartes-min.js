/*
 joel.espinosa@amite.mx
 @preserve 120816
 @license LGPL - http://www.gnu.org/licenses/lgpl.html
*/
var descartesJS=function(a){if(a.loadLib)return a;var e=2*Math.PI,d=360/e,c=e/360,b=Math.floor;a.rangeOK=1;a.radToDeg=function(a){return a*d};a.degToRad=function(a){return a*c};a.extend=function(a,b){if(a.prototype.__proto__)a.prototype.__proto__=b.prototype;else for(var d in b.prototype)b.prototype.hasOwnProperty(d)&&(a.prototype[d]=b.prototype[d]);a.prototype.uber=b.prototype};a.convertFont=function(a){var b=a.split(","),a="";"bold"==b[1].toLowerCase()?a+="Bold ":"italic"==b[1].toLowerCase()||"italics"==
b[1].toLowerCase()?a+="Italic ":"bold+italic"==b[1].toLowerCase()&&(a+="Italic Bold ");a+=b[2]+"px ";b=b[0].split(" ")[0].toLowerCase();return"serif"==b||"times new roman"==b||"timesroman"==b?a+"'Times New Roman'":"sansserif"==b||"arial"==b||"helvetica"==b?a+"Arial":a+"'Courier New'"};a.drawLine=function(a,d,c,e,j,k,l){a.lineWidth=l||1;a.strokeStyle=k||"black";k=a.lineWidth%2?0.5:0;a.beginPath();a.moveTo(b(d)+k,b(c)+k);a.lineTo(b(e)+k,b(j)+k);a.stroke()};a.getColor=function(a,d){if("string"==typeof d)return d;
var c=a.evalExpression(d),e=b(255*c[0][0]),j=b(255*c[0][1]),k=b(255*c[0][2]);return"rgba("+e+","+j+","+k+","+(1-c[0][3])+")"};a.getFeatures=function(){a.hasJavaSupport=navigator.javaEnabled();var b=navigator.appVersion.toLowerCase();a.hasTouchSupport=window.hasOwnProperty&&window.hasOwnProperty("ontouchstart")||b.match("android")&&!0;a.hasTouchSupport=navigator.userAgent.toLowerCase().match("qt")?!1:a.hasTouchSupport;b=document.createElement("canvas");a.hasCanvasSupport=b.getContext&&b.getContext("2d");
a.hasCanvasSupport&&(a.ctx=document.createElement("canvas").getContext("2d"))};a.openExternalFile=function(a){var b=null,d;d=!1;if(window.XMLHttpRequest)try{d=new XMLHttpRequest}catch(c){d=!1}else if(window.ActiveXObject)try{d=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{d=new ActiveXObject("Microsoft.XMLHTTP")}catch(k){d=!1}}d.open("GET",a,!1);try{d.send(null),b=d.responseText,b.match(String.fromCharCode(65533))&&(d.open("GET",a,!1),d.overrideMimeType("text/plain; charset=ISO-8859-1"),d.send(null),
b=d.responseText)}catch(l){console.log("El archivo ",a," no se pudo abrir"),b=null}return b};a.getCursorPosition=function(a){var b;a.touches?(a=a.touches[0],b=a.pageX,a=a.pageY):void 0!=a.pageX&&void 0!=a.pageY?(b=a.pageX,a=a.pageY):(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);return{x:b,y:a}};a.buildSimpleRegularExpressionPattern=function(a){var b=a.trim(),a={ignoreAcents:!1,ignoreCaps:!1,regExp:null};
b[0]==b[b.length-1]&&"'"==b[0]&&(a.ignoreCaps=!0,b=b.substring(1,b.length-1),"`"==b[0]&&"\u00b4"==b[b.length-1]&&(a.ignoreAcents=!0,b=b.substring(1,b.length-1)));"`"==b[0]&&"\u00b4"==b[b.length-1]&&(a.ignoreAcents=!0,b=b.substring(1,b.length-1),b[0]==b[b.length-1]&&"'"==b[0]&&(a.ignoreCaps=!0,b=b.substring(1,b.length-1)));"*"==b[0]&&"*"!=b[b.length-1]&&(b=b.substring(1)+"$");"*"!=b[0]&&"*"==b[b.length-1]&&(b="^"+b.substring(0,b.length-1));"*"==b[0]&&"*"==b[b.length-1]&&(b=b.substring(1,b.length-1));
b=b.replace(/\?/g,"[\\S\\s]{1}");a.regExp=b;return a};a.buildRegularExpresionsPatterns=function(b){for(var b=b.replace(/&squot;/g,"'").replace(/&amp;/g,"&").split("|"),d,c,e=0,j=b.length;e<j;e++){d=b[e].split("&");c=[];for(var k=0,l=d.length;k<l;k++)c.push(a.buildSimpleRegularExpressionPattern(d[k]));b[e]=c}return b};removeAcents=function(a){a=a.toString();return a.replace(/\u00e1/g,"a").replace(/\u00e9/g,"e").replace(/\u00ed/g,"i").replace(/\u00f3/g,"o").replace(/\u00fa/g,"u").replace(/\u00c1/g,
"A").replace(/\u00c9/g,"E").replace(/\u00cd/g,"I").replace(/\u00d3/g,"O").replace(/\u00da/g,"U").replace(/\u00f1/g,"n").replace(/\u00d1/g,"N")};a.escorrecto=function(b,d){for(var c=a.buildRegularExpresionsPatterns(b),e,j,d=removeAcents(d).toLowerCase(),k=0,l=c.length;k<l;k++){e=c[k];j=!0;for(var m=0,o=e.length;m<o;m++)e[m].regExp=removeAcents(e[m].regExp).toLowerCase(),j=j&&!!d.match(e[m].regExp);if(j)return 1}return 0};a.esCorrecto=function(b,d){for(var c=a.buildRegularExpresionsPatterns(b),e,j,
k=0,l=c.length;k<l;k++){e=c[k];j=!0;for(var m=0,o=e.length;m<o;m++)e[m].ignoreAcents&&(d=removeAcents(d),e[m].regExp=removeAcents(e[m].regExp)),e[m].ignoreCaps&&(d=d.toLowerCase(),e[m].regExp=e[m].regExp.toLowerCase()),j=j&&!!d.match(e[m].regExp);if(j)return 1}return 0};a.getTextWidth=function(b,d){a.ctx.font=d;return a.ctx.measureText(b).width};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.addCSSrules=function(){var a=document.createElement("meta");a.setAttribute("name",
"viewport");a.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes");document.head.appendChild(a);(a=document.getElementById("StyleDescartesApps2"))&&a.parentNode.removeChild(a);a=document.createElement("style");a.type="text/css";a.id="StyleDescartesApps2";a.setAttribute("rel","stylesheet");document.head.appendChild(a);a.innerHTML="div.DescartesAppContainer{ border: 0px solid black; position: relative; overflow: hidden; top: 0px; left: 0px; }\ndiv.DescartesLoader{ background-color : #efefef; position: absolute; overflow: hidden; -moz-box-shadow: 0px 0px 0px #888; -webkit-box-shadow: 0px 0px 100px #888; box-shadow: 0px 0px 100px #888; background-image: linear-gradient(bottom, rgb(187,187,187) 0%, rgb(239,239,239) 50%, rgb(187,187,187) 100%); background-image: -o-linear-gradient(bottom, rgb(187,187,187) 0%, rgb(239,239,239) 50%, rgb(187,187,187) 100%); background-image: -moz-linear-gradient(bottom, rgb(187,187,187) 0%, rgb(239,239,239) 50%, rgb(187,187,187) 100%); background-image: -webkit-linear-gradient(bottom, rgb(187,187,187) 0%, rgb(239,239,239) 50%, rgb(187,187,187) 100%); background-image: -ms-linear-gradient(bottom, rgb(187,187,187) 0%, rgb(239,239,239) 50%, rgb(187,187,                   187) 100%); top: 0px; left: 0px; }\ndiv.DescartesLoaderImage{ background-repeat: no-repeat; background-position: center; position: absolute; overflow: hidden; top: 0px; left: 0px; }\ncanvas.DescartesLoaderBar{ position: absolute; overflow: hidden; top: 0px; left: 0px; }\ncanvas.DescartesSpace2DCanvas, canvas.DescartesSpace3DCanvas, div.blocker{ position: absolute; overflow: hidden; left: 0px; top: 0px; }\ndiv.DescartesSpace2DContainer, div.DescartesSpace3DContainer{ position: absolute; overflow: hidden; line-height: 0px; }\ncanvas.DescartesButton{ position: absolute; cursor: pointer; }\ndiv.DescartesSpinnerContainer, div.DescartesTextFieldContainer{ background: lightgray; position: absolute; overflow: hidden; }\ninput.DescartesSpinnerField, input.DescartesTextFieldField, input.DescartesMenuField, input.DescartesScrollbarField{ font-family: Arial; padding: 0px; border: 1px inset #666666; position: absolute; top: 0px; }\nlabel.DescartesSpinnerLabel, label.DescartesMenuLabel, label.DescartesScrollbarLabel{ line-height: normal; font-family: Arial; padding-top: 0%; text-align: center; text-overflow: ellipsis; white-space: nowrap; overflow: hidden; background-color: lightgray; position: absolute; left: 0px; top: 0px; }\ndiv.DescartesGraphicControl{ border-style: none; position: absolute; }\nlabel.DescartesTextFieldLabel{ line-height: normal; font-family: Arial; padding-top: 0%; padding-bottom: 0%; text-align: center; text-overflow: ellipsis; white-space: nowrap; overflow: hidden; background-color: #e0e4e8; position: absolute; left: 0px; top: 0px; }\ndiv.DescartesTextAreaContainer{ position: absolute; overflow: hidden; background: #c0d0d8; }\nselect.DescartesMenuSelect{ font-family: Arial; padding-top: 0%; text-align: center; text-overflow: ellipsis; white-space: nowrap; overflow: hidden; background-color: white; position: absolute; left: 0px; top: 0px; }\ndiv.DescartesScrollbarContainer{ background: #eeeeee; overflow: hidden; position: absolute; }\n"};
a.addCSSrules();return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=Math.sin,d=Math.floor,c=Math.random,b=Math.round,g=String.fromCharCode;a.Krypto=function(a){this.key=(a||0).toString()};a.Krypto.prototype.getKey=function(a){for(var b=Array(256),c=0;256>c;c++)b[c]=g(this.alfanum(d(Math.abs(7.5*(e(1*c-a)+e(1.4*c+a)+e(0.6*c-a)+e(2.2*c+a))))));return b.join("")};a.Krypto.prototype.encode=function(a){var b=d(31*c());this.key=this.getKey(b);return g(this.alfanum(b))+this.encripta(a)};
a.Krypto.prototype.decode=function(a){this.key=this.getKey(this.numalfa(a.charCodeAt(0)));return this.desencripta(a.substring(1))};a.Krypto.prototype.encripta=function(a){return this.bytesToString(this.encriptaAux(this.stringToBytes(a)))};a.Krypto.prototype.encriptaAux=function(a){if(null==a||null==this.key)return null;for(var e=Array(3*a.length),g,j=0,k=a.length;j<k;j++)g=256*d(a[j]+128)+b(255*c())+65536*b(255*c()),g=d((g<<this.shift(j))/256),e[3*j]=this.alfanum(g%32),e[3*j+1]=this.alfanum(g/32%
32),e[3*j+2]=this.alfanum(g/1024%32);return e};a.Krypto.prototype.desencripta=function(a){return this.bytesToString(this.desencriptaAux(this.stringToBytes(a)))};a.Krypto.prototype.desencriptaAux=function(a){if(null==a||null==this.key)return null;for(var b=Array(a.length/3),c,e=0,g=b.length;e<g;e++)c=this.numalfa(a[3*e])+32*this.numalfa(a[3*e+1])+1024*this.numalfa(a[3*e+2]),c=d(256*c>>this.shift(e)),c=d(c/256)%256-128,0>c&&(c+=256),b[e]=c;return b};a.Krypto.prototype.alfanum=function(a){a=d(a);return 10>
a?48+a:87+a};a.Krypto.prototype.numalfa=function(a){return 58>a?a-48:a-87};a.Krypto.prototype.stringToBytes=function(a){for(var b=Array(a.length),d=0,c=a.length;d<c;d++)b[d]=a.charCodeAt(d);return b};a.Krypto.prototype.bytesToString=function(a){for(var b=0,d=a.length;b<d;b++)a[b]=g(a[b]);return a.join("")};a.Krypto.prototype.shift=function(a){a=this.numalfa(this.key.charCodeAt(a%this.key.length));a=d(a/2%8);0==a&&(a=4);return a};a.Krypto.prototype.parseByte=function(a){a=parseInt(a);a=0>a?0:a;return 255<
a?255:a};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Animation=function(e,d){this.parent=e;var c=e.evaluator,b=c.parser,g=new a.Auxiliary(e);this.delay=d.delay?b.parse(d.delay):b.parse("60");this.loop=d.loop?d.loop:!1;this.auto=void 0==d.auto&&2==this.parent.version?!0:d.auto;this.controls=d.controls;this.init=g.splitInstructions(b,d.init);this.doExpr=g.splitInstructions(b,d.doExpr);d.whileExpr&&(this.whileExpr=b.parse(d.whileExpr));var f=this;this.animationExec=function(){for(var a=
0,b=f.doExpr.length;a<b;a++)c.evalExpression(f.doExpr[a]);f.parent.update();if(f.playing&&(c.evalExpression(f.whileExpr)>0||f.loop))f.timer=setTimeout(f.animationExec,c.evalExpression(f.delay));else{f.stop();f.parent.update()}};this.playing=!1;this.auto&&this.play()};a.Animation.prototype.play=function(){this.playing?this.stop():(this.reinit(),this.playing=!0,this.timer=setTimeout(this.animationExec,this.parent.evaluator.evalExpression(this.delay)))};a.Animation.prototype.stop=function(){this.playing=
!1;clearInterval(this.timer)};a.Animation.prototype.reinit=function(){for(var a=0,d=this.init.length;a<d;a++)this.parent.evaluator.evalExpression(this.init[a])};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Action=function(a){this.parent=a;this.evaluator=this.parent.evaluator};a.Action.prototype.execute=function(){};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Message=function(e,d){a.Action.call(this,e,d);this.parameter=d};a.extend(a.Message,
a.Action);a.Message.prototype.execute=function(){alert(this.parameter)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Calculate=function(e,d){a.Action.call(this,e,d);var c=this.evaluator,b=c.parser;this.parameter=d.replace(/&squot;/g,"'");this.parameter=this.parameter.replace(/;/g,"\\n");this.parameter=this.parameter.split("\\n")||[""];for(var g=[],f,h=0,i=this.parameter.length;h<i;h++)(f=b.parse(this.parameter[h],!0))&&g.push(f);this.parameter=g;this.actionExec=function(){for(var a=
0,b=this.parameter.length;a<b;a++)c.evalExpression(this.parameter[a])}};a.extend(a.Calculate,a.Action);a.Calculate.prototype.execute=function(){this.actionExec()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.OpenURL=function(e,d){a.Action.call(this,e,d);this.parameter=d;this.target="_blank";var c=this.parameter.indexOf("target");-1!=c&&(this.target=this.parameter.substring(c),this.target=this.target.substring(this.target.indexOf("=")+1),this.parameter=this.parameter.substring(0,
c-1));"javascript"==this.parameter.substring(0,10)?(this.javascript=!0,this.parameter=this.parameter.substring(11).replace(/&squot;/g,"'"),this.actionExec=function(){eval(this.parameter)}):("http://"!=this.parameter.substring(0,7)&&(this.parameter=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+this.parameter),this.actionExec=function(){window.open(this.parameter,this.target)})};a.extend(a.OpenURL,a.Action);a.OpenURL.prototype.execute=function(){this.actionExec()};return a}(descartesJS||
{}),descartesJS=function(a){if(a.loadLib)return a;a.OpenScene=function(e,d){a.Action.call(this,e,d);this.parameter=d;this.target="_blank";var c=this.parameter.indexOf("target");-1!=c&&(this.target=this.parameter.substring(c),this.target=this.target.substring(this.target.indexOf("=")+1),this.parameter=this.parameter.substring(0,c-1));"javascript"==this.parameter.substring(0,10)?(this.javascript=!0,this.parameter=this.parameter.substring(11).replace(/&squot;/g,"'"),this.actionExec=function(){eval(this.parameter)}):
("http://"!=this.parameter.substring(0,7)&&(this.parameter=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+this.parameter),this.actionExec=function(){window.open(this.parameter,this.target)})};a.extend(a.OpenScene,a.Action);a.OpenScene.prototype.execute=function(){this.actionExec()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.About=function(e,d){a.Action.call(this,e,d);this.urlAbout=null;""!=d&&(this.urlAbout=window.location.href.substring(0,
window.location.href.lastIndexOf("/")+1)+d)};a.extend(a.About,a.Action);a.About.prototype.execute=function(){console.log(this.urlAbout);if(this.urlAbout)var a=window.open(this.urlAbout,"_blank","width=800px,height=600px,location=no,menubar=no,scrollbars=yes");else a=window.open("about:blank","_blank","width=800px,height=600px,location=no,menubar=no,scrollbars=yes"),a.document.write("<hmtl><head><title>Cr\u00e9ditos</title></head><body><h1>Aqu\u00ed van los cr\u00e9ditos</h1></body></html>")};return a}(descartesJS||
{}),descartesJS=function(a){if(a.loadLib)return a;a.Config=function(e,d){a.Action.call(this,e,d)};a.extend(a.Config,a.Action);a.Config.prototype.execute=function(){window.open("about:blank","_blank","width=800px,height=600px,location=no,menubar=no,scrollbars=yes").document.write("<xmp style='width:100%; height:100%;'>"+this.parent.applet.outerHTML+"</xmp>")};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Init=function(e,d){a.Action.call(this,e,d)};a.extend(a.Init,a.Action);
a.Init.prototype.execute=function(){this.parent.init()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Clear=function(e,d){a.Action.call(this,e,d)};a.extend(a.Clear,a.Action);a.Clear.prototype.execute=function(){this.parent.clear()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Animate=function(e,d){a.Action.call(this,e,d)};a.extend(a.Animate,a.Action);a.Animate.prototype.execute=function(){this.parent.play()};return a}(descartesJS||{}),descartesJS=
function(a){if(a.loadLib)return a;a.InitAnimation=function(e,d){a.Action.call(this,e,d)};a.extend(a.InitAnimation,a.Action);a.InitAnimation.prototype.execute=function(){this.parent.reinitAnimation()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.PlayAudio=function(e,d){a.Action.call(this,e,d);this.filenameExpr=this.evaluator.parser.parse("'"+d.split(" ")[0].trim()+"'");this.filename=this.evaluator.evalExpression(this.filenameExpr);this.theAudio=this.parent.getAudio(this.filename)};
a.extend(a.PlayAudio,a.Action);a.PlayAudio.prototype.execute=function(){this.filename=this.evaluator.evalExpression(this.filenameExpr);theAudio=this.parent.getAudio(this.filename);theAudio.paused?theAudio.play():(theAudio.pause(),theAudio.currentTime=0.1)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Auxiliary=function(a,d){this.parent=a;this.evaluator=this.parent.evaluator;var c=a.evaluator.parser;this.expresion=this.id="";this.evaluate="onlyOnce";this.size=c.parse("3");
this.rows=c.parse("3");this.columns=c.parse("3");for(var b in d)d.hasOwnProperty(b)&&(this[b]=d[b])};a.Auxiliary.prototype.firstRun=function(){};a.Auxiliary.prototype.update=function(){};a.Auxiliary.prototype.splitInstructions=function(a,d){for(var c,b=[],d=d?d.split(";"):[""],g=0,f=d.length;g<f;g++)(c=a.parse(d[g],!0))&&b.push(c);return b};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Variable=function(e,d){a.Auxiliary.call(this,e,d);var c=this.evaluator.parser;this.expresionString=
this.expresion;(this.expresion=c.parse(this.expresionString))&&c.setVariable(this.id,this.expresion);this.editable&&this.registerTextField()};a.extend(a.Variable,a.Auxiliary);a.Variable.prototype.registerTextField=function(){var a=document.createElement("div"),d=document.createElement("label");d.appendChild(document.createTextNode("_"+this.id+"=_"));var c=document.createElement("input");c.value=this.expresionString;c.disabled=!this.editable;a.appendChild(d);a.appendChild(c);var b=this;c.onkeydown=
function(a){13==a.keyCode&&(b.expresion=b.evaluator.parser.parse(this.value),b.evaluator.parser.setVariable(b.id,b.expresion),b.parent.update())};this.parent.editableRegion.textFields.push({container:a,type:"div"})};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Constant=function(e,d){a.Auxiliary.call(this,e,d);this.expresion=this.evaluator.parser.parse(this.expresion);this.update()};a.extend(a.Constant,a.Auxiliary);a.Constant.prototype.update=function(){this.evaluator.setVariable(this.id,
this.evaluator.evalExpression(this.expresion))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Vector=function(e,d){a.Auxiliary.call(this,e,d);var c=this.evaluator,b=c.parser;this.expresion=this.expresion.split(";");var g;if(this.file){var f=document.getElementById(this.file);f&&"descartes/vectorFile"==f.type?(g=f.text,"\n"==g[0]&&(g=g.substring(1))):g=a.openExternalFile(this.file);null!=g&&(g=g.split("\n"));null==g||1==g.length&&""==g[0]?(g=[],this.size=0):(this.expresion=
[],this.size=null);for(var h,i=0,f=0,j=g.length;f<j;f++)g[f].match(/./)&&(this.expresion[i]=this.id+"["+i+"]="+g[f],i++,(h=g[f].match(/[\w-//]*(.png|.jpg|.gif|.svg|.PNG|.JPG|.GIF|.SVG)/g))&&this.parent.getImage(h));null==this.size&&(this.size=b.parse(this.expresion.length+""))}f=0;for(j=this.expresion.length;f<j;f++)(g=b.parse(this.expresion[f],!0))&&"asign"!=g.type&&(g=b.parse(this.id+"["+f+"]="+this.expresion[f],!0)),this.expresion[f]=g;j=c.evalExpression(this.size);b=[];for(f=0;f<j;f++)b.push(0);
c.vectors[this.id]=b;this.update()};a.extend(a.Vector,a.Auxiliary);a.Vector.prototype.update=function(){var a=this.evaluator;a.setVariable(this.id+".long",a.evalExpression(this.size));for(var d=0,c=this.expresion.length;d<c;d++)a.evalExpression(this.expresion[d])};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Matrix=function(e,d){a.Auxiliary.call(this,e,d);var c=this.evaluator;this.expresion=this.splitInstructions(c.parser,this.expresion);for(var b=c.evalExpression(this.rows),
g=[],f,h=0,i=c.evalExpression(this.columns);h<i;h++){f=[];for(var j=0,k=b;j<k;j++)f.push(0);g[h]=f}c.matrices[this.id]=g;this.update()};a.extend(a.Matrix,a.Auxiliary);a.Matrix.prototype.update=function(){var a=this.evaluator;a.setVariable(this.id+".filas",a.evalExpression(this.rows));a.setVariable(this.id+".columnas",a.evalExpression(this.columns));for(var d=0,c=this.expresion.length;d<c;d++)a.evalExpression(this.expresion[d])};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;
a.Function=function(e,d){a.Auxiliary.call(this,e,d);var c=this.evaluator,b=c.parser,g=this.id.indexOf("(");this.name=this.id.substring(0,g);this.params=this.id.substring(g+1,this.id.length-1);this.domain=this.range?b.parse(this.range):b.parse("1");this.params=""==this.params?[]:this.params.split(",");this.numberOfParams=this.params.length;this.init=this.splitInstructions(b,this.init);this.doExpr=this.splitInstructions(b,this.doExpr);this.whileExpr&&(this.whileExpr=b.parse(this.whileExpr));this.expresion=
b.parse(this.expresion);var f=this;this.functionExec=this.algorithm?function(){if(f.numberOfParams==arguments.length){for(var b=[],d=0,e=f.params.length;d<e;d++){b[d]=c.getVariable(f.params[d]);c.setVariable(f.params[d],arguments[d])}d=0;for(e=f.init.length;d<e;d++)c.evalExpression(f.init[d]);do{d=0;for(e=f.doExpr.length;d<e;d++)c.evalExpression(f.doExpr[d])}while(c.evalExpression(f.whileExpr)>0);var g=c.evalExpression(f.expresion);a.rangeOK=c.evalExpression(f.domain);d=0;for(e=f.params.length;d<
e;d++)c.setVariable(f.params[d],b[d]);return g}return 0}:function(){if(f.numberOfParams==arguments.length){for(var b=[],d=0,e=f.params.length;d<e;d++){b[d]=c.getVariable(f.params[d]);c.setVariable(f.params[d],arguments[d])}var g=c.evalExpression(f.expresion);a.rangeOK=c.evalExpression(f.domain);d=0;for(e=f.params.length;d<e;d++)c.setVariable(f.params[d],b[d]);return g}return 0};c.setFunction(this.name,this.functionExec)};a.extend(a.Function,a.Auxiliary);return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;
a.AuxSequence=function(e,d){a.Auxiliary.call(this,e,d);var c=this.evaluator,b=c.parser,g=this.id.indexOf("(");this.name=this.id.substring(0,g);this.params=this.id.substring(g+1,this.id.length-1);this.domain=this.range?b.parse(this.range):b.parse("1");this.params=""==this.params?[]:this.params.split(",");this.numberOfParams=this.params.length;this.init=this.splitInstructions(b,this.init);this.doExpr=this.splitInstructions(b,this.doExpr);this.whileExpr&&(this.whileExpr=b.parse(this.whileExpr));this.expresion=
b.parse(this.expresion);var f=this;this.functionExec=this.algorithm?function(){if(f.numberOfParams==arguments.length){for(var b=[],d=0,e=f.params.length;d<e;d++){b[d]=c.getVariable(f.params[d]);c.setVariable(f.params[d],arguments[d])}d=0;for(e=f.init.length;d<e;d++)c.evalExpression(f.init[d]);do{d=0;for(e=f.doExpr.length;d<e;d++)c.evalExpression(f.doExpr[d])}while(c.evalExpression(f.whileExpr)>0);var g=c.evalExpression(f.expresion);a.rangeOK=c.evalExpression(f.domain);d=0;for(e=f.params.length;d<
e;d++)c.setVariable(f.params[d],b[d]);return g}return 0}:function(){if(f.numberOfParams==arguments.length){for(var b=[],d=0,e=f.params.length;d<e;d++){b[d]=c.getVariable(f.params[d]);c.setVariable(f.params[d],arguments[d])}var g=c.evalExpression(f.expresion);a.rangeOK=c.evalExpression(f.domain);d=0;for(e=f.params.length;d<e;d++)c.setVariable(f.params[d],b[d]);return g}return 0};c.setFunction(this.name,this.functionExec)};a.extend(a.AuxSequence,a.Auxiliary);return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;
a.Algorithm=function(e,d){a.Auxiliary.call(this,e,d);var c=this.evaluator,b=c.parser;this.init=this.splitInstructions(b,this.init);this.doExpr=this.splitInstructions(b,this.doExpr);this.whileExpr&&(this.whileExpr=b.parse(this.whileExpr));this.algorithmExec=function(){for(var a=0,b=this.init.length;a<b;a++)c.evalExpression(this.init[a]);do{a=0;for(b=this.doExpr.length;a<b;a++)c.evalExpression(this.doExpr[a])}while(c.evalExpression(this.whileExpr)>0)}};a.extend(a.Algorithm,a.Auxiliary);a.Algorithm.prototype.update=
function(){this.algorithmExec();"onlyOnce"==this.evaluate&&(this.update=function(){})};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Event=function(e,d){a.Auxiliary.call(this,e,d);var c=this.evaluator;this.condition=c.parser.parse(this.condition);this.lastEvaluation=!1;this.action=this.parent.lessonParser.parseAction(this);"onlyOnce"==this.execution&&(this.eventExec=function(){0<c.evalExpression(this.condition)&&!this.lastEvaluation&&(this.lastEvaluation=!0,this.action.execute())});
"alternate"==this.execution&&(this.eventExec=function(){var a=c.evalExpression(this.condition)>0;if(this.parent.version==3){if(a!=this.lastEvaluation){this.action.execute();this.lastEvaluation=a?true:false}}else if(a&&!this.lastEvaluation){this.action.execute();this.lastEvaluation=true}else if(!a&&this.lastEvaluation)this.lastEvaluation=false});"always"==this.execution&&(this.eventExec=function(){c.evalExpression(this.condition)>0&&this.action.execute()})};a.extend(a.Event,a.Auxiliary);a.Event.prototype.update=
function(){this.eventExec()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Graphic=function(e,d){this.parent=e;var c=this.parent.evaluator.parser;this.evaluator=e.evaluator;this.spaceID="E0";this.type="";this.background=!1;2!=this.parent.version?(this.color="#20303a",this.parent.arquimedes&&(this.color="black")):this.color="blue";this.drawif=c.parse("1");this.abs_coord=!1;this.family=this.trace="";this.family_interval=c.parse("[0,1]");this.family_steps=c.parse("8");this.parameter=
"t";this.parameter_interval=c.parse("[0,1]");this.parameter_steps=c.parse("8");this.fillM=this.fillP=this.fill="";this.width=-1;this.editable=!1;this.info="";this.font="Monospaced,PLAIN,12";this.fixed=!0;this.size=c.parse("2");this.text="";this.decimals=c.parse("2");this.spear=c.parse("8");this.arrow="#ee0022";this.center=c.parse("(0,0)");this.radius=c.parse("1");this.init=c.parse("0");this.end=c.parse("90");this.file="";this.inirot=c.parse("0");for(var b in d)d.hasOwnProperty(b)&&(this[b]=d[b]);
void 0==this.expresion&&"macro"!=this.type&&(this.expresion=c.parse("(0,0)"));this.space=this.getSpace();this.canvas=this.background?this.space.backgroundCanvas:this.space.canvas;this.ctx=this.canvas.getContext("2d");this.trace&&(this.traceCtx=this.space.backgroundCanvas.getContext("2d"));this.font=a.convertFont(this.font)};a.Graphic.prototype.getSpace=function(){for(var a=this.parent.spaces,d,c=0,b=a.length;c<b;c++)if(d=a[c],d.id==this.spaceID)return d;return a[0]};a.Graphic.prototype.getFamilyValues=
function(){var a=this.evaluator,d=a.evalExpression(this.family_interval);this.familyInf=d[0][0];this.familySup=d[0][1];this.fSteps=Math.round(a.evalExpression(this.family_steps));this.family_sep=0<this.fSteps?(this.familySup-this.familyInf)/this.fSteps:0};a.Graphic.prototype.drawFamilyAux=function(a,d,c){var b=this.evaluator;this.getFamilyValues();var g=b.getVariable(this.family);if(0<=this.fSteps)for(var f=0,h=this.fSteps;f<=h;f++)b.setVariable(this.family,this.familyInf+f*this.family_sep),0<b.evalExpression(this.drawif)&&
(this.update(),this.drawAux(a,d,c));b.setVariable("_Text_H_",0);b.setVariable(this.family,g)};a.Graphic.prototype.draw=function(a,d){""!=this.family?this.drawFamilyAux(this.ctx,a,d):0<this.evaluator.evalExpression(this.drawif)&&(this.update(),this.drawAux(this.ctx,a,d))};a.Graphic.prototype.drawTrace=function(a,d){""!=this.family?this.drawFamilyAux(this.traceCtx,a,d):0<this.evaluator.evalExpression(this.drawif)&&(this.update(),this.drawAux(this.traceCtx,a,d))};a.Graphic.prototype.drawText=function(e,
d,c,b,g,f,h,i,j,k){if("rtfNode"==d.type)e.fillStyle=g,e.strokeStyle=g,e.textBaseline="alphabetic",d.draw(e,c,b,j,k,h);else{var c=c+(f.match("Arial")?-2:f.match("Times")?-2:0),l=this.evaluator;e.fillStyle=a.getColor(l,g);e.font=f;e.textAlign=h;e.textBaseline=i;this.fontSize=(this.fontSize=f.match(/(\d+)px/))?this.fontSize[1]:"10";this.border&&(e.strokeStyle=a.getColor(l,this.border),e.lineWidth=parseFloat(this.fontSize)/12);f=1.2*this.fontSize;if(d[0]&&d[0].type){h=0;for(i=d.length;h<i;h++)g=l.evalExpression(d[h],
j,k),this.border&&e.strokeText(g,c,b+f*h),e.fillText(g,c,b+f*h)}else{h=0;for(i=d.length;h<i;h++)g=d[h],this.border&&e.strokeText(g,c,b+f*h),e.fillText(g,c,b+f*h)}}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=Math.floor,d=2*Math.PI;a.Equation=function(d,b){a.Graphic.call(this,d,b);this.width=-1==this.width?this.evaluator.parser.parse("1"):this.width;this.generateStroke();this.parseExpresion();(this.visible=2==this.parent.version&&void 0==this.visible?!0:!1)&&this.registerTextField()};
a.extend(a.Equation,a.Graphic);a.Equation.prototype.parseExpresion=function(){if("compOperator"==this.expresion.type){var d=this.expresion.childs[0],b=this.expresion.childs[1];"identifier"==d.type&&"y"==d.value&&!b.contains("y")?(this.funExpr=b,this.drawAux=this.drawAuxFunY):"identifier"==b.type&&"y"==b.value&&!d.contains("y")?(this.funExpr=d,this.drawAux=this.drawAuxFunY):"identifier"==d.type&&"x"==d.value&&!b.contains("x")?(this.funExpr=b,this.drawAux=this.drawAuxFunX):"identifier"==b.type&&"x"==
b.value&&!d.contains("x")&&(this.funExpr=b,this.drawAux=this.drawAuxFunX)}this.newt=new a.R2Newton(this.evaluator,this.expresion)};a.Equation.prototype.generateStroke=function(){this.auxCanvas=document.createElement("canvas");var a=parseInt(this.evaluator.evalExpression(this.width));this.width_2=parseInt(a/2)||1;this.auxCanvas.setAttribute("width",a);this.auxCanvas.setAttribute("height",a);this.auxCtx=this.auxCanvas.getContext("2d");this.auxCtx.beginPath();this.auxCtx.arc(this.width_2,this.width_2,
this.width_2,0,2*Math.PI,!1);this.auxCtx.fill()};a.Equation.prototype.update=function(){};a.Equation.prototype.draw=function(){""!=this.family?this.drawFamilyAux(this.ctx,this.fill,this.color):(this.update(),this.drawAux(this.ctx,this.fill,this.color))};a.Equation.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.fill,this.trace)};a.Equation.prototype.drawAux=function(d,b,g){d.lineWidth=1;var b=this.evaluator,f=b.parser,h=this.space;a.getColor(b,this.color);d.fillStyle=g;g=b.evalExpression(this.width);
e(g);f.getVariable("x");f.getVariable("y");var g=h.w,f=h.h,i=e(g/8);3>i&&(i=3);var j=e(f/8);3>j&&(j=3);for(var k=[],l=new a.R2,m=new a.R2,o=new a.R2,q,p,r,n,t,v,u,s,y,x=e(j/2);x<f;x+=j)for(var z=e(i/2);z<g;z+=i)if(this.abs_coord?(p=this.newt.findZero(new a.R2(z,x)),b.setVariable("x",p.x),b.setVariable("y",p.y),q=new a.R2(p.x,p.y)):(p=this.newt.findZero(new a.R2(h.getRelativeX(z),h.getRelativeY(x))),b.setVariable("x",p.x),b.setVariable("y",p.y),q=new a.R2(h.getAbsoluteX(p.x),h.getAbsoluteY(p.y))),
r=e(q.ix()),n=e(q.iy()),!(0>r||r>=g||0>n||n>=f||k[r+n*h.w]))if(k[r+n*h.w]=!0,l.x=p.x,l.y=p.y,m.x=p.x,m.y=p.y,t=this.newt.getUnitNormal(),!(0==t.x&&0==t.y)){t.rotL90();o.x=t.x;o.y=t.y;u=v=0;for(s=!1;2>u;){s&&(o.x=-t.x,o.y=-t.y,p.x=l.x,p.y=l.y,m.x=p.x,m.y=p.y,q=this.abs_coord?new a.R2(p.x,p.y):new a.R2(h.getAbsoluteX(p.x),h.getAbsoluteY(p.y)),r=q.ix(),n=q.iy(),s=!1,v=0);this.abs_coord?(p.x+=o.x,p.y+=o.y):(p.x+=o.x/h.scale,p.y+=o.y/h.scale);p=this.newt.findZero(p);b.setVariable("x",p.x);b.setVariable("y",
p.y);o.x=p.x-m.x;o.y=p.y-m.y;o.normalize();if(0==o.x&&0==o.y)break;m.x=p.x;m.y=p.y;q=this.abs_coord?new a.R2(p.x,p.y):new a.R2(h.getAbsoluteX(p.x),h.getAbsoluteY(p.y));y=e(q.ix());q=e(q.iy());if(y!=r||q!=n)if(r=y,n=q,0<=r&&r<g&&0<=n&&n<f)if(v=0,k[r+n*h.w])break;else k[r+n*h.w]=!0,a.rangeOK&&d.drawImage(this.auxCanvas,r-this.width_2,n-this.width_2);else s=!0,u++;else 4<++v&&(s=!0,u++)}}};a.Equation.prototype.drawAuxFunY=function(d){var b=this.evaluator,e=this.space,f=e.w,h=1/e.scale,i=e.getAbsoluteY(0),
j=b.evalExpression(this.width),k=a.getColor(b,this.color),l=a.getColor(b,this.fillM),m=a.getColor(b,this.fillP);d.fillStyle=k;var o=e.getRelativeX(0),q,p,r,n;b.setVariable("x",o);for(var t=e.getAbsoluteX(o),v=e.getAbsoluteY(b.evalExpression(this.funExpr)),u=0,s,y,x=1;x<f;x++){q=o+x*h;b.setVariable("x",q);p=b.evalExpression(this.funExpr);b.setVariable("y",p);r=e.getAbsoluteX(q);n=e.getAbsoluteY(p);s=Math.min(u,p);y=Math.max(u,p);s={min:s,max:y};if(void 0!==p&&a.rangeOK&&b.evalExpression(this.drawif)&&
!this.hasSingularity(h,q,"x",q-h,u,q,p,s)){if(this.fillM||this.fillP)d.lineWidth=1,d.strokeStyle=n>i?l:m,d.beginPath(),d.moveTo(r+0.5,n),d.lineTo(r+0.5,i),d.stroke();d.lineWidth=j;d.strokeStyle=k;d.beginPath();d.moveTo(t,v);d.lineTo(r,n);d.stroke()}u=p||0;t=r;v=n}};a.Equation.prototype.drawAuxFunX=function(d){var b=this.evaluator,e=this.space,f=e.w,h=1/e.scale,i=e.getAbsoluteX(0),j=b.evalExpression(this.width),k=a.getColor(b,this.color),l=a.getColor(b,this.fillM),m=a.getColor(b,this.fillP);d.fillStyle=
k;var o=e.getRelativeX(0),q,p,r,n;b.setVariable("x",o);for(var t=e.getAbsoluteX(b.evalExpression(this.funExpr)),v=e.getAbsoluteY(o),u=0,s,y,x=1;x<f;x++)if(q=o+x*h,b.setVariable("y",q),p=b.evalExpression(this.funExpr),b.setVariable("x",p),r=e.getAbsoluteX(p),n=e.getAbsoluteY(q),s=Math.min(u,p),y=Math.max(u,p),s={min:s,max:y},void 0!==q&&a.rangeOK&&b.evalExpression(this.drawif)){if(!this.hasSingularity(h,q,"y",q-h,u,q,p,s)){if(this.fillM||this.fillP)d.lineWidth=1,d.strokeStyle=r>i?l:m,d.beginPath(),
d.moveTo(r,n+0.5),d.lineTo(i,n+0.5),d.stroke();d.lineWidth=j;d.strokeStyle=k;d.beginPath();d.moveTo(t,v);d.lineTo(r,n);d.stroke()}u=p||0;t=r;v=n}};a.Equation.prototype.hasSingularity=function(a,b,d,f,e,i,j,k){if(1.0E-12>Math.abs(i-f)||1.0E-8>Math.abs(i-f)&&Math.abs(j-e)>Math.abs(a))return!0;var l=!1,l=(f+i)/2;this.evaluator.setVariable(d,l);var m=this.evaluator.evalExpression(this.funExpr);k.min<=m&&m<=k.max?l=!1:(k.x=Math.min(k.min,m),k.y=Math.max(k.max,m),l=this.hasSingularity(a,b,d,f,e,l,m,k)||
this.hasSingularity(a,b,d,l,m,i,j,k));this.evaluator.setVariable(d,b);return l};a.drawPixel=function(a,b,e,f){a.moveTo(b,e);a.arc(b,e,f,0,d,!1)};a.Equation.prototype.registerTextField=function(){var a=document.createElement("input");a.value=this.expresionString;a.disabled=!this.editable;var b=this;a.onkeydown=function(a){13==a.keyCode&&(b.expresion=b.evaluator.parser.parse(this.value),b.parseExpresion(),b.parent.update())};this.parent.editableRegion.textFields.push(a)};return a}(descartesJS||{}),
descartesJS=function(a){if(a.loadLib)return a;a.Curve=function(e,d){a.Graphic.call(this,e,d);this.width=-1==this.width?this.evaluator.parser.parse("1"):this.width;(this.visible=2==this.parent.version&&void 0==this.visible?!0:!1)&&this.registerTextField()};a.extend(a.Curve,a.Graphic);a.Curve.prototype.update=function(){var a=this.evaluator,d=a.evalExpression(this.parameter_interval);this.paraInf=d[0][0];this.paraSup=d[0][1];this.pSteps=a.evalExpression(this.parameter_steps);this.paraSep=0<this.pSteps?
Math.abs(this.paraSup-this.paraInf)/this.pSteps:0};a.Curve.prototype.draw=function(){this.uber.draw.call(this,this.fill,this.color)};a.Curve.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.fill,this.trace)};a.Curve.prototype.drawAux=function(e,d,c){var b=this.evaluator,g=this.space,f=this.evaluator.evalExpression(this.width);0>=f&&(f=1.0E-6);e.lineWidth=f;e.lineCap="round";e.lineJoin="round";e.fillStyle=a.getColor(b,d);e.strokeStyle=a.getColor(b,c);d=b.getVariable(this.parameter);
e.beginPath();b.setVariable(this.parameter,this.paraInf);f=b.evalExpression(this.expresion);this.exprX=this.abs_coord?f[0][0]:g.getAbsoluteX(f[0][0]);this.exprY=this.abs_coord?f[0][1]:g.getAbsoluteY(f[0][1]);var h,i,j;this.rotateExp&&(h=a.degToRad(this.evaluator.evalExpression(this.rotateExp)),i=Math.cos(h),h=Math.sin(h),f=this.exprX*i-this.exprY*h,j=this.exprX*h+this.exprY*i,this.exprX=f,this.exprY=j);e.moveTo(this.exprX+0.5,this.exprY+0.5);for(c=1;c<=this.pSteps;c++)b.setVariable(this.parameter,
this.paraInf+c*this.paraSep),f=b.evalExpression(this.expresion),this.exprX=this.abs_coord?f[0][0]:g.getAbsoluteX(f[0][0]),this.exprY=this.abs_coord?f[0][1]:g.getAbsoluteY(f[0][1]),this.rotateExp&&(f=this.exprX*i-this.exprY*h,j=this.exprX*h+this.exprY*i,this.exprX=f,this.exprY=j),e.lineTo(this.exprX+0.5,this.exprY+0.5);this.fill&&e.fill();e.stroke();b.setVariable(this.parameter,d)};a.Curve.prototype.registerTextField=function(){var a=document.createElement("input");a.value=this.expresionString;a.disabled=
!this.editable;var d=this;a.onkeydown=function(a){13==a.keyCode&&(d.expresion=d.evaluator.parser.parse(this.value),d.parent.update())};this.parent.editableRegion.textFields.push(a)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=2*Math.PI;a.Sequence=function(d,c){a.Graphic.call(this,d,c)};a.extend(a.Sequence,a.Graphic);a.Sequence.prototype.update=function(){var d=this.evaluator,c=d.evalExpression(this.expresion);this.exprX=c[0][0];this.exprY=c[0][1];if(this.rotateExp){var b=
a.degToRad(d.evalExpression(this.rotateExp)),c=Math.cos(b),e=Math.sin(b),b=this.exprX*c-this.exprY*e,c=this.exprX*e+this.exprY*c;this.exprX=b;this.exprY=c}d=d.evalExpression(this.range);this.rangeInf=d[0][0];this.rangeMax=d[0][1]};a.Sequence.prototype.draw=function(){this.uber.draw.call(this,this.color,this.color)};a.Sequence.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Sequence.prototype.drawAux=function(d,c){var b=this.evaluator,g,f,h,i=Math.ceil(b.evalExpression(this.size)-
0.4);d.fillStyle=a.getColor(b,c);d.beginPath();this.rangeInf>this.rangeMax&&(h=this.rangeInf,this.rangeInf=this.rangeMax,this.rangeMax=h);for(var j=b.getVariable("n"),k=this.rangeInf,l=this.rangeMax;k<=l;k++)b.setVariable("n",k),h=b.evalExpression(this.expresion),this.exprX=h[0][0],this.exprY=h[0][1],this.abs_coord?g=h[0][1]:(g=this.space.getAbsoluteX(h[0][0]),f=this.space.getAbsoluteY(h[0][1])),d.moveTo(g,f),d.arc(g,f,i,0,e,!0);b.setVariable("n",j);d.fill();this.text!=[""]&&this.uber.drawText.call(this,
d,this.text,g+i,f-i,this.color,this.font,"start","alphabetic",b.evalExpression(this.decimals),this.fixed)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=2*Math.PI;a.Point=function(d,c){a.Graphic.call(this,d,c)};a.extend(a.Point,a.Graphic);a.Point.prototype.update=function(){var d=this.evaluator,c=d.evalExpression(this.expresion);this.exprX=c[0][0];this.exprY=c[0][1];if(this.rotateExp){var c=a.degToRad(d.evalExpression(this.rotateExp)),d=Math.cos(c),b=Math.sin(c),c=
this.exprX*d-this.exprY*b,d=this.exprX*b+this.exprY*d;this.exprX=c;this.exprY=d}};a.Point.prototype.draw=function(){this.uber.draw.call(this,this.color,this.color)};a.Point.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Point.prototype.drawAux=function(d,c){var b=this.evaluator,g=this.abs_coord?this.exprX:this.space.getAbsoluteX(this.exprX),f=this.abs_coord?this.exprY:this.space.getAbsoluteY(this.exprY),h=Math.ceil(b.evalExpression(this.size)-0.4);d.fillStyle=
a.getColor(b,c);d.beginPath();d.arc(g,f,h,0,e,!0);d.fill();this.text!=[""]&&this.uber.drawText.call(this,d,this.text,g+h,f-h,this.color,this.font,"start","alphabetic",b.evalExpression(this.decimals),this.fixed)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=2*Math.PI;a.Segment=function(d,c){a.Graphic.call(this,d,c);this.width=-1==this.width?this.evaluator.parser.parse("1"):this.width};a.extend(a.Segment,a.Graphic);a.Segment.prototype.update=function(){var d=this.evaluator,
c=d.evalExpression(this.expresion);this.endPoints=[];for(var b=0,e=c.length;b<e;b++)this.endPoints[b]={x:c[b][0],y:c[b][1]};if(this.rotateExp)for(var b=a.degToRad(d.evalExpression(this.rotateExp)),d=Math.cos(b),c=Math.sin(b),f,h,b=0,e=this.endPoints.length;b<e;b++)f=this.endPoints[b].x*d-this.endPoints[b].y*c,h=this.endPoints[b].x*c+this.endPoints[b].y*d,this.endPoints[b].x=f,this.endPoints[b].y=h};a.Segment.prototype.draw=function(){this.uber.draw.call(this,this.color,this.color)};a.Segment.prototype.drawTrace=
function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Segment.prototype.drawAux=function(d,c,b){var g=this.evaluator,f=g.evalExpression(this.width);0>=f&&(f=1.0E-6);d.lineWidth=f;f=g.evalExpression(this.size);d.fillStyle=a.getColor(g,c);d.strokeStyle=a.getColor(g,b);d.lineCap="round";var c=10+d.lineWidth,b=0==d.lineWidth%2?0:0.5,h,i,j,k;this.abs_coord?(h=this.endPoints[0].x,i=this.endPoints[0].y,j=this.endPoints[1].x,k=this.endPoints[1].y):(h=this.space.getAbsoluteX(this.endPoints[0].x),
i=this.space.getAbsoluteY(this.endPoints[0].y),j=this.space.getAbsoluteX(this.endPoints[1].x),k=this.space.getAbsoluteY(this.endPoints[1].y));f=g.evalExpression(this.size);0>f&&(f=0);d.beginPath();d.moveTo(h+b,i+b);d.lineTo(j+b,k+b);this.text!=[""]&&this.uber.drawText.call(this,d,this.text,(h+j)/2+c,(i+k)/2-c,this.color,this.font,"start","alphabetic",g.evalExpression(this.decimals),this.fixed);d.stroke();d.beginPath();d.arc(h,i,f,0,e,!0);d.arc(j,k,f,0,e,!0);d.fill()};return a}(descartesJS||{}),descartesJS=
function(a){if(a.loadLib)return a;var e=Math.floor;a.Arrow=function(d,c){a.Graphic.call(this,d,c);this.width=-1==this.width?this.evaluator.parser.parse("5"):this.width};a.extend(a.Arrow,a.Graphic);a.Arrow.prototype.update=function(){var d=this.evaluator,c=d.evalExpression(this.expresion);this.endPoints=[];for(var b=0,e=c.length;b<e;b++)this.endPoints[b]={x:c[b][0],y:c[b][1]};if(this.rotateExp)for(var b=a.degToRad(d.evalExpression(this.rotateExp)),d=Math.cos(b),c=Math.sin(b),f,h,b=0,e=this.endPoints.length;b<
e;b++)f=this.endPoints[b].x*d-this.endPoints[b].y*c,h=this.endPoints[b].x*c+this.endPoints[b].y*d,this.endPoints[b].x=f,this.endPoints[b].y=h};a.Arrow.prototype.draw=function(){this.uber.draw.call(this,this.arrow,this.color)};a.Arrow.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.arrow,this.trace)};a.Arrow.prototype.drawAux=function(d,c,b){var g=this.evaluator,f=this.space;g.evalExpression(this.size);var h=g.evalExpression(this.width);1>h&&(h=1);var i=Math.ceil(h/2),j=f.scale;this.vect=
new a.Vector2D(this.endPoints[1].x-this.endPoints[0].x,this.endPoints[1].y-this.endPoints[0].y);var k=this.vect.vectorLength();this.angle=this.vect.angleBetweenVectors(a.Vector2D.AXIS_X);d.fillStyle=a.getColor(g,c);d.strokeStyle=a.getColor(g,b);d.lineWidth=1;var l,m,o;this.abs_coord?(c=this.endPoints[0].x,l=this.endPoints[0].y,m=this.endPoints[1].x,f=this.endPoints[1].y):(c=f.getAbsoluteX(this.endPoints[0].x),l=f.getAbsoluteY(this.endPoints[0].y),m=f.getAbsoluteX(this.endPoints[1].x),f=f.getAbsoluteY(this.endPoints[1].y));
o=g.evalExpression(this.spear);0>o&&(o=0);d.save();d.translate(c,l,k);this.abs_coord?0<=this.vect.x&&0<=this.vect.y||0>=this.vect.x&&0<=this.vect.y?d.rotate(this.angle):d.rotate(-this.angle):(k*=j,0<=this.vect.x&&0<=this.vect.y||0>=this.vect.x&&0<=this.vect.y?d.rotate(-this.angle):d.rotate(this.angle));d.beginPath();d.moveTo(-i+0.5,e(-i)+0.5);d.lineTo(e(k-o-h)+0.5,e(-i)+0.5);d.lineTo(e(k-2*o)+0.5,e(-o-i)+0.5);d.lineTo(e(k)+0.5,0);d.lineTo(e(k-2*o)+0.5,e(o+i)-0.5);d.lineTo(e(k-o-h)+0.5,e(i)-0.5);d.lineTo(-i+
0.5,e(i)-0.5);d.closePath();d.stroke();d.fill();d.restore();this.text!=[""]&&this.uber.drawText.call(this,d,this.text,(c+m)/2,(l+f)/2,b,this.font,"start","alphabetic",g.evalExpression(this.decimals),this.fixed)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Polygon=function(e,d){a.Graphic.call(this,e,d);this.width=-1==this.width?this.evaluator.parser.parse("1"):this.width};a.extend(a.Polygon,a.Graphic);a.Polygon.prototype.update=function(){var e=this.evaluator,d=e.evalExpression(this.expresion);
this.endPoints=[];for(var c=0,b=d.length;c<b;c++)this.endPoints[c]={x:d[c][0],y:d[c][1]};if(this.rotateExp)for(var c=a.degToRad(e.evalExpression(this.rotateExp)),e=Math.cos(c),d=Math.sin(c),g,f,c=0,b=this.endPoints.length;c<b;c++)g=this.endPoints[c].x*e-this.endPoints[c].y*d,f=this.endPoints[c].x*d+this.endPoints[c].y*e,this.endPoints[c].x=g,this.endPoints[c].y=f};a.Polygon.prototype.draw=function(){this.uber.draw.call(this,this.fill,this.color)};a.Polygon.prototype.drawTrace=function(){this.uber.drawTrace.call(this,
this.trace,this.trace)};a.Polygon.prototype.drawAux=function(e,d,c){var b=this.evaluator,g=b.evalExpression(this.width);0>=g&&(g=1.0E-6);e.lineWidth=g;e.fillStyle=a.getColor(b,d);e.strokeStyle=a.getColor(b,c);e.lineCap="round";e.lineJoin="round";d=0==this.ctx.lineWidth%2?0:0.5;c=this.abs_coord?this.endPoints[0].x:this.space.getAbsoluteX(this.endPoints[0].x);b=this.abs_coord?this.endPoints[0].y:this.space.getAbsoluteY(this.endPoints[0].y);e.beginPath();e.moveTo(c+d,b+d);for(var g=1,f=this.endPoints.length;g<
f;g++)c=this.abs_coord?this.endPoints[g].x:this.space.getAbsoluteX(this.endPoints[g].x),b=this.abs_coord?this.endPoints[g].y:this.space.getAbsoluteY(this.endPoints[g].y),e.lineTo(c+d,b+d);this.fill&&e.fill();e.stroke()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=Math.floor;a.Arc=function(d,c){a.Graphic.call(this,d,c);this.width=-1==this.width?this.evaluator.parser.parse("1"):this.width};a.extend(a.Arc,a.Graphic);a.Arc.prototype.update=function(){var d=this.evaluator,
c=d.evalExpression(this.center);this.exprX=c[0][0];this.exprY=c[0][1];if(this.rotateExp){var b=a.degToRad(d.evalExpression(this.rotateExp)),c=Math.cos(b),e=Math.sin(b),b=this.exprX*c-this.exprY*e,c=this.exprX*e+this.exprY*c;this.exprX=b;this.exprY=c}b=d.evalExpression(this.init);c=d.evalExpression(this.end);if("(expr)"==this.init.type&&"(expr)"==this.end.type||"[expr]"==this.init.type&&"[expr]"==this.end.type||"(expr)"==this.init.type&&"[expr]"==this.end.type||"[expr]"==this.init.type&&"(expr)"==
this.end.type){this.vectors=!0;var d=b[0][0],e=b[0][1],f=c[0][0],h=c[0][1],c=Math.acos((1*d+0*e)/Math.sqrt(d*d+e*e)),b=Math.acos((1*f+0*h)/Math.sqrt(f*f+h*h));0<d&&0<e&&!this.abs_coord&&(c=2*Math.PI-c);0<d&&0>e&&this.abs_coord&&(c=2*Math.PI-c);0>d&&0>e&&this.abs_coord&&(c=2*Math.PI-c);0>d&&0<e&&!this.abs_coord&&(c=2*Math.PI-c);0<f&&0<h&&!this.abs_coord&&(b=2*Math.PI-b);0<f&&0>h&&this.abs_coord&&(b=2*Math.PI-b);0>f&&0>h&&this.abs_coord&&(b=2*Math.PI-b);0>f&&0<h&&!this.abs_coord&&(b=2*Math.PI-b);d=
Math.min(c,b);e=Math.max(c,b);c=d;b=e;b-c>Math.PI&&this.abs_coord&&(c=e,b=d);b-c<=Math.PI&&!this.abs_coord&&(c=e,b=d);this.iniAng=c;this.endAng=b}else this.vectors=!1,this.iniAng=a.degToRad(b),this.endAng=a.degToRad(c)};a.Arc.prototype.draw=function(){this.uber.draw.call(this,this.fill,this.color)};a.Arc.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.fill,this.trace)};a.Arc.prototype.drawAux=function(d,c,b){var g=this.evaluator,f=this.space,h=this.abs_coord?e(this.exprX)+0.5:e(f.getAbsoluteX(this.exprX))+
0.5,i=this.abs_coord?e(this.exprY)+0.5:e(f.getAbsoluteY(this.exprY))+0.5,j=g.evalExpression(this.radius);if(!this.vectors&&this.iniAng>this.endAng){var k=this.iniAng;this.iniAng=this.endAng;this.endAng=k}0>j&&(j=0);k=!1;this.abs_coord||(j*=f.scale,this.vectors||(this.iniAng=-this.iniAng,this.endAng=-this.endAng,k=!0));this.vectors&&(k=this.abs_coord?!1:!0);f=g.evalExpression(this.width);0>=f&&(f=1.0E-6);d.lineWidth=f;d.lineCap="round";d.fillStyle=a.getColor(g,c);d.strokeStyle=a.getColor(g,b);this.fill&&
(d.beginPath(),d.moveTo(h,i),d.arc(h,i,j,this.iniAng,this.endAng,k),d.fill());d.beginPath();d.arc(h,i,j,this.iniAng,this.endAng,k);d.stroke();this.text!=[""]&&this.uber.drawText.call(this,d,this.text,h+1,i-1,this.color,this.font,"start","alphabetic",g.evalExpression(this.decimals),this.fixed)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Fill=function(e,d){a.Graphic.call(this,e,d)};a.extend(a.Fill,a.Graphic);a.Fill.prototype.update=function(){};a.Fill.prototype.draw=
function(){this.uber.draw.call(this,this.color,this.color)};a.Fill.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Fill.prototype.drawAux=function(){};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Text=function(e,d){a.Graphic.call(this,e,d);this.align||(this.align="start");-1==this.width&&(this.width=this.evaluator.parser.parse("0"));this.abs_coord=!0};a.extend(a.Text,a.Graphic);a.Text.prototype.update=function(){var e=this.evaluator,
d=e.evalExpression(this.expresion);this.exprX=d[0][0];this.exprY=d[0][1];if(this.rotateExp){var d=a.degToRad(e.evalExpression(this.rotateExp)),e=Math.cos(d),c=Math.sin(d),d=this.exprX*e-this.exprY*c,e=this.exprX*c+this.exprY*e;this.exprX=d;this.exprY=e}};a.Text.prototype.draw=function(){this.uber.draw.call(this,this.color)};a.Text.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.color)};a.Text.prototype.drawAux=function(a,d){var c=this.splitText(this.text);this.text!=[""]&&this.uber.drawText.call(this,
a,c,parseFloat(this.exprX)+5,parseFloat(this.exprY),d,this.font,this.align,"hanging",this.evaluator.evalExpression(this.decimals),this.fixed)};a.Text.prototype.splitText=function(a){var d=this.evaluator.evalExpression(this.width),c,b,g=[];this.ctx.font=this.font;this.fontSize=(this.fontSize=this.font.match(/(\d+)px/))?this.fontSize[1]:"10";if(20<=d&&"undefined"!=a.type){for(var f=0,h=a.length;f<h;f++)c=this.evaluator.evalExpression(a[f],this.evaluator.evalExpression(this.decimals),this.fixed).trim(),
b=this.ctx.measureText(c).width,b>d?g=g.concat(this.splitWords(c,d)):g.push(c);a=Math.floor(1.2*this.fontSize)*g.length;this.evaluator.setVariable("_Text_H_",a);return g}this.evaluator.setVariable("_Text_H_",0);this.evaluator.setVariable("_Text_W_",1E3);return a};a.Text.prototype.splitWords=function(a,d){var c=a,b=[],g,f,h,i,j=!1;do h=Math.floor(c.length*(d/this.ctx.measureText(c).width))+1,g=c.slice(0,h),""!=g&&" "==g[0]&&(c=c.slice(1),g=c.slice(0,h)),j=c[h-1]&&c[h]&&" "!=c[h-1]&&" "!=c[h],i=g.lastIndexOf(" "),
f=this.ctx.measureText(g).width,f>=d?(h=-1!=i?i:h-1,g=c.slice(0,h)):j&&-1!=i&&(h=i,g=c.slice(0,h)),b.push(g),c=c.slice(h);while(""!=c);return b};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Image=function(e,d){a.Graphic.call(this,e,d);this.img=new Image;this.img.ready=0;this.img.onload=function(){this.ready=1;this.onload=function(){}};this.img.src=this.evaluator.evalExpression(this.file);this.scaleY=this.scaleX=1};a.extend(a.Image,a.Graphic);a.Image.prototype.update=
function(){var e=this.evaluator,d=e.evalExpression(this.expresion);this.exprX=d[0][0];this.exprY=d[0][1];if(this.rotateExp){var c=a.degToRad(e.evalExpression(this.rotateExp)),b=Math.cos(c),g=Math.sin(c),c=this.exprX*b-this.exprY*g,b=this.exprX*g+this.exprY*b;this.exprX=c;this.exprY=b}if(4==d[0].length&&(this.centered=!0,this.scaleX=d[0][2],0==this.scaleX&&(this.scaleX=1.0E-5),this.scaleY=d[0][3],0==this.scaleY))this.scaleY=1.0E-5;if(d[1]&&2==d[1].length&&(this.centered=!0,this.scaleX=d[1][0],0==this.scaleX&&
(this.scaleX=1.0E-5),this.scaleY=d[1][1],0==this.scaleY))this.scaleY=1.0E-5;if((e=e.evalExpression(this.file))||""==e)this.img=this.parent.getImage(e)};a.Image.prototype.draw=function(){this.uber.draw.call(this)};a.Image.prototype.drawTrace=function(){this.uber.drawTrace.call(this)};a.Image.prototype.drawAux=function(e){var d=this.evaluator;if(this.img&&this.img.ready&&this.img.complete){var c=this.centered?0:this.img.width/2,b=this.centered?0:this.img.height/2,g=this.abs_coord?this.exprX:this.space.getAbsoluteX(this.exprX),
f=this.abs_coord?this.exprY:this.space.getAbsoluteY(this.exprY),h=a.degToRad(-d.evalExpression(this.inirot));e.translate(g+c,f+b);e.rotate(h);e.scale(this.scaleX,this.scaleY);this.opacity&&(e.globalAlpha=d.evalExpression(this.opacity));e.drawImage(this.img,-this.img.width/2,-this.img.height/2);e.setTransform(1,0,0,1,0,0);e.globalAlpha=1}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Macro=function(e,d){a.Graphic.call(this,e,d);this.graphics=[];var c=e.lessonParser,b=
new a.Tokenizer,g;for(g in d)d.hasOwnProperty(g)&&(this[g]=d[g]);if(void 0!=this.expresion){this.expresion.match("'")||(this.expresion="'"+this.expresion+"'");this.expresion=this.evaluator.parser.parse(this.expresion);g=this.expresion.value;var f,h=2;g&&((f=document.getElementById(g))&&"descartes/macro"==f.type?(f=f.text,h=3):(f=a.openExternalFile(g),f.match("tipo_de_macro")||(f=null)));var i="|";if(f){f=f.replace(/&aacute;/g,"\u00e1").replace(/&eacute;/g,"\u00e9").replace(/&iacute;/g,"\u00ed").replace(/&oacute;/g,
"\u00f3").replace(/&uacute;/g,"\u00fa").replace(/&Aacute;/g,"\u00c1").replace(/&Eacute;/g,"\u00c9").replace(/&Iacute;/g,"\u00cd").replace(/&Oacute;/g,"\u00d3").replace(/&Uacute;/g,"\u00da").replace(/&ntilde;/g,"\u00f1").replace(/&Ntilde;/g,"\u00d1").replace(/\&gt;/g,">").replace(/\&lt;/g,"<").replace(/\&amp;/g,"&").split("\n").slice(h);var j,k;g=0;for(h=f.length;g<h;g++)f[g]&&(f[g]=c.split(f[g]),f[g]&&f[g][0]&&f[g][0][0]&&"id"==f[g][0][0]&&(j=f[g][0][1],k=j.indexOf("("),-1!=k&&(j=j.substring(0,k)),
i+=j+"|"));var l,m,o,q;g=0;for(h=f.length;g<h;g++){l=f[g]||[];j=0;for(k=l.length;j<k;j++)if(m=babel[l[j][0]],o=l[j][0].indexOf("."),-1!=o&&(m=babel[l[j][0].substring(o+1)]),!("id"!=m&&"text"!=m&&"expresion"!=m&&"interval"!=m&&"steps"!=m&&"drawif"!=m&&"size"!=m&&"width"!=m&&"center"!=m&&"radius"!=m&&"init"!=m&&"end"!=m&&"inirot"!=m&&"do"!=m&&"while"!=m&&"file"!=m&&"fill"!=m&&"color"!=m))if("text"==m)if(l[j][1].match(/\{\\rtf1/)){m=l[j][1];var p=this;q=function(a,d){for(var c=b.tokenize(d.replace(/\&squot;/g,
"'")),f=0,e=c.length;f<e;f++)if(c[f].type=="identifier"&&i.match("\\|"+c[f].value+"\\|"))c[f].value=p.name+"."+c[f].value;else if(c[f].type=="identifier"&&(o=c[f].value.indexOf("."))!=-1&&i.match("\\|"+c[f].value.substring(0,o)+"\\|"))c[f].value=p.name+"."+c[f].value;return(a.match(/^\\expr/)?"\\expr ":"\\decimals ")+b.flatTokens(c)};m=m.replace(/\\expr ([a-zA-Z_0-9\u00C0-\u021B+*/%|&^#!?:()><.']*)/gi,q);m=m.replace(/\\decimals ([a-zA-Z_0-9\u00C0-\u021B+*/%|&^#!?:()><.']*)/gi,q);l[j][1]=m}else{q=
c.parseText(l[j][1]);for(var r=0,n=q.length;r<n;r++){m=b.tokenize(q[r].replace(/\&squot;/g,"'"));for(var t=0,v=m.length;t<v;t++)"identifier"==m[t].type&&i.match("\\|"+m[t].value+"\\|")&&(m[t].value=this.name+"."+m[t].value);m=b.flatTokens(m).replace(/&squot;/g,"'").replace(/'\+\(/g,"[").replace(/\)\+'/g,"]");q[r]=m.substring(1,m.length-1)}l[j][1]=q.join("\\n")}else{m=b.tokenize(l[j][1].replace(/\&squot;/g,"'"));q=0;for(r=m.length;q<r;q++)if("identifier"==m[q].type&&i.match("\\|"+m[q].value+"\\|"))m[q].value=
this.name+"."+m[q].value;else if("identifier"==m[q].type&&-1!=(o=m[q].value.indexOf("."))&&i.match("\\|"+m[q].value.substring(0,o)+"\\|"))m[q].value=this.name+"."+m[q].value;l[j][1]=b.flatTokens(m)}}g=0;for(h=f.length;g<h;g++)if(f[g][0]){l="";j=0;for(k=f[g].length;j<k;j++)f[g][j]="type"!=babel[f[g][j][0]]?f[g][j][0]+"='"+f[g][j][1]+"' ":"espacio='"+this.spaceID+"' "+f[g][j][0]+"='"+f[g][j][1]+"' ",l+=f[g][j];f[g]=l;l.match(/^espacio/)?this.graphics.push(c.parseGraphic(f[g],this.abs_coord,this.background,
this.inirot)):c.parseAuxiliar(f[g])}}}};a.extend(a.Macro,a.Graphic);a.Macro.prototype.update=function(){if(this.inipos){var a=this.evaluator.evalExpression(this.inipos);this.iniPosX=a[0][0];this.iniPosY=a[0][1]}};a.Macro.prototype.drawAux=function(a){for(var d=0,c=this.graphics.length;d<c;d++)this.inipos&&(this.graphics[d].abs_coord?a.translate(this.iniPosX,this.iniPosY):a.translate(this.iniPosX*this.space.scale,-this.iniPosY*this.space.scale)),this.graphics[d].draw(),a.setTransform(1,0,0,1,0,0)};
return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=Math.max,d=Math.min;a.R2=function(a,b){this.x=a||0;this.y=b||0};a.R2.prototype.copy=function(){return new a.R2(this.x,this.y)};a.R2.prototype.ix=function(){return Math.round(e(d(this.x,32E3),-32E3))};a.R2.prototype.iy=function(){return Math.round(e(d(this.y,32E3),-32E3))};a.R2.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};a.R2.prototype.norm2=function(){return this.x*this.x+this.y*this.y};a.R2.prototype.norm=
function(){return Math.sqrt(this.norm2())};a.R2.prototype.distance=function(a){var b=this.copy();b.sub(a);return b.norm()};a.R2.prototype.dot=function(a){return this.x*a.x+this.y*a.y};a.R2.prototype.det=function(a){return this.x*a.y-this.y*a.x};a.R2.prototype.mul=function(a){this.x*=a;this.y*=a};a.R2.prototype.div=function(a){this.x/=a;this.y/=a};a.R2.prototype.add=function(a){this.x+=a.x;this.y+=a.y};a.R2.prototype.sub=function(a){this.x-=a.x;this.y-=a.y};a.R2.prototype.normalize=function(){var a=
this.norm();0!=a&&this.div(a)};a.R2.prototype.rotR90=function(){var a=this.x;this.x=this.y;this.y=-a};a.R2.prototype.rotL90=function(){var a=this.x;this.x=-this.y;this.y=a};a.R2.prototype.rot=function(a){var b=this.copy(),d=Math.cos(a),a=Math.sin(a);this.x=b.x*d-b.y*a;this.y=b.x*a+b.y*d};a.R2.prototype.rot=function(a){this.rot(a*Math.PI/180)};a.R2.prototype.intersection=function(c,b,g,f){var h=b.x-c.x,i=g.x-f.x,j=g.x-c.x,k=b.y-c.y,l=g.y-f.y,m=g.y-c.y,o=h*l-i*k;return 1.0E-6<Math.abs(o)?(b=(j*l-m*
i)/o,g=(-j*k+m*h)/o,0<=b&&1>=b&&0<=g&&1>=g?new a.R2(c.x+h*b,c.y+k*b):null):(b.x-g.x)*m!=(b.y-g.y)*j?null:c.x!=b.x?(h=d(c.x,b.x),c=e(c.x,b.x),h<=g.x&&g.x<=c?g:h<=f.x&&f.x<=c?f:null):g.x!=f.x?(h=d(g.x,f.x),g=e(g.x,f.x),h<=c.x&&c.x<=g?c:h<=b.x&&b.x<=g?b:null):c.y!=b.y?(h=d(c.y,b.y),c=e(c.y,b.y),h<=g.y&&g.y<=c?g:h<=f.y&&f.y<=c?f:null):g.y!=f.y?(h=d(g.y,f.y),g=e(g.y,f.y),h<=c.y&&c.y<=g?c:h<=b.y&&b.y<=g?b:null):c.x==g.x&&c.y==g.y?c:null};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;
a.R2Newton=function(a,d){this.evaluator=a;this.constraint=d;if("=="==this.constraint.value||"<"==this.constraint.value||"<="==this.constraint.value||">"==this.constraint.value||">="==this.constraint.value)this.sign="<"==this.constraint.value||"<="==this.constraint.value?"menor":">"==this.constraint.value||">="==this.constraint.value?"mayor":"igual",this.constraint=this.constraint.equalToMinus(),this.constraint=this.constraint.childs[0]};a.R2Newton.prototype.getUnitNormal=function(){this.normal.normalize();
return this.normal.copy()};a.R2Newton.prototype.gradient=function(e){var d=this.evaluator,c=new a.R2(0,0),b=d.getVariable("x"),g=d.getVariable("y");d.setVariable("x",e.x);d.setVariable("y",e.y);this.f0=d.evalExpression(this.constraint);d.setVariable("x",d.getVariable("x")+1.0E-12);e=d.evalExpression(this.constraint);c.x=(e-this.f0)/1.0E-12;c.x=NaN!=c.x?c.x:Infinity;d.setVariable("x",d.getVariable("x")-1.0E-12);d.setVariable("y",d.getVariable("y")+1.0E-12);e=d.evalExpression(this.constraint);c.y=(e-
this.f0)/1.0E-12;c.y=NaN!=c.y?c.y:Infinity;d.setVariable("x",b);d.setVariable("y",g);return c};a.R2Newton.prototype.findZero=function(a){var d=this.evaluator,c=a.copy(),b=d.getVariable("x"),g=d.getVariable("y");d.setVariable("x",a.x);d.setVariable("y",a.y);this.f0=d.evalExpression(this.constraint);if("menor"==this.sign&&0>=this.f0||"mayor"==this.sign&&0<=this.f0)return c;d.setVariable("x",b);d.setVariable("y",g);for(g=0;256>g;g++)if(d=c.x,b=c.y,this.normal=this.gradient(c),0!=this.normal.norm2()&&
this.normal.mul(-this.f0/this.normal.norm2()),c.x=d+this.normal.x,c.y=b+this.normal.y,1.0E-6>this.normal.norm()){0==this.normal.x&&0==this.normal.y&&(this.normal.x=c.x-a.x,this.normal.y=c.y-a.y);break}return c};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=2*Math.PI;a.GraphicControl=function(d,c){this.parent=d;this.evaluator=d.evaluator;var b=this.evaluator.parser;this.id="G";this.type="";this.spaceID="E0";this.text="";this.expresion=b.parse("(0,0)");this.y=this.x=
0;this.size=b.parse("4");this.fixed=2!=this.parent.version?!1:!0;this.color="#0000ff";this.colorInt="#ff0000";this.font="Monospaced,PLAIN,12";this.image=new Image;this.image.onload=function(){this.ready=1};this.imageSrc="";this.drawif=b.parse("1");this.activeif=b.parse("1");this.tooltip="";this.tooltipFont="Monospace 12px";this.Explanation="";this.ExplanationFont="Monospace 12px";this.decimals=b.parse("2");this.zIndex=-1;for(var e in c)c.hasOwnProperty(e)&&(this[e]=c[e]);this.font=a.convertFont(this.font);
this.constraintExpr&&(this.constraint=b.parse(this.constraintExpr),"(expr)"==this.constraint.type&&(this.constraint=b.parse(this.constraintExpr.substring(1,this.constraintExpr.length-1))),"compOperator"==this.constraint.type?this.newt=new a.R2Newton(this.evaluator,this.constraint):this.constraint=null);this.container=this.getContainer();this.space=this.getSpace();this.mouseCacher=document.createElement("div");this.mouseCacher.setAttribute("class","DescartesGraphicControl");this.mouseCacher.setAttribute("id",
this.id);this.mouseCacher.setAttribute("tabindex","-1");this.ctx=this.space.ctx;this.container.appendChild(this.mouseCacher);this.init();this.registerMouseEvents()};a.GraphicControl.prototype.init=function(){var d=this.evaluator;this.mouseCacher.style.display=0<d.evalExpression(this.drawif)?"block":"none";var c=d.evalExpression(this.expresion);this.x=c[0][0];this.y=c[0][1];d.setVariable(this.id+".x",this.x);d.setVariable(this.id+".y",this.y);""!=this.imageSrc&&!this.imageSrc.toLowerCase().match(/vacio.gif$/)?
(this.image=this.parent.getImage(this.imageSrc),this.width=this.image.width,this.height=this.image.height):(this.width=2*d.evalExpression(this.size),this.height=2*d.evalExpression(this.size));this._w=a.hasTouchSupport&&70>this.width?70:this.width;this._h=a.hasTouchSupport&&70>this.height?70:this.height;this.constraint&&(c=this.newt.findZero(new a.R2(this.x,this.y)),this.x=c.x,this.y=c.y,d.setVariable(this.id+".x",this.x),d.setVariable(this.id+".y",this.y));this.mouseCacher.setAttribute("style","background-color: rgba(255, 255, 255, 0); width: "+
this._w+"px; height: "+this._h+"px; z-index: "+this.zIndex+";");this.mouseCacher.style.left=parseInt(this.space.getAbsoluteX(this.x)-this._w/2)+"px";this.mouseCacher.style.top=parseInt(this.space.getAbsoluteY(this.y)-this._h/2)+"px";d.setVariable(this.id+".activo",0)};a.GraphicControl.prototype.update=function(){var d=this.evaluator;this.x=d.getVariable(this.id+".x");this.y=d.getVariable(this.id+".y");var c=this.space.getAbsoluteX(this.x),b=this.space.getAbsoluteY(this.y);this.mouseCacher.style.left=
c-this._w/2+"px";this.mouseCacher.style.top=b-this._h/2+"px";this.mouseCacher.style.display=0<d.evalExpression(this.activeif)?"block":"none";this.constraint&&(c=this.newt.findZero(new a.R2(this.x,this.y)),this.x=c.x,this.y=c.y,d.setVariable(this.id+".x",this.x),d.setVariable(this.id+".y",this.y));this.draw()};a.GraphicControl.prototype.draw=function(){var d=this.evaluator;if(0<d.evalExpression(this.drawif)){var c=this.ctx,b=this.space.backgroundCtx,g=this.space.getAbsoluteX(this.x),f=this.space.getAbsoluteY(this.y);
""!=this.text&&this.drawText(g,f);if(this.image.ready)this.image.complete&&c.drawImage(this.image,g-this.image.width/2,f-this.image.height/2),this.trace&&(b.save(),b.translate(g,f),b.scale(this.image.width/2,this.image.height/2),b.beginPath(),b.arc(0,0,1,0,e,!1),b.restore(),b.lineWidth=1,b.strokeStyle=a.getColor(d,this.trace),b.stroke());else if(c.beginPath(),c.arc(g,f,this.width/2,0,e,!1),c.fillStyle=a.getColor(d,this.colorInt),c.fill(),c.lineWidth=1,c.strokeStyle=a.getColor(d,this.color),c.stroke(),
this.active&&(c.beginPath(),c.arc(g,f,this.width/2-2,0,e,!1),c.strokeStyle="black",c.stroke()),this.trace)b.lineWidth=1,b.strokeStyle=a.getColor(d,this.trace),b.beginPath(),b.arc(g,f,this.width/2,0,e,!1),b.stroke()}};a.GraphicControl.prototype.drawText=function(d,c){var b=this.ctx,e=this.evaluator;b.fillStyle=a.getColor(e,this.color);b.font=this.font;b.textBaseline="alphabetic";e=e.evalExpression(this.text[0],e.evalExpression(this.decimals),this.fixed);b.fillText(e,d+1+this.width/2,c-1-this.height/
2)};a.GraphicControl.prototype.getContainer=function(){for(var a=this.parent.spaces,c,b=0,e=a.length;b<e;b++)if(c=a[b],c.id==this.spaceID)return c.addCtr(this),this.zIndex=c.zIndex,c.graphicControlContainer;a[0].addCtr(this);this.zIndex=a[0].zIndex;return a[0].graphicControlContainer};a.GraphicControl.prototype.getSpace=function(){for(var a=this.parent.spaces,c=0,b=a.length;c<b;c++)if(a[c].id==this.spaceID)return a[c];return a[0]};a.GraphicControl.prototype.deactivate=function(){this.active=!1;this.evaluator.setVariable(this.id+
".activo",0)};a.GraphicControl.prototype.registerMouseEvents=function(){function d(d){d.preventDefault();i.whichButton=null==d.which?2>d.button?"LEFT":4==d.button?"MIDDLE":"RIGHT":2>d.which?"LEFT":2==d.which?"MIDDLE":"RIGHT";"LEFT"==i.whichButton&&0<i.evaluator.evalExpression(i.activeif)&&i.over&&(i.parent.deactivateGraphiControls(),i.click=!0,i.active=!0,i.evaluator.setVariable(i.id+".activo",1),i.posAnte=i.getCursorPosition(d),i.prePos={x:i.space.getAbsoluteX(i.x),y:i.space.getAbsoluteY(i.y)},a.hasTouchSupport?
(window.addEventListener("touchmove",e,!1),window.addEventListener("touchend",b,!1)):(window.addEventListener("mouseup",b,!1),window.addEventListener("mousemove",e,!1)))}function c(d){0<i.evaluator.evalExpression(i.activeif)&&(i.parent.deactivateGraphiControls(),i.click=!0,i.active=!0,i.posAnte=i.getCursorPosition(d),i.prePos={x:i.space.getAbsoluteX(i.x),y:i.space.getAbsoluteY(i.y)},a.hasTouchSupport?(window.addEventListener("touchmove",e,!1),window.addEventListener("touchend",b,!1)):(window.addEventListener("mouseup",
b,!1),window.addEventListener("mousemove",e,!1)));d.preventDefault()}function b(d){if(0<i.evaluator.evalExpression(i.activeif)||i.active)i.click=!1,d.preventDefault(),a.hasTouchSupport?(window.removeEventListener("touchmove",e,!1),window.removeEventListener("touchend",b,!1)):(window.removeEventListener("mouseup",b,!1),window.removeEventListener("mousemove",e,!1)),i.parent.update(),i.mouseCacher.style.left=i.space.getAbsoluteX(i.x)-i._w/2+"px",i.mouseCacher.style.top=i.space.getAbsoluteY(i.y)-i._h/
2+"px"}function e(b){var d=i.getCursorPosition(b);i.posX=i.prePos.x-(i.posAnte.x-d.x);i.posY=i.prePos.y-(i.posAnte.y-d.y);if(i.constraint){var d=i.space.getRelativeX(i.posX),c=i.space.getRelativeY(i.posY),d=i.newt.findZero(new a.R2(d,c));i.x=d.x;i.y=d.y;i.evaluator.setVariable(i.id+".x",i.x);i.evaluator.setVariable(i.id+".y",i.y)}else i.evaluator.setVariable(i.id+".x",i.space.getRelativeX(i.posX)),i.evaluator.setVariable(i.id+".y",i.space.getRelativeY(i.posY));i.parent.updateControls();i.parent.update();
b.preventDefault()}function f(){i.over=!0;i.mouseCacher.style.cursor="pointer"}function h(){i.over=!1;i.mouseCacher.style.cursor="";i.click=!1}this.active=this.over=this.click=!1;this.mouseCacher.oncontextmenu=function(){return!1};var i=this;a.hasTouchSupport?this.mouseCacher.addEventListener("touchstart",c,!1):(this.mouseCacher.addEventListener("mousedown",d,!1),this.mouseCacher.addEventListener("mouseover",f,!1),this.mouseCacher.addEventListener("mouseout",h,!1));this.mouseCacher.addEventListener("blur",
function(){console.log("en blur")},!1)};a.GraphicControl.prototype.getCursorPosition=function(d){d=a.getCursorPosition(d);return{x:d.x-(this.space.container.offsetLeft+this.space.container.parentNode.offsetLeft),y:d.y-(this.space.container.offsetTop+this.space.container.parentNode.offsetTop)}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Control=function(a,d){this.parent=a;this.evaluator=a.evaluator;var c=this.parser=a.evaluator.parser;this.id="C";this.gui=this.type=
"";this.region="south";this.y=this.x=0;this.w=100;this.h=23;"text"!=d.type?this.expresion=c.parse("(0,0,100,23)"):(this.expresion=c.parse("(0,0,300,200)"),this.w=300,this.h=200);this.fixed=2!=this.parent.version?!1:!0;this.visible=!0;this.color="#222222";this.colorInt="#f0f8ff";this.underlined=this.italics=this.bold="";this.font_size=c.parse("12");this.image=new Image;this.image.onload=function(){this.ready=1};this.imageSrc="";this.imageOver=new Image;this.imageOver.onload=function(){this.ready=1};
this.imageDown=new Image;this.imageDown.onload=function(){this.ready=1};this.parameter=this.action="";this.parameterFont="Monospace 12px";this.drawif=c.parse("1");this.activeif=c.parse("1");this.tooltip="";this.tooltipFont="Monospace 12px";this.Explanation="";this.ExplanationFont="Monospace 12px";this.cID=this.msg_pos="";this.valueExpr=c.parse("0");this.decimals=c.parse("2");this.min=c.parse("-Infinity");this.max=c.parse("Infinity");this.incr=c.parse("0.1");this.exponentialif=this.discrete=!1;this.zIndex=
-1;for(var b in d)d.hasOwnProperty(b)&&(this[b]=d[b]);void 0==this.name&&(this.name=2==this.parent.version?this.id:"_nada_");c=this.evaluator.evalExpression(this.expresion);this.x=c[0][0];this.y=c[0][1];4==c[0].length&&(this.w=c[0][2],this.h=c[0][3]);this.name="_._"==this.name||"_nada_"==this.name||"_void_"==this.name?"":this.name;this.actionExec=this.parent.lessonParser.parseAction(this)};a.Control.prototype.init=function(){};a.Control.prototype.update=function(){};a.Control.prototype.draw=function(){};
a.Control.prototype.getContainer=function(){var a=this.parent.spaces,d;if("interior"==this.region)for(var c=0,b=a.length;c<b;c++){if(d=a[c],d.id==this.spaceID)return d.addCtr(this),this.zIndex=d.zIndex,d.numericalControlContainer}else{if("external"==this.region)return this.parent.externalSpace.container;if("scenario"==this.region)return this.parent.scenarioRegion.scenarioSpace.addCtr(this),this.zIndex=this.parent.scenarioRegion.scenarioSpace.zIndex,this.parent.scenarioRegion.scenarioSpace.numericalControlContainer;
if("north"==this.region)return this.parent.northSpace.controls.push(this),this.parent.northSpace.container;if("south"==this.region)return this.parent.southSpace.controls.push(this),this.parent.southSpace.container;if("east"==this.region)return this.parent.eastSpace.controls.push(this),this.parent.eastSpace.container;if("west"==this.region)return this.parent.westSpace.controls.push(this),this.parent.westSpace.container;if("special"==this.region)return this.parent.specialSpace.controls.push(this),this.parent.specialSpace.container}a[0].addCtr(this);
this.zIndex=a[0].zIndex;return a[0].numericalControlContainer};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=Math.floor;a.Button=function(d,c){a.Control.call(this,d,c);this.name="["==this.name.charAt(0)&&this.name.charAt(this.name.length-1)?this.parser.parse(this.name.substring(1,this.name.length-1)):this.parser.parse("'"+this.name+"'");var b;this.imageSrc.match("_COLORES_")&&(b=this.imageSrc.split("_"),this.colorInt=b[2],this.color=b[3],this.font_size=this.parser.parse(b[5]),
this.imageSrc="");this.imageSrc="["==this.imageSrc.charAt(0)&&this.imageSrc.charAt(this.imageSrc.length-1)?this.parser.parse(this.imageSrc.substring(1,this.imageSrc.length-1)):this.parser.parse("'"+this.imageSrc+"'");b=this.evaluator.evalExpression(this.imageSrc);if(""!=b){var e=b.substr(0,b.lastIndexOf(".")),f=b.substr(b.lastIndexOf("."));b.toLowerCase().match(/vacio.gif$/)?(this.image.ready=1,3==this.parent.version&&(this.name=this.parser.parse("")),this.parser.parse("'vacio.gif'")):(this.image=
this.parent.getImage(b),this.imageOver=this.parent.getImage(e+"_over"+f),this.imageDown=this.parent.getImage(e+"_down"+f))}b=this.getContainer();this.canvas=document.createElement("canvas");this.canvas.setAttribute("class","DescartesButton");this.canvas.setAttribute("id",this.id);this.canvas.setAttribute("width",this.w+"px");this.canvas.setAttribute("height",this.h+"px");this.canvas.setAttribute("style","left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.canvas.style.display=
0<this.evaluator.evalExpression(this.drawif)?"block":"none";this.ctx=this.canvas.getContext("2d");b.childNodes[0]?b.insertBefore(this.canvas,b.childNodes[0]):b.appendChild(this.canvas);this.registerMouseEvents();this.init()};a.extend(a.Button,a.Control);a.Button.prototype.init=function(){var a=this.canvas,c=this.evaluator.evalExpression(this.expresion);this.x=c[0][0];this.y=c[0][1];4==c[0].length&&(this.w=parseInt(c[0][2]),this.h=parseInt(c[0][3]));a.setAttribute("width",this.w+"px");a.setAttribute("height",
this.h+"px");a.setAttribute("style","left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.createGradient(this.w,this.h);this.draw()};a.Button.prototype.update=function(){var a=!1,c=!1,b=!1,e=!1;0<this.evaluator.evalExpression(this.drawif)?(this.canvas.style.display="block",this.draw()):(this.click=!1,this.canvas.style.display="none");this.evaluator.evalExpression(this.activeif);var f=this.evaluator.evalExpression(this.expresion),a=this.x!=f[0][0],c=this.y!=f[0][1];this.x=f[0][0];
this.y=f[0][1];4==f[0].length&&(b=this.w!=f[0][2],e=this.h!=f[0][3],this.w=f[0][2],this.h=f[0][3]);(b||e)&&this.createGradient(this.canvas.width,this.canvas.height);if(b||e||a||c)this.canvas.setAttribute("width",this.w+"px"),this.canvas.setAttribute("height",this.h+"px"),this.canvas.setAttribute("style","left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";"),this.draw()};a.Button.prototype.createGradient=function(a,c){this.linearGradient=this.ctx.createLinearGradient(0,0,0,c);for(var b=
c*c,g,f=0;f<c;f++)g=e(f-35*c/100),this.linearGradient.addColorStop(f/c,"rgba(0,0,0,"+192*g*g/b/255+")")};a.Button.prototype.draw=function(){var d=this.evaluator.evalExpression(this.font_size),c=this.evaluator.evalExpression(this.name),b=this.evaluator.evalExpression(this.imageSrc),g;g="vacio.gif"==b?{ready:!0}:this.parent.getImage(b);var f=this.ctx;f.clearRect(0,0,this.w,this.h);var h=0,i=0;this.click&&(i=h=1);g&&g.ready?(""!=g.src||!b.toLowerCase().match(/vacio.gif$/))&&g.complete&&f.drawImage(g,
(this.w-g.width)/2+h,(this.h-g.height)/2+i):(f.fillStyle=a.getColor(this.evaluator,this.colorInt),f.fillRect(0,0,this.w,this.h),this.click||(a.drawLine(f,this.w-1,0,this.w-1,this.h,"rgba(0,0,0,"+128/255+")"),a.drawLine(f,0,0,0,this.h,"rgba(0,0,0,"+24/255+")"),a.drawLine(f,1,0,1,this.h,"rgba(0,0,0,"+8/255+")")),f.fillStyle=this.linearGradient,f.fillRect(0,0,this.w,this.h));""!=this.imageOver.src&&this.imageOver.ready&&this.over&&f.drawImage(this.imageOver,(this.w-g.width)/2+h,(this.h-g.height)/2+i);
""!=this.imageDown.src&&this.imageDown.ready&&this.click?f.drawImage(this.imageDown,(this.w-g.width)/2+h,(this.h-g.height)/2+i):this.click&&(f.save(),a.drawLine(f,0,0,0,this.h-2,"gray"),a.drawLine(f,0,0,this.w-1,0,"gray"),f.fillStyle="rgba(0, 0, 0,"+24/255+")",f.fillRect(0,0,this.w,this.h),f.restore());f.fillStyle=a.getColor(this.evaluator,this.color);f.font=this.italics+" "+this.bold+" "+d+"px Arial";f.textAlign="center";f.textBaseline="middle";f.strokeStyle=a.getColor(this.evaluator,this.colorInt);
f.lineWidth=d/12;this.stroke!=this.fillStyle&&f.strokeText(c,e(this.w/2+h)+0.5,e(this.h/2+i)+0.5);f.fillText(c,e(this.w/2+h)+0.5,e(this.h/2+i)+0.5);this.underlined&&(c=f.measureText(c).width,f.strokeStyle=a.getColor(this.evaluator,this.color),f.lineWidth=e(d/10),f.lineCap="round",f.beginPath(),f.moveTo((this.w-c)/2+h,e(this.h+d)/2+f.lineWidth/2-1.5+i),f.lineTo((this.w+c)/2+h,e(this.h+d)/2+f.lineWidth/2-1.5+i),f.stroke());this.evaluator.evalExpression(this.activeif)||(f.fillStyle="rgba(240,240,240,"+
160/255+")",f.fillRect(0,0,this.w,this.h))};a.Button.prototype.bottonPressed=function(){this.parent.updateControls();"init"==this.action&&(this.click=!1);this.actionExec.execute();this.parent.updateControls();"animate"!=this.action&&this.parent.update()};a.Button.prototype.registerMouseEvents=function(){function d(a,b,c){i.click?(b.call(i),a=c?a:30,k=setTimeout(function(){d(a,b)},a)):clearInterval(k)}function c(a){a.preventDefault();i.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":
"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"LEFT"==i.whichButton&&0<i.evaluator.evalExpression(i.activeif)&&(i.click=!0,i.draw(),i.evaluator.setVariable(i.id,i.evaluator.evalExpression(i.valueExpr)),"calculate"==i.action&&d(j,i.bottonPressed,!0),h?window.addEventListener("touchend",b,!1):window.addEventListener("mouseup",b,!1))}function b(a){if(0<i.evaluator.evalExpression(i.activeif)||i.click)i.click=!1,i.draw(),"calculate"!=i.action&&i.bottonPressed(),a.preventDefault(),h?window.removeEventListener("touchend",
b,!1):window.removeEventListener("mouseup",b,!1)}function e(){i.over=!0;i.draw()}function f(){i.over=!1;i.click=!1;i.draw()}var h=a.hasTouchSupport;this.canvas.oncontextmenu=function(){return!1};var i=this,j=900,k;this.over=this.click=!1;h?this.canvas.addEventListener("touchstart",c,!1):(this.canvas.addEventListener("mousedown",c,!1),this.canvas.addEventListener("mouseover",e,!1),this.canvas.addEventListener("mouseout",f,!1))};return a}(descartesJS||{}),descartesJS=function(a){function e(a,c,b,e){a.fillStyle=
e||"black";a.beginPath();a.moveTo(c[0],b[0]);for(var e=1,f=c.length;e<f;e++)a.lineTo(c[e],b[e]);a.fill()}if(a.loadLib)return a;a.Spinner=function(d,c){a.Control.call(this,d,c);this.tabindex=++this.parent.tabindex;var b=this.getContainer();this.containerControl=document.createElement("div");this.canvas=document.createElement("canvas");this.divUp=document.createElement("div");this.divDown=document.createElement("div");this.field=document.createElement("input");this.label=document.createElement("label");
this.txtLabel=document.createTextNode(this.name);this.label.appendChild(this.txtLabel);""!=this.name&&this.containerControl.appendChild(this.label);this.containerControl.appendChild(this.field);this.containerControl.appendChild(this.canvas);this.containerControl.appendChild(this.divUp);this.containerControl.appendChild(this.divDown);b.childNodes[0]?b.insertBefore(this.containerControl,b.childNodes[0]):b.appendChild(this.containerControl);this.init();this.registerMouseEvents();this.draw()};a.extend(a.Spinner,
a.Control);a.Spinner.prototype.init=function(){var d=this.evaluator;this.value=this.validateValue(d.evalExpression(this.valueExpr));var c=this.formatOutputValue(this.value);this.fieldFontSize=Math.floor(this.h-0.25*this.h);var b=a.getTextWidth(c+"0",this.fieldFontSize+"px Arial"),e=2+this.h/2,f=this.w/2-e/2,h=a.getTextWidth(this.name,this.fieldFontSize+"px Arial");this.visible||(f=this.w-e,b=0);f<h&&(f=h);""==this.name&&(f=0);this.w-f-e<b&&(f=this.w-e-b);0>f&&(f=0);b=this.w-(f+e);this.containerControl.setAttribute("class",
"DescartesSpinnerContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.style.display=0<d.evalExpression(this.drawif)?"block":"none";this.canvas.setAttribute("width",e+"px");this.canvas.setAttribute("height",this.h+"px");this.canvas.setAttribute("style","position: absolute; left: "+f+"px; top: 0px;");this.ctx=this.canvas.getContext("2d");this.divUp.setAttribute("style",
"background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+e+"px; height : "+this.h/2+"px; left: "+f+"px; top: 0px;");this.divDown.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+e+"px; height : "+this.h/2+"px; left: "+f+"px; top: "+this.h/2+"px;");this.field.setAttribute("type","text");this.field.setAttribute("id",this.id+"_spinner");this.field.value=c;this.field.setAttribute("class","DescartesSpinnerField");
this.field.setAttribute("style","font-family: Arial; font-size: "+this.fieldFontSize+"px; width : "+(b-2)+"px; height : "+(this.h-2)+"px; left: "+(e+f)+"px;");this.field.setAttribute("tabindex",this.tabindex);this.field.disabled=0<d.evalExpression(this.activeif)?!1:!0;this.label.setAttribute("class","DescartesSpinnerLabel");this.label.setAttribute("style","font-family: Arial; font-size:"+this.fieldFontSize+"px; width: "+f+"px; height: "+this.h+"px;");d.setVariable(this.id,this.value);this.createGradient(this.h/
2,this.h)};a.Spinner.prototype.update=function(){var a=this.evaluator,c=!1,b=!1,e=!1,f=!1;this.field.disabled=0<a.evalExpression(this.activeif)?!1:!0;0<a.evalExpression(this.drawif)?(this.containerControl.style.display="block",this.draw()):(this.click=!1,this.containerControl.style.display="none");var h=a.evalExpression(this.expresion),c=this.x!=h[0][0],b=this.y!=h[0][1];this.x=h[0][0];this.y=h[0][1];4==h[0].length&&(e=this.w!=h[0][2],f=this.h!=h[0][3],this.w=h[0][2],this.h=h[0][3]);(e||f)&&this.createGradient(this.canvas.width,
this.canvas.height);var h=this.field.value,i=this.value;this.value=this.validateValue(a.getVariable(this.id));this.field.value=this.formatOutputValue(this.value);this.value==i&&this.field.value!=h&&(this.value=this.validateValue(h),this.field.value=this.formatOutputValue(this.value));if(e||f||c||b)this.init(),this.draw();a.setVariable(this.id,this.value)};a.Spinner.prototype.createGradient=function(a,c){this.linearGradient=this.ctx.createLinearGradient(0,0,0,c);for(var b=c*c,e,f=0;f<c;f++)e=Math.floor(f-
40*c/100),this.linearGradient.addColorStop(f/c,"rgba(0,0,0,"+192*e*e/b/255+")")};a.Spinner.prototype.draw=function(){var d=this.ctx,c=this.canvas.width,b=this.canvas.height;d.save();d.fillStyle="#f0f8ff";d.fillRect(0,0,c,b);d.fillStyle=this.linearGradient;d.fillRect(0,0,c,b);var g,f;this.up?(g="gray",f="#f0f8ff"):(g="#f0f8ff",f="gray");a.drawLine(d,0,0,c,0,g);a.drawLine(d,0,0,0,b/2,g);a.drawLine(d,0,b/2,c,b/2,f);this.down?(g="gray",f="#f0f8ff"):(g="#f0f8ff",f="gray");a.drawLine(d,0,b/2+1,c,b/2+1,
g);a.drawLine(d,0,b/2+1,0,b,g);a.drawLine(d,0,b-1,c,b-1,f);g=[c/2,c/5-1,c-c/5+1];f=[b/8+1,b/8+1+b/4,b/8+1+b/4];var h=0<this.evaluator.evalExpression(this.activeif);e(d,g,f,h?"#2244cc":"#8888aa");f=[b-b/8,b-b/8-b/4,b-b/8-b/4];e(d,g,f,h?"#d00018":"#aa8888");d.fillStyle="rgba(0,0,0,"+24/255+")";this.up&&d.fillRect(0,0,c,b/2);this.down&&d.fillRect(0,b/2,c,b)};a.Spinner.prototype.validateValue=function(a){var c=this.evaluator;(a=parseFloat(c.evalExpression(c.parser.parse(a.toString().replace(this.parent.decimal_symbol,
".")))))||(a=0);a<c.evalExpression(this.min)&&(a=c.evalExpression(this.min));a>c.evalExpression(this.max)&&(a=c.evalExpression(this.max));if(this.discrete)var b=c.evalExpression(this.incr),a=0==b?0:b*Math.round(a/b);return a=parseFloat(parseFloat(a).toFixed(c.evalExpression(this.decimals)))};a.Spinner.prototype.formatOutputValue=function(a){var c=a+"",b=this.evaluator.evalExpression(this.decimals),e=c.indexOf(".");-1!=e&&c.substring(e+1).length>b&&(c=parseFloat(c).toFixed(b));if(this.fixed&&(2!=this.parent.version||
2==this.parent.version&&!this.exponentialif))c=parseFloat(a).toFixed(b);this.exponentialif&&0!=parseFloat(c)&&(c=this.fixed&&2!=this.parent.version?parseFloat(c).toExponential(b):parseFloat(c).toExponential(),c=c.toUpperCase(),c=c.replace("+",""));return c=c.replace(".",this.parent.decimal_symbol)};a.Spinner.prototype.increase=function(){this.changeValue(parseFloat(this.value)+this.evaluator.evalExpression(this.incr))};a.Spinner.prototype.decrease=function(){this.changeValue(parseFloat(this.value)-
this.evaluator.evalExpression(this.incr))};a.Spinner.prototype.changeValue=function(a){0<this.evaluator.evalExpression(this.activeif)&&(this.value=this.validateValue(a),this.field.value=this.formatOutputValue(this.value),this.evaluator.setVariable(this.id,this.value),this.parent.updateControls(),"init"==this.action&&(this.click=!1),this.actionExec.execute(),this.parent.updateControls(),"animate"!=this.action&&this.parent.update())};a.Spinner.prototype.registerMouseEvents=function(){function d(a,b,
c){k.up||k.down?(b.call(k),a=c?a:30,m=setTimeout(function(){d(a,b)},a)):clearInterval(m)}function c(a){a.preventDefault();k.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"LEFT"==k.whichButton&&0<k.evaluator.evalExpression(k.activeif)&&(k.up=!0,d(l,k.increase,!0),k.draw())}function b(a){a.preventDefault();k.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"LEFT"==
k.whichButton&&0<k.evaluator.evalExpression(k.activeif)&&(k.down=!0,d(l,k.decrease,!0),k.draw())}function e(a){k.up=!1;clearInterval(m);k.draw();a.preventDefault()}function f(a){k.down=!1;clearInterval(m);k.draw();a.preventDefault()}function h(a){k.up=!1;clearInterval(m);k.draw();a.preventDefault()}function i(a){k.down=!1;clearInterval(m);k.draw();a.preventDefault()}var j=a.hasTouchSupport;this.divUp.oncontextmenu=function(){return!1};this.divDown.oncontextmenu=function(){return!1};var k=this,l=j?
500:200,m;this.field.addEventListener("keydown",function(a){13==a.keyCode&&k.changeValue(k.field.value)},!1);j?this.divUp.addEventListener("touchstart",c,!1):this.divUp.addEventListener("mousedown",c,!1);j?this.divDown.addEventListener("touchstart",b,!1):this.divDown.addEventListener("mousedown",b,!1);j||this.divUp.addEventListener("mouseout",e,!1);j||this.divDown.addEventListener("mouseout",f,!1);j?(this.divUp.addEventListener("touchend",h,!1),window.addEventListener("touchend",h,!1)):(this.divUp.addEventListener("mouseup",
h,!1),window.addEventListener("mouseup",h,!1));j?(this.divDown.addEventListener("touchend",i,!1),window.addEventListener("touchend",i,!1)):(this.divDown.addEventListener("mouseup",i,!1),window.addEventListener("mouseup",i,!1))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.TextField=function(e,d){a.Control.call(this,e,d);this.emptyString=!1;this.ok=0;this.tabindex=++this.parent.tabindex;if(this.answer)if(this.answer.match("krypto_")&&(this.answer=(new a.Krypto).decode(this.answer.substring(7))),
this.answerPattern=this.answer,this.onlyText){this.answer=a.buildRegularExpresionsPatterns(this.answer);var c=this.answerPattern.indexOf("|");this.firstAnswer=-1==c?this.answerPattern:this.answerPattern.substring(0,c)}else this.buildRangeExpresions(),this.firstAnswer=this.parser.parse(this.answerPattern.substring(1,this.answerPattern.indexOf(",")));this.onlyText&&(this.validateValue=function(a){return"''"==a||"'"==a?"":a},this.formatOutputValue=function(a){return a.toString()},this.evaluateAnswer=
this.evaluateTextualAnswer);c=this.getContainer();this.containerControl=document.createElement("div");this.field=document.createElement("input");this.label=document.createElement("label");this.txtLabel=document.createTextNode(this.name);this.label.appendChild(this.txtLabel);this.containerControl.appendChild(this.label);this.containerControl.appendChild(this.field);c.childNodes[0]?c.insertBefore(this.containerControl,c.childNodes[0]):c.appendChild(this.containerControl);this.init();this.registerMouseEvents();
this.draw()};a.extend(a.TextField,a.Control);a.TextField.prototype.init=function(){evaluator=this.evaluator;this.value=evaluator.evalExpression(this.valueExpr);this.value=this.validateValue(this.value);var e=this.formatOutputValue(this.value);this.fieldFontSize=Math.floor(this.h-0.25*this.h);var d=this.w/2,c=a.getTextWidth(e+"0",this.fieldFontSize+"px Arial"),b=a.getTextWidth(this.name,this.fieldFontSize+"px Arial");d<b&&(d=b);""==this.name&&(d=0);this.w-d<c&&(d=this.w-c);0>d&&(d=0);c=this.w-d;this.containerControl.setAttribute("class",
"DescartesTextFieldContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.style.display=0<evaluator.evalExpression(this.drawif)?"block":"none";this.field.setAttribute("type","text");this.field.setAttribute("id",this.id+"TextField");this.field.value=e;this.field.setAttribute("class","DescartesTextFieldField");this.field.setAttribute("style","font-size: "+this.fieldFontSize+
"px; width : "+c+"px; height : "+(this.h-2)+"px; left: "+d+"px;");this.field.setAttribute("tabindex",this.tabindex);this.field.disabled=0<evaluator.evalExpression(this.activeif)?!1:!0;this.label.setAttribute("class","DescartesTextFieldLabel");this.label.setAttribute("style","font-size:"+this.fieldFontSize+"px; width: "+d+"px; height: "+this.h+"px;");evaluator.setVariable(this.id,this.value);this.oldValue=this.value};a.TextField.prototype.update=function(){evaluator=this.evaluator;var a=!1,d=!1,c=
!1,b=!1;this.field.disabled=0<evaluator.evalExpression(this.activeif)?!1:!0;0<evaluator.evalExpression(this.drawif)?(this.containerControl.style.display="block",this.draw()):this.containerControl.style.display="none";var g=evaluator.evalExpression(this.expresion),a=this.x!=g[0][0],d=this.y!=g[0][1];this.x=g[0][0];this.y=g[0][1];4==g[0].length&&(c=this.w!=g[0][2],b=this.h!=g[0][3],this.w=g[0][2],this.h=g[0][3]);(c||b||a||d)&&this.init();a=this.field.value;d=this.value;this.value=this.validateValue(evaluator.getVariable(this.id));
this.field.value=this.formatOutputValue(this.value);this.value===d&&this.field.value!=a&&(this.value=this.validateValue(a),this.field.value=this.formatOutputValue(this.value));evaluator.setVariable(this.id,this.value)};a.TextField.prototype.validateValue=function(a){if(""===a||"''"==a)return"";var d=this.evaluator;(a=parseFloat(d.evalExpression(d.parser.parse(a.toString().replace(this.parent.decimal_symbol,".")))))||(a=0);a<d.evalExpression(this.min)&&(a=d.evalExpression(this.min));a>d.evalExpression(this.max)&&
(a=d.evalExpression(this.max));if(this.discrete)var c=d.evalExpression(this.incr),a=0==c?0:c*Math.round(a/c);return a=parseFloat(parseFloat(a).toFixed(d.evalExpression(this.decimals)))};a.TextField.prototype.formatOutputValue=function(a){if(""===a)return"";var d=a+"",c=this.evaluator.evalExpression(this.decimals),b=d.indexOf(".");-1!=b&&d.substring(b+1).length>c&&(d=parseFloat(d).toFixed(c));this.fixed&&(d=parseFloat(a).toFixed(c));this.exponentialif&&(d=d.toExponential(c),d=d.toUpperCase(),d=d.replace("+",
""));return d=d.replace(".",this.parent.decimal_symbol)};a.TextField.prototype.changeValue=function(a){0<this.evaluator.evalExpression(this.activeif)&&(this.value=this.validateValue(a),this.field.value=this.formatOutputValue(this.value),this.evaluate&&(this.ok=this.evaluateAnswer()),this.evaluator.setVariable(this.id,this.value),this.evaluator.setVariable(this.id+".ok",this.ok),this.parent.updateControls(),"init"==this.action&&(this.click=!1),this.actionExec.execute(),this.parent.updateControls(),
"animate"!=this.action&&this.parent.update())};a.TextField.prototype.evaluateAnswer=function(){var a=this.evaluator;parseFloat(this.value);for(var d,c,b,g,f,h,i,j=0,k=this.answer.length;j<k;j++)if(g=this.answer[j][0],h=this.answer[j][1],d=a.evalExpression(g.expression),c=a.evalExpression(h.expression),b="("==g.type,g="["==g.type,f=")"==h.type,h="]"==h.type,i=this.value,b&&f&&i>d&&i<c||b&&h&&i>d&&i<=c||g&&f&&i>=d&&i<c||g&&h&&i>=d&&i<=c)return 1;return 0};a.TextField.prototype.buildRangeExpresions=
function(){var a;this.answer=this.answer.split("|");for(var d=0,c=this.answer.length;d<c;d++)this.answer[d]=this.answer[d].trim(),this.answer[d]=this.answer[d].split(","),a=this.answer[d][0].trim(),this.answer[d][0]={type:a[0],expression:this.evaluator.parser.parse(a.substring(1))},a=this.answer[d][1].trim(),this.answer[d][1]={type:a[a.length-1],expression:this.evaluator.parser.parse(a.substring(0,a.length-1))}};a.TextField.prototype.evaluateTextualAnswer=function(){for(var e=this.value,d,c,b,g=0,
f=this.answer.length;g<f;g++){c=this.answer[g];b=!0;for(var h=0,i=c.length;h<i;h++)d=c[h],d.ignoreAcents&&(e=a.replaceAcents(e),d.regExp=a.replaceAcents(d.regExp)),d.ignoreCaps&&(e=e.toLowerCase(),d.regExp=d.regExp.toLowerCase()),b=b&&!!e.match(d.regExp);if(b)return 1}return 0};a.TextField.prototype.getFirstAnswer=function(){return this.answer?this.onlyText?this.firstAnswer:this.evaluator.evalExpression(this.firstAnswer):""};a.TextField.prototype.registerMouseEvents=function(){var a=this;this.field.addEventListener("blur",
function(){a.update()},!1);this.field.addEventListener("keydown",function(d){0<a.evaluator.evalExpression(a.activeif)&&13==d.keyCode&&a.changeValue(a.field.value,!0)},!1)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Menu=function(e,d){a.Control.call(this,e,d);var c=this.parser;this.options=this.options?this.options.split(","):[];this.menuOptions=[];this.strValue=[];for(var b,g=0,f=this.options.length;g<f;g++)b=this.options[g].split(/[\[\]]/,2),1==b.length?(this.menuOptions.push(b[0]),
this.strValue.push(g.toString())):2==b.length&&(this.menuOptions.push(b[0]),""==b[1]?this.strValue.push(g.toString()):this.strValue.push(b[1]));g=0;for(f=this.strValue.length;g<f;g++)this.strValue[g]=c.parse(this.strValue[g]);c=this.getContainer();this.containerControl=document.createElement("div");this.label=document.createElement("label");this.txtLabel=document.createTextNode(this.name);this.label.appendChild(this.txtLabel);this.select=document.createElement("select");g=0;for(f=this.menuOptions.length;g<
f;g++)b=document.createElement("option"),b.innerHTML=this.menuOptions[g],this.select.appendChild(b);this.field=document.createElement("input");this.init();this.containerControl.appendChild(this.label);this.containerControl.appendChild(this.select);this.visible&&this.containerControl.appendChild(this.field);c.childNodes[0]?c.insertBefore(this.containerControl,c.childNodes[0]):c.appendChild(this.containerControl);this.registerMouseEvents()};a.extend(a.Menu,a.Control);a.Menu.prototype.init=function(){var e=
this.evaluator;this.fieldFontSize=Math.floor(this.h-3-0.25*(this.h-3));var d=0,c=0,b=0;this.value=e.evalExpression(this.valueExpr);this.indexValue=this.getIndex(this.value);for(var g=0,f=this.menuOptions.length;g<f;g++)b=a.getTextWidth(this.menuOptions[g],this.fieldFontSize+"px Arial"),b>d&&(d=b,c=g);d+=25;b=a.getTextWidth(this.formatOutputValue(e.evalExpression(this.strValue[c])),this.fieldFontSize+"px Arial")+7;c=a.getTextWidth(this.name,this.fieldFontSize+"px Arial")+10;""==this.name&&(c=0);this.visible||
(b=0);for(g=this.w-b-c;g<d&&0<c;)c--,g++;for(;g<d&&0<b;)b--,g++;for(;c+g+b+1<this.w;)g++,b++;var d=c,f=d+g,b=this.w-f,h=this.formatOutputValue(e.evalExpression(this.strValue[this.indexValue]));this.containerControl.setAttribute("class","DescartesSpinnerContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.style.display=0<e.evalExpression(this.drawif)?"block":"none";
this.label.setAttribute("class","DescartesMenuLabel");this.label.setAttribute("style","font-size:"+this.fieldFontSize+"px; width: "+c+"px; height: "+this.h+"px;");this.field.setAttribute("type","text");this.field.setAttribute("id",this.id+"menu");this.field.value=h;this.field.setAttribute("class","DescartesMenuField");this.field.setAttribute("style","font-size: "+this.fieldFontSize+"px; width : "+b+"px; height : "+(this.h-2)+"px; left: "+f+"px;");this.field.disabled=0<e.evalExpression(this.activeif)?
!1:!0;this.select.setAttribute("id",this.id+"menuSelect");this.select.setAttribute("class","DescartesMenuSelect");this.select.setAttribute("style","text-align: left; font-size: "+this.fieldFontSize+"px; width : "+g+"px; height : "+this.h+"px; left: "+d+"px; border-color: #7a8a99; border-width: 1.5px; border-style: solid; background-color: #eeeeee;");this.select.selectedIndex=this.indexValue;this.select.disabled=0<e.evalExpression(this.activeif)?!1:!0;e.setVariable(this.id,parseFloat(h))};a.Menu.prototype.update=
function(){var a=this.evaluator,d=!1,c=!1,b=!1,g=!1,d=0<a.evalExpression(this.activeif);this.field.disabled=d?!1:!0;this.select.disabled=d?!1:!0;0<a.evalExpression(this.drawif)?(this.containerControl.style.display="block",this.draw()):(this.click=!1,this.containerControl.style.display="none");var f=a.evalExpression(this.expresion),d=this.x!=f[0][0],c=this.y!=f[0][1];this.x=f[0][0];this.y=f[0][1];4==f[0].length&&(b=this.w!=f[0][2],g=this.h!=f[0][3],this.w=f[0][2],this.h=f[0][3]);if(b||g||d||c)this.init(),
this.draw();this.value=a.getVariable(this.id);this.field.value=this.formatOutputValue(this.value);a.setVariable(this.id,parseFloat(this.value));this.select.selectedIndex=parseFloat(this.getIndex(this.value))};a.Menu.prototype.getIndex=function(a){for(var a=parseFloat(a.toString().replace(this.parent.decimal_symbol,".")),d=-1,c=Infinity,b,g=0,f=this.strValue.length;g<f;g++)b=Math.abs(a-parseFloat(this.evaluator.evalExpression(this.strValue[g]))),b<=c&&(c=b,d=g);return d};a.Menu.prototype.formatOutputValue=
function(a){var d=a+"",c=this.evaluator.evalExpression(this.decimals),b=d.indexOf(".");-1!=b&&d.substring(b+1).length>c&&(d=parseFloat(d).toFixed(c));this.fixed&&(d=parseFloat(a).toFixed(c));this.exponentialif&&(d=d.toExponential(c),d=d.toUpperCase(),d=d.replace("+",""));return d=d.replace(".",this.parent.decimal_symbol)};a.Menu.prototype.changeValue=function(){0<this.evaluator.evalExpression(this.activeif)&&(this.evaluator.setVariable(this.id,this.value),this.parent.updateControls(),this.actionExec.execute(),
this.parent.updateControls(),"animate"!=this.action&&this.parent.update())};a.Menu.prototype.registerMouseEvents=function(){var a=this;this.select.oncontextmenu=function(){return!1};this.select.addEventListener("change",function(d){a.value=a.evaluator.evalExpression(a.strValue[this.selectedIndex]);a.field.value=a.formatOutputValue(a.value);a.evaluator.setVariable(a.id,a.field.value);a.changeValue();d.preventDefault()},!1);this.field.addEventListener("keydown",function(d){13==d.keyCode&&(a.indexValue=
a.getIndex(a.field.value),a.value=a.evaluator.evalExpression(a.strValue[a.indexValue]),a.field.value=a.formatOutputValue(a.indexValue),a.select.selectedIndex=a.indexValue,a.changeValue())},!1)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=Math.floor;a.Scrollbar=function(d,c){a.Control.call(this,d,c);this.orientation=this.w>=this.h?"horizontal":"vertical";var b=this.getContainer();this.containerControl=document.createElement("div");this.canvas=document.createElement("canvas");
this.divUp=document.createElement("div");this.divDown=document.createElement("div");this.field=document.createElement("input");this.label=document.createElement("label");this.scrollManipulator=document.createElement("div");this.txtLabel=document.createTextNode(this.name);this.label.appendChild(this.txtLabel);this.containerControl.appendChild(this.label);this.containerControl.appendChild(this.canvas);this.containerControl.appendChild(this.divUp);this.containerControl.appendChild(this.divDown);this.containerControl.appendChild(this.field);
this.containerControl.appendChild(this.scrollManipulator);b.childNodes[0]?b.insertBefore(this.containerControl,b.childNodes[0]):b.appendChild(this.containerControl);this.init();this.registerMouseEvents();this.draw()};a.extend(a.Scrollbar,a.Control);a.Scrollbar.prototype.init=function(){var a=this.evaluator;this.incr=0==a.evalExpression(this.decimals)?1:(a.evalExpression(this.max)-a.evalExpression(this.min))/100;this.value=this.validateValue(a.evalExpression(this.valueExpr));var c=this.formatOutputValue(this.value),
b=this.evaluator.evalExpression(this.expresion);this.x=b[0][0];this.y=b[0][1];4==b[0].length&&(this.w=b[0][2],this.h=b[0][3]);this.orientation=this.w>=this.h?"horizontal":"vertical";"vertical"==this.orientation?this.initVertical(c):this.initHorizontal(c);a.setVariable(this.id,this.value);a=this.value;this.value=null;this.changeValue(a);this.prePos=this.pos;this.draw()};a.Scrollbar.prototype.initVertical=function(d){this.fieldFontSize=e(this.w-0.25*this.w);this.fieldFontSize=17.25;a.getTextWidth(d+
"0",this.fieldFontSize+"px Arial");this.labelHeight=""==this.name?0:23;var c=""==this.visible?0:23;this.canvasHeight=this.h-this.labelHeight-c;var b=c+this.canvasHeight;this.downHeight=this.upHeight=15;this.scrollManipulatorHeight=parseInt((this.canvasHeight-this.upHeight-this.downHeight)/10);this.scrollManipulatorHeight=15>this.scrollManipulatorHeight?15:this.scrollManipulatorHeight;this.scrollManipulatorLimInf=c+this.canvasHeight-this.upHeight-this.downHeight;this.scrollManipulatorLimSup=c+this.downHeight;
this.containerControl.setAttribute("class","DescartesScrollbarContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.style.display=0<this.evaluator.evalExpression(this.drawif)?"block":"none";this.canvas.setAttribute("width",this.w+"px");this.canvas.setAttribute("height",this.canvasHeight+"px");this.canvas.setAttribute("style","position: absolute; left: 0px; top: "+c+
"px;");this.ctx=this.canvas.getContext("2d");this.divDown.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+this.w+"px; height : "+this.upHeight+"px; left: 0px; top: "+(b-this.downHeight)+"px;");this.divUp.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+this.w+"px; height : "+this.downHeight+"px; left: 0px; top: "+this.labelHeight+"px;");this.scrollManipulator.setAttribute("style",
"background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+this.w+"px; height : "+this.scrollManipulatorHeight+"px; left: 0px; top: "+this.scrollManipulatorLimInf+"px;");this.field.setAttribute("type","text");this.field.setAttribute("id",this.id+"scrollbar");this.field.value=d;this.field.setAttribute("class","DescartesScrollbarField");this.field.setAttribute("style","font-size: "+this.fieldFontSize+"px; width : "+this.w+"px; height : "+c+"px; left: 0px; top: 0px;");
this.field.disabled=0<this.evaluator.evalExpression(this.activeif)?!1:!0;this.label.setAttribute("class","DescartesScrollbarLabel");this.label.setAttribute("style","font-size:"+this.fieldFontSize+"px; width: "+this.w+"px; height: "+this.labelHeight+"px; left: 0px; top: "+b+"px;");this.txtLabel=document.createTextNode(this.name)};a.Scrollbar.prototype.initHorizontal=function(d){this.fieldFontSize=e(this.h-0.25*this.h);var c=a.getTextWidth(d+"0",this.fieldFontSize+"px Arial");this.labelWidth=a.getTextWidth(this.name,
this.fieldFontSize+"px Arial");""==this.name&&(this.labelWidth=0);this.visible||(c=0);for(var b=this.w-c-this.labelWidth;58>b&&0<this.labelWidth;)this.labelWidth--,b++;for(;58>b&&0<c;)c--,b++;var g=this.labelWidth,f=g+b,c=this.w-f;this.canvasWidth=b;this.downWidth=this.upWidth=15;this.scrollManipulatorWidth=parseInt((this.canvasWidth-this.upWidth-this.downWidth)/10);this.scrollManipulatorWidth=15>this.scrollManipulatorWidth?15:this.scrollManipulatorWidth;this.scrollManipulatorLimInf=g+this.downWidth;
this.scrollManipulatorLimSup=g+this.canvasWidth-this.downWidth-this.scrollManipulatorWidth;this.containerControl.setAttribute("class","DescartesScrollbarContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.style.display=0<this.evaluator.evalExpression(this.drawif)?"block":"none";this.canvas.setAttribute("width",this.canvasWidth+"px");this.canvas.setAttribute("height",
this.h+"px");this.canvas.setAttribute("style","position: absolute; left: "+g+"px; top: 0px;");this.ctx=this.canvas.getContext("2d");this.divUp.setAttribute("style","cursor: pointer; position: absolute; width : "+this.upWidth+"px; height : "+this.h+"px; left: "+(f-this.downWidth)+"px; top: 0px;");this.divDown.setAttribute("style","cursor: pointer; position: absolute; width : "+this.downWidth+"px; height : "+this.h+"px; left: "+this.labelWidth+"px; top: 0px;");this.scrollManipulator.setAttribute("style",
"background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+this.scrollManipulatorWidth+"px; height : "+this.h+"px; left: "+this.scrollManipulatorLimInf+"px; top: 0px;");this.field.setAttribute("type","text");this.field.setAttribute("id",this.id+"scrollbar");this.field.value=d;this.field.setAttribute("class","DescartesScrollbarField");this.field.setAttribute("style","font-size: "+this.fieldFontSize+"px; width : "+c+"px; height : "+(this.h-2)+"px; left: "+(this.canvasWidth+
this.labelWidth)+"px;");this.field.disabled=0<this.evaluator.evalExpression(this.activeif)?!1:!0;this.label.setAttribute("class","DescartesScrollbarLabel");this.label.setAttribute("style","font-size:"+this.fieldFontSize+"px; width: "+this.labelWidth+"px; height: "+this.h+"px;");this.txtLabel=document.createTextNode(this.name)};a.Scrollbar.prototype.update=function(){var a=this.evaluator,c=!1,b=!1,e=!1,f=!1;this.incr=0==a.evalExpression(this.decimals)?1:(a.evalExpression(this.max)-a.evalExpression(this.min))/
100;this.field.disabled=0<a.evalExpression(this.activeif)?!1:!0;0<a.evalExpression(this.drawif)?(this.containerControl.style.display="block",this.draw()):this.containerControl.style.display="none";var h=a.evalExpression(this.expresion),c=this.x!=h[0][0],b=this.y!=h[0][1];this.x=h[0][0];this.y=h[0][1];4==h[0].length&&(e=this.w!=h[0][2],f=this.h!=h[0][3],this.w=h[0][2],this.h=h[0][3]);this.value=this.validateValue(a.getVariable(this.id));this.field.value=this.formatOutputValue(this.value);if(e||f||
c||b)this.init(),this.draw();a.setVariable(this.id,this.value);this.draw()};a.Scrollbar.prototype.createGradient=function(a,c){this.linearGradient=this.ctx.createLinearGradient(0,0,0,c);for(var b=c*c,g,f=0;f<c;f++)g=e(f-40*c/100),this.linearGradient.addColorStop(f/c,"rgba(0,0,0,"+192*g*g/b/255+")")};a.Scrollbar.prototype.draw=function(){var a=this.ctx;if("horizontal"==this.orientation){var c=e(this.h),b=e(this.upWidth),g=e(this.canvasWidth-this.upWidth);a.clearRect(0,0,this.canvasWidth,this.h);a.strokeStyle=
"#7a8a99";a.strokeRect(0,0,b+0.5,c);a.strokeRect(g+0.5,0,b,c);var f=4;a.fillStyle=this.up?"black":"#333333";a.beginPath();a.moveTo(f,c/2);a.lineTo(b-f,c/2-7);a.lineTo(b-f,c/2+7);a.closePath();a.moveTo(g+1+b-f,c/2);a.lineTo(g+1+f,c/2-7);a.lineTo(g+1+f,c/2+7);a.closePath();a.fill();a.strokeRect(0,0.5,this.canvasWidth+0.5,c-1);f=e(this.pos-this.labelWidth);a.fillStyle="#ccdcec";a.fillRect(f+0.5,0,e(this.scrollManipulatorWidth),c);a.strokeStyle="#6382bf";a.strokeRect(f+0.5,0,e(this.scrollManipulatorWidth),
c);b=e(this.scrollManipulatorWidth/2);a.beginPath();a.moveTo(f+b+0.5-2,3);a.lineTo(f+b+0.5-2,c-3);a.moveTo(f+b+0.5,3);a.lineTo(f+b+0.5,c-3);a.moveTo(f+b+0.5+2,3);a.lineTo(f+b+0.5+2,c-3)}else c=e(this.w),b=e(this.upHeight),g=e(this.canvasHeight-this.upHeight),a.clearRect(0,0,this.w,this.canvasHeight),a.strokeStyle="#7a8a99",a.strokeRect(0.5,2.5,c-0.5,b),a.strokeRect(0.5,g-0.5,c-0.5,b),f=4,a.fillStyle=this.down?"black":"#333333",a.beginPath(),a.moveTo(c/2,f+2),a.lineTo(c/2-7,b-f+2),a.lineTo(c/2+7,b-
f+2),a.closePath(),a.moveTo(c/2,g+b-f),a.lineTo(c/2-7,g+f),a.lineTo(c/2+7,g+f),a.closePath(),a.fill(),a.strokeRect(0.5,1.5,c-0.5,this.canvasHeight-1.5),f=e(this.pos-this.labelHeight),a.fillStyle="#ccdcec",a.fillRect(0,f+0.5,this.w,e(this.scrollManipulatorHeight)),a.strokeStyle="#6382bf",a.strokeRect(0,f+0.5,this.w,e(this.scrollManipulatorHeight)),b=e(this.scrollManipulatorHeight/2),a.beginPath(),a.moveTo(3,f+b+0.5-2),a.lineTo(c-3,f+b+0.5-2),a.moveTo(3,f+b+0.5),a.lineTo(c-3,f+b+0.5),a.moveTo(3,f+b+
0.5+2),a.lineTo(c-3,f+b+0.5+2);a.stroke()};a.Scrollbar.prototype.validateValue=function(a){var c=this.evaluator,a=a.toString();(a=parseFloat(a.replace(this.parent.decimal_symbol,".")))||(a=0);this.minimo=c.evalExpression(this.min);a<this.minimo&&(this.value=null,a=this.minimo);this.maximo=c.evalExpression(this.max);a>this.maximo&&(this.value=null,a=this.maximo);var b=this.incr,a=0!=b?a*b/b:0;this.fixed&&(a=parseFloat(parseFloat(a).toFixed(c.evalExpression(this.decimals))));return a};a.Scrollbar.prototype.formatOutputValue=
function(a){var c=a+"",b=this.evaluator.evalExpression(this.decimals),e=c.indexOf(".");-1!=e&&c.substring(e+1).length>b&&(c=parseFloat(c).toFixed(b));this.fixed&&(c=parseFloat(a).toFixed(b));this.exponentialif&&(c=c.toExponential(b),c=c.toUpperCase(),c=c.replace("+",""));return c=c.replace(".",this.parent.decimal_symbol)};a.Scrollbar.prototype.increase=function(){this.changeValue(parseFloat(this.value)+this.incr)};a.Scrollbar.prototype.decrease=function(){this.changeValue(parseFloat(this.value)-this.incr)};
a.Scrollbar.prototype.increase10=function(){var a=(this.evaluator.evalExpression(this.max)-this.evaluator.evalExpression(this.min))/10;"horizontal"==this.orientation?this.clickPos.x>this.prePos&&this.changeValue(parseFloat(this.value)+a):this.clickPos.y<this.prePos&&this.changeValue(parseFloat(this.value)+a)};a.Scrollbar.prototype.decrease10=function(){var a=(this.evaluator.evalExpression(this.max)-this.evaluator.evalExpression(this.min))/10;"horizontal"==this.orientation?this.clickPos.x<this.prePos&&
this.changeValue(parseFloat(this.value)-a):this.clickPos.y>this.prePos&&this.changeValue(parseFloat(this.value)-a)};a.Scrollbar.prototype.changeValue=function(a){0<this.evaluator.evalExpression(this.activeif)&&(a=this.validateValue(a),a!=this.value&&(this.value=a,this.field.value=this.formatOutputValue(a),this.changeScrollPositionFromValue(),this.prePos=this.pos,this.evaluator.setVariable(this.id,this.value),this.parent.updateControls(),this.actionExec.execute(),this.parent.updateControls(),"animate"!=
this.action&&this.parent.update()))};a.Scrollbar.prototype.changeValueForScrollMovement=function(){var a=this.evaluator,c=this.scrollManipulatorLimInf,b=this.scrollManipulatorLimSup,g=a.evalExpression(this.min),f=a.evalExpression(this.max),h=this.incr,c=e((this.pos-c)*(f-g)/(b-c)/h)*h+g;c!=this.value&&(this.value=c,this.field.value=this.formatOutputValue(c),a.setVariable(this.id,this.value),this.parent.updateControls(),this.actionExec.execute(),this.parent.update())};a.Scrollbar.prototype.changeScrollPositionFromValue=
function(){var a=this.evaluator,c=this.scrollManipulatorLimInf,b=this.scrollManipulatorLimSup,e=a.evalExpression(this.min),a=a.evalExpression(this.max);this.pos=(this.value-e)*(b-c)/(a-e)+c;"horizontal"==this.orientation?this.scrollManipulator.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+this.scrollManipulatorWidth+"px; height : "+this.h+"px; left: "+this.pos+"px; top: 0px;"):this.scrollManipulator.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+
this.w+"px; height : "+this.scrollManipulatorHeight+"px; left: 0px; top: "+this.pos+"px;")};a.Scrollbar.prototype.registerMouseEvents=function(){function d(a,b,c,f){(n.up||n.down||n.canvasClick)&&1.0E-7<Math.abs(n.value-f)?(b.call(n),a=c?a:30,u=setTimeout(function(){d(a,b,!1,f)},a)):clearInterval(u)}function c(a){a.preventDefault();n.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"LEFT"==n.whichButton&&0<n.evaluator.evalExpression(n.activeif)&&
(n.clickPos=n.getCursorPosition(a),n.canvasClick=!0,"horizontal"==n.orientation?n.clickPos.x<n.prePos?d(v,n.decrease10,!0,n.minimo):d(v,n.increase10,!0,n.maximo):n.clickPos.y<n.prePos?d(v,n.increase10,!0,n.maximo):d(v,n.decrease10,!0,n.minimo))}function b(a){n.canvasClick=!1;clearInterval(u);a.preventDefault()}function e(a){!0==n.canvasClick&&(n.clickPos=n.getCursorPosition(a),a.preventDefault())}function f(a){0<n.evaluator.evalExpression(n.activeif)&&(n.scrollClick=!0,n.initPos=n.getCursorPosition(a),
window.addEventListener("mouseup",i,!1),window.addEventListener("mousemove",k,!1),a.preventDefault())}function h(a){0<n.evaluator.evalExpression(n.activeif)&&(n.scrollClick=!0,n.initPos=n.getCursorPosition(a),window.addEventListener("touchend",j,!1),window.addEventListener("touchmove",onToucheMove_scrollManipulator,!1),a.preventDefault())}function i(a){n.scrollClick=!1;n.prePos=n.pos;window.removeEventListener("mouseup",i,!1);window.removeEventListener("mousemove",k,!1);a.preventDefault()}function j(a){n.scrollClick=
!1;n.prePos=n.pos;window.removeEventListener("touchend",j,!1);window.removeEventListener("touchmove",k,!1);a.preventDefault()}function k(a){var b=n.getCursorPosition(a);"horizontal"==n.orientation?(n.pos=n.prePos-(n.initPos.x-b.x),n.pos<n.scrollManipulatorLimInf&&(n.pos=n.scrollManipulatorLimInf),n.pos>n.scrollManipulatorLimSup&&(n.pos=n.scrollManipulatorLimSup),n.scrollManipulator.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+n.scrollManipulatorWidth+
"px; height : "+n.h+"px; left: "+n.pos+"px; top: 0px;")):(n.pos=n.prePos-(n.initPos.y-b.y),n.pos>n.scrollManipulatorLimInf&&(n.pos=n.scrollManipulatorLimInf),n.pos<n.scrollManipulatorLimSup&&(n.pos=n.scrollManipulatorLimSup),n.scrollManipulator.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+n.w+"px; height : "+n.scrollManipulatorHeight+"px; left: 0px; top: "+n.pos+"px;"));n.changeValueForScrollMovement();a.preventDefault()}function l(a){a.preventDefault();
n.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"LEFT"==n.whichButton&&0<n.evaluator.evalExpression(n.activeif)&&(n.up=!0,d(v,n.increase,!0,n.maximo))}function m(a){a.preventDefault();n.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"LEFT"==n.whichButton&&0<n.evaluator.evalExpression(n.activeif)&&(n.down=!0,d(v,n.decrease,!0,n.minimo))}function o(a){n.up=!1;
clearInterval(u);a.preventDefault()}function q(a){n.down=!1;clearInterval(u);a.preventDefault()}function p(a){n.up=!1;clearInterval(u);a.preventDefault()}function r(a){n.down=!1;clearInterval(u);a.preventDefault()}var n=this,t=a.hasTouchSupport,v=t?500:200,u;this.canvas.oncontextmenu=function(){return!1};this.divUp.oncontextmenu=function(){return!1};this.divDown.oncontextmenu=function(){return!1};this.field.addEventListener("keydown",function(a){13==a.keyCode&&n.changeValue(n.field.value)},!1);t?
this.canvas.addEventListener("touchstart",c,!1):this.canvas.addEventListener("mousedown",c,!1);t||this.divDown.addEventListener("mouseout",q,!1);t?window.addEventListener("touchend",b,!1):window.addEventListener("mouseup",b,!1);t?this.canvas.addEventListener("touchmove",e,!1):this.canvas.addEventListener("mousemove",e,!1);t?this.scrollManipulator.addEventListener("touchstart",h,!1):this.scrollManipulator.addEventListener("mousedown",f,!1);t?this.divUp.addEventListener("touchstart",l,!1):this.divUp.addEventListener("mousedown",
l,!1);t?this.divDown.addEventListener("touchstart",m,!1):this.divDown.addEventListener("mousedown",m,!1);t||this.divUp.addEventListener("mouseout",o,!1);t||this.divDown.addEventListener("mouseout",q,!1);t?window.addEventListener("touchend",p,!1):window.addEventListener("mouseup",p,!1);t?window.addEventListener("touchend",r,!1):window.addEventListener("mouseup",r,!1)};a.Scrollbar.prototype.getCursorPosition=function(d){d=a.getCursorPosition(d);return{x:d.x-(this.containerControl.offsetLeft+this.containerControl.parentNode.offsetLeft),
y:d.y-(this.containerControl.offsetTop+this.containerControl.parentNode.offsetTop)}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Audio=function(e,d){a.Control.call(this,e,d);var c=this.getContainer(),b=this.evaluator.evalExpression(this.expresion);4==b[0].length?(this.w=b[0][2],this.h=b[0][3]):(this.w=100,this.h=28);if(b=navigator.userAgent.toLowerCase().match("firefox")&&!0)this.audioContainer=document.createElement("div"),this.audioContainer.setAttribute("style","overflow: hidden; position: absolute; width: "+
this.w+"px; height: 35px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.audio=this.parent.getAudio(this.file);this.autoplay&&(this.audio.setAttribute("autoplay","autoplay"),this.audio.play());this.loop&&this.audio.setAttribute("loop","loop");this.audio.setAttribute("controls","controls");b?(this.audio.setAttribute("style","position: absolute; width: "+this.w+"px; height: 100px; left: 0px; top: -65px;"),this.audioContainer.appendChild(this.audio)):this.audio.setAttribute("style",
"position: absolute; width: "+this.w+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");c.childNodes[0]?b?c.insertBefore(this.audioContainer,c.childNodes[0]):c.insertBefore(this.audio,c.childNodes[0]):b?c.appendChild(this.audioContainer):c.appendChild(this.audio)};a.extend(a.Audio,a.Control);a.Audio.prototype.update=function(){var a=this.evaluator;0<a.evalExpression(this.drawif)?this.audio.style.display="block":(this.audio.style.display="none",this.audio.pause());a=a.evalExpression(this.expresion);
this.x=a[0][0];this.y=a[0][1];4==a[0].length&&(this.w=a[0][2],this.h=a[0][3])};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Video=function(e,d){a.Control.call(this,e,d);var c=this.evaluator,b=this.getContainer(),g=this.evaluator.evalExpression(this.expresion);4==g[0].length?(this.w=g[0][2],this.h=g[0][3]):this.h=this.w=null;this.video=document.createElement("video");0<c.evalExpression(this.drawif)?this.video.style.display="block":(this.video.style.display="none",this.video.pause());
this.autoplay&&this.video.setAttribute("autoplay","autoplay");this.loop&&this.video.setAttribute("loop","loop");this.video.setAttribute("controls","controls");this.poster&&this.video.setAttribute("poster",this.poster);this.w&&(this.video.setAttribute("width",this.w),this.video.setAttribute("height",this.h));this.video.setAttribute("style","position: absolute; overflow: hidden; left: "+this.x+"px; top: "+this.y+"px;");c=this.file;g=this.file.lastIndexOf(".");-1!=g&&(c=this.file.substring(0,g));g=document.createElement("source");
g.setAttribute("src",c+".ogg");g.setAttribute("type","video/ogg");this.video.appendChild(g);g=document.createElement("source");g.setAttribute("src",c+".mp4");g.setAttribute("type","video/mp4");this.video.appendChild(g);g=document.createElement("source");g.setAttribute("src",c+".webm");g.setAttribute("type","video/webm");this.video.appendChild(g);b.childNodes[0]?b.insertBefore(this.video,b.childNodes[0]):b.appendChild(this.video)};a.extend(a.Video,a.Control);a.Video.prototype.update=function(){var a=
this.evaluator;0<a.evalExpression(this.drawif)?this.video.style.display="block":(this.video.style.display="none",this.video.pause());a=a.evalExpression(this.expresion);this.x=a[0][0];this.y=a[0][1];4==a[0].length&&(this.w=a[0][2],this.h=a[0][3])};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=Math.floor;a.TextArea=function(d,c){a.Control.call(this,d,c);this.region="interior";this.tabindex=++this.parent.tabindex;this.answer&&this.answer.match("krypto_")&&(this.answer=
(new a.Krypto).decode(this.answer.substring(7)));var b=this.getContainer();this.containerControl=document.createElement("div");this.textArea=document.createElement("div");this.textAreaAnswer=document.createElement("div");this.showButton=document.createElement("div");this.activeCover=document.createElement("div");this.containerControl.appendChild(this.textArea);this.containerControl.appendChild(this.textAreaAnswer);this.containerControl.appendChild(this.showButton);this.containerControl.appendChild(this.activeCover);
b.childNodes[0]?b.insertBefore(this.containerControl,b.childNodes[0]):b.appendChild(this.containerControl);this.showAnswer=!1;this.text=void 0==this.text.type?this.rawText:this.text.hasFormula?this.rawText:this.text.toHTML();b=this.parent.lessonParser.parseText(this.answer);void 0!=b.type&&!this.text.hasFormula&&(this.answer=b.toHTML());this.evaluator.setVariable(this.id,this.text);this.drawButton();this.init();this.registerMouseEvents()};a.extend(a.TextArea,a.Control);a.TextArea.prototype.init=function(){var d=
this.answer?28:8;evaluator=this.evaluator;this.text=evaluator.getVariable(this.id);this.containerControl.setAttribute("class","DescartesTextAreaContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.style.display=0<evaluator.evalExpression(this.drawif)?"block":"none";this.containerControl.setAttribute("spellcheck","false");this.textArea.setAttribute("class","DescartesTextAreaContainer");
this.textArea.setAttribute("style","width: "+(this.w-8)+"px; height: "+(this.h-d)+"px; left: 4px; top: 4px; background-color: white; text-align: left; font: "+a.convertFont(this.font)+";");this.textArea.setAttribute("contenteditable","true");this.textArea.innerHTML="<span style='position: relative; top: 10px; left: 10px; white-space: nowrap;' >"+this.text+"</span>";this.textAreaAnswer.setAttribute("class","DescartesTextAreaContainer");this.textAreaAnswer.setAttribute("style","width: "+(this.w-8)+
"px; height: "+(this.h-d)+"px; left: 4px; top: 4px; background-color: white; text-align: left; font: "+a.convertFont(this.font)+";");this.textAreaAnswer.style.display=this.showAnswer?"block":"none";this.textAreaAnswer.innerHTML="<span style='position: relative; top: 10px; left: 10px; white-space: nowrap;'>"+this.answer+"</span>";this.showButton.setAttribute("style","width: 20px; height: 16px; position: absolute; bottom: 4px; right: 4px; cursor: pointer;");this.showButton.style.backgroundImage="url("+
this.imageUnPush+")";this.showButton.innerHTML="<span style='position: relative; top: 2px; text-align: center; font: 9px Arial'> S </span>";this.activeCover.setAttribute("style","position: absolute; width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px;");this.activeCover.style.display=0<evaluator.evalExpression(this.activeif)?"none":"block"};a.TextArea.prototype.drawButton=function(){var d=document.createElement("canvas");d.setAttribute("width",20);d.setAttribute("height",
16);for(var c=d.getContext("2d"),b=c.createLinearGradient(0,0,0,16),g,f=0;16>f;f++)g=e(f-5.6),b.addColorStop(f/16,"rgba(0,0,0,"+192*g*g/256/255+")");c.lineWidth=1;c.fillStyle="white";c.fillRect(0,0,20,16);c.fillStyle=b;c.fillRect(0,0,20,16);a.drawLine(c,19,0,19,16,"rgba(0,0,0,"+128/255+")");a.drawLine(c,0,0,0,16,"rgba(0,0,0,"+24/255+")");a.drawLine(c,1,0,1,16,"rgba(0,0,0,"+8/255+")");this.imageUnPush=d.toDataURL();c.fillStyle="white";c.fillRect(0,0,20,16);c.fillStyle=b;c.fillRect(0,0,20,16);a.drawLine(c,
0,0,0,14,"gray");a.drawLine(c,0,0,19,0,"gray");c.fillStyle="rgba(0, 0, 0,"+24/255+")";c.fillRect(0,0,this.w,this.h);this.imagePush=d.toDataURL()};a.TextArea.prototype.update=function(){evaluator=this.evaluator;evaluator.setVariable(this.id,this.text);var a=!1,c=!1,b=!1,e=!1;this.activeCover.style.display=0<evaluator.evalExpression(this.activeif)?"none":"block";this.containerControl.style.display=0<evaluator.evalExpression(this.drawif)?"block":"none";var f=evaluator.evalExpression(this.expresion),
a=this.x!=f[0][0],c=this.y!=f[0][1];this.x=f[0][0];this.y=f[0][1];4==f[0].length&&(b=this.w!=f[0][2],e=this.h!=f[0][3],this.w=f[0][2],this.h=f[0][3]);(b||e||a||c)&&this.init()};a.TextArea.prototype.registerMouseEvents=function(){function a(b){b.preventDefault();c.showButton.style.backgroundImage="url("+c.imageUnPush+")"}var c=this;this.showButton.addEventListener("mousedown",function(a){a.preventDefault();c.showAnswer=!c.showAnswer;c.textAreaAnswer.style.display=c.showAnswer?"block":"none";c.showButton.childNodes[0].childNodes[0].textContent=
c.showAnswer?"T":"S";c.showButton.style.backgroundImage="url("+c.imagePush+")"});this.showButton.addEventListener("mouseup",a);this.showButton.addEventListener("mouseout",a)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.LessonParser=function(a){this.parent=a;this.parser=this.parent.evaluator.parser};a.LessonParser.prototype.parseButtonsConfig=function(a){for(var d={rowsNorth:0,rowsSouth:0,widthEast:125,widthWest:125,height:23},a=this.split(a),c,b,g=0,f=a.length;g<f;g++)switch(c=
a[g][0],b=a[g][1],babel[c]){case "rowsNorth":d.rowsNorth=parseInt(b);break;case "rowsSouth":d.rowsSouth=parseInt(b);break;case "widthEast":d.widthEast=parseInt(b);break;case "widthWest":d.widthWest=parseInt(b);break;case "height":d.height=parseInt(b);break;case "about":d.about="true"==babel[b];break;case "config":d.config="true"==babel[b];break;case "init":d.init="true"==babel[b];break;case "clear":d.clear="true"==babel[b];break;default:console.log("----- attributo de Espacio no identificado: <"+
c+"> valor: <"+b+"> -----")}return d};a.LessonParser.prototype.parseSpace=function(e){for(var d={},c,e=this.split(e),b,g=0,f=e.length;g<f;g++)switch(c=e[g][0],b=e[g][1],babel[c]){case "type":d.type=b;break;case "id":d.id=b;break;case "x":c=b;c="%"==c[c.length-1]?(this.parent.container.width*parseFloat(c)/100).toString():b;d.xExpr=this.parser.parse(c);break;case "y":c=b;c="%"==c[c.length-1]?(this.parent.container.height*parseFloat(c)/100).toString():b;d.yExpr=this.parser.parse(c);break;case "width":c=
b;"%"==c[c.length-1]?c=this.parent.container.width*parseFloat(c)/100:(c=parseFloat(b),c!=b&&(c=this.parent.container.width));d.w=c;break;case "height":c=b;"%"==c[c.length-1]?c=this.parent.container.height*parseFloat(c)/100:(c=parseFloat(b),c!=b&&(c=this.parent.container.height));d.h=c;break;case "drawif":d.drawif=this.parser.parse(b);break;case "fixed":d.fixed="true"==babel[b];break;case "scale":c=parseFloat(b);c!=b&&(c=48);d.scale=c;break;case "O.x":d.OxExpr=b;break;case "O.y":d.OyExpr=b;break;case "image":d.imageSrc=
b;break;case "bg_display":d.bg_display=babel[b];break;case "background":d.background=this.convertColor(b);break;case "net":d.net="false"==babel[b]?"":this.convertColor(b);break;case "net10":d.net10="false"==babel[b]?"":this.convertColor(b);break;case "axes":d.axes="false"==babel[b]?"":this.convertColor(b);break;case "text":d.text="false"==babel[b]?"":this.convertColor(b);break;case "numbers":d.numbers="true"==babel[b];break;case "x-axis":d.x_axis=b;break;case "y-axis":d.y_axis=b;break;case "sensitive_to_mouse_movements":d.sensitive_to_mouse_movements=
"true"==babel[b];break;case "cID":d.cID=b;break;case "R3":d.R3="true"==babel[b];break;case "render":d.render=babel[b];break;case "split":d.split="true"==babel[b];break;case "file":d.file=b;break;default:console.log("----- attributo de Espacio no identificado: <"+c+"> valor: <"+b+"> -----")}if("R2"==d.type||2==this.parent.version)return new a.Space2D(this.parent,d);if("R3"==d.type)return new a.Space3D(this.parent,d);if("AP"==d.type)return new a.SpaceAP(this.parent,d);if("HTMLIFrame"==d.type)return new a.SpaceHTML_IFrame(this.parent,
d)};a.LessonParser.prototype.parseControl=function(e){for(var d={},e=this.split(e),c,b,g=0,f=e.length;g<f;g++)switch(c=e[g][0],b=e[g][1],babel[c]){case "id":d.id=b;break;case "type":d.type=babel[b];break;case "gui":d.gui=babel[b];break;case "region":d.region=babel[b];break;case "space":d.spaceID=b;break;case "name":d.name=b;break;case "expresion":d.expresion=this.parser.parse(b.replace(")(",","));break;case "fixed":d.fixed="true"==babel[b];break;case "visible":d.visible="true"==babel[b];break;case "color":d.color=
this.convertColor(b);break;case "colorInt":d.colorInt=this.convertColor(b);break;case "bold":"false"!=babel[b]&&(d.bold="bold");break;case "italics":"false"!=babel[b]&&(d.italics="italic");break;case "underlined":"false"!=babel[b]&&(d.underlined=!0);break;case "font_size":d.font_size=this.parser.parse(b);break;case "image":d.imageSrc=b;break;case "action":d.action=babel[b];break;case "parameter":d.parameter=b;break;case "drawif":d.drawif=this.parser.parse(b);break;case "activeif":d.activeif=this.parser.parse(b);
break;case "tooltip":d.tooltip=b;break;case "tooltipFont":d.tooltipFont=b;break;case "Explanation":d.Explanation=b;break;case "ExplanationFont":d.ExplanationFont=b;break;case "msg_pos":d.msg_pos=babel[b];break;case "cID":d.cID=b;break;case "value":c=b.replace(/&squot;/g,"'");c.match(/^\|/)&&(c="'"+c.substring(1),c.match(/\|$/)&&(c=c.substring(0,c.length-1)+"'"));d.valueExpr=this.parser.parse(c);break;case "decimals":d.decimals=this.parser.parse(b);break;case "min":d.min=this.parser.parse(b);break;
case "max":d.max=this.parser.parse(b);break;case "incr":d.incr=this.parser.parse(b);break;case "discrete":d.discrete="true"==babel[b];break;case "onlyText":d.onlyText="true"==babel[b];break;case "evaluate":d.evaluate="true"==babel[b];break;case "answer":d.answer=b;break;case "exponentialif":d.exponentialif=parseFloat(b);break;case "size":d.size=this.parser.parse(b);break;case "constraint":d.constraintExpr=b;break;case "text":d.rawText=b;c=this.parseText(b);b=0;for(var h=c.length;b<h;b++)c[b]=this.parser.parse(c[b],
!1);d.text=c;break;case "trace":d.trace=this.convertColor(b);break;case "options":d.options=b;break;case "font":d.font=b;break;case "file":d.file=b;break;case "autoplay":d.autoplay="true"==babel[b];break;case "loop":d.loop="true"==babel[b];break;case "controls":d.controls="true"==babel[b];break;case "poster":d.poster=babel[b];break;default:var i=c.indexOf("."),h=babel[c.substring(0,i)],i=babel[c.substring(i+1)];if("parameter"==h&&"font"==i){d.parameterFont=b;break}else if("Explanation"==h&&"font"==
i){d.ExplanationFont=b;break}else if("tooltip"==h&&"font"==i){d.tooltipFont=b;break}console.log("----- attributo de control no identificado: <"+c+"> valor: <"+b+"> -----")}if("numeric"==d.type){if(void 0==d.gui||"spinner"==d.gui)return new a.Spinner(this.parent,d);if("button"==d.gui)return new a.Button(this.parent,d);if("textfield"==d.gui)return new a.TextField(this.parent,d);if("menu"==d.gui)return new a.Menu(this.parent,d);if("scrollbar"==d.gui)return new a.Scrollbar(this.parent,d)}else{if("video"==
d.type)return new a.Video(this.parent,d);if("audio"==d.type)return new a.Audio(this.parent,d);if("graphic"==d.type)return new a.GraphicControl(this.parent,d);if("text"==d.type)return new a.TextArea(this.parent,d)}};a.LessonParser.prototype.parseGraphic=function(e,d,c,b){for(var b={rotateExp:b,parameter:"t"},e=this.split(e),g,f,h=0,i=e.length;h<i;h++)switch(g=e[h][0],f=e[h][1],babel[g]){case "space":b.spaceID=f;break;case "type":b.type=babel[f];break;case "background":b.background="true"==babel[f];
break;case "color":b.color=this.convertColor(f);break;case "drawif":b.drawif=this.parser.parse(f);break;case "abs_coord":b.abs_coord="true"==babel[f];break;case "expresion":"macro"!=b.type?(b.expresion=this.parser.parse(f),b.expresionString=f):b.expresion=f;break;case "trace":b.trace=this.convertColor(f);break;case "family":b.family=f;break;case "parameter":b.parameter=f;break;case "fill":b.fill=this.convertColor(f);break;case "fillP":b.fillP=this.convertColor(f);break;case "fillM":b.fillM=this.convertColor(f);
break;case "width":b.width=this.parser.parse(f);break;case "visible":b.visible="true"==babel[f];break;case "editable":b.editable="true"==babel[f];break;case "info":b.info=f;break;case "text":g=this.parseText(f);f=0;for(var j=g.length;f<j;f++)g[f]=this.parser.parse(g[f],!1);b.text=g;break;case "font":b.font=f;break;case "fixed":b.fixed="true"==babel[f];break;case "decimals":b.decimals=this.parser.parse(f);break;case "size":b.size=this.parser.parse(f);break;case "spear":b.spear=this.parser.parse(f);
break;case "arrow":b.arrow=this.convertColor(f);break;case "center":b.center=this.parser.parse(f);break;case "radius":b.radius=this.parser.parse(f);break;case "init":b.init=this.parser.parse(f);break;case "end":b.end=this.parser.parse(f);break;case "vectors":b.vectors="true"==babel[f];break;case "file":g=f.replace(/&squot;/g,"'");"["==g.charAt(0)&&"]"==g.charAt(g.length-1)&&(g=g.substring(1,g.length-1));g.match(/.jpg$|.png$|.gif$|.svg$/)&&(g="'"+g+"'");b.file=this.parser.parse(g);break;case "inirot":b.inirot=
this.parser.parse(f);break;case "opacity":b.opacity=this.parser.parse(f);break;case "inipos":b.inipos=this.parser.parse(f);break;case "name":b.name=f;break;case "range":b.range=this.parser.parse(f);break;case "border":"false"!=babel[f]&&(b.border=this.convertColor(f));break;case "align":b.align=babel[f];break;default:if(void 0!=b.family&&g.substring(0,b.family.length+1)==b.family+"."){switch(babel[g.substring(b.family.length+1)]){case "interval":b.family_interval=this.parser.parse(f);break;case "steps":b.family_steps=
this.parser.parse(f)}break}if(void 0!=b.parameter&&g.substring(0,b.parameter.length+1)==b.parameter+"."){switch(babel[g.substring(b.parameter.length+1)]){case "interval":b.parameter_interval=this.parser.parse(f);break;case "steps":b.parameter_steps=this.parser.parse(f)}break}console.log("----- attributo del grafico no identificado: <"+g+"> valor: <"+f+"> -----")}d&&(b.abs_coord=d);c&&(b.background=c);if("equation"==b.type)return new a.Equation(this.parent,b);if("curve"==b.type)return new a.Curve(this.parent,
b);if("sequence"==b.type)return new a.Sequence(this.parent,b);if("point"==b.type)return new a.Point(this.parent,b);if("segment"==b.type)return new a.Segment(this.parent,b);if("arrow"==b.type)return new a.Arrow(this.parent,b);if("polygon"==b.type)return new a.Polygon(this.parent,b);if("arc"==b.type)return new a.Arc(this.parent,b);if("text"==b.type)return new a.Text(this.parent,b);if("image"==b.type)return new a.Image(this.parent,b);if("macro"==b.type)return new a.Macro(this.parent,b)};a.LessonParser.prototype.parse3DGraphic=
function(e,d,c,b){for(var d={rotateExp:b,parameter:"t"},e=this.split(e),g,f,c=0,b=e.length;c<b;c++)switch(g=e[c][0],f=e[c][1],babel[g]){case "space":d.spaceID=f;break;case "type":d.type=babel[f];break;case "background":d.background="true"==babel[f];break;case "color":d.color=this.convertColor(f);break;case "drawif":d.drawif=this.parser.parse(f);break;case "expresion":"macro"!=d.type&&"curve"!=d.type&&"surface"!=d.type?(d.expresion=this.parser.parse(f),d.expresionString=f):d.expresion=f;break;case "family":d.family=
f;break;case "parameter":d.parameter=f;break;case "width":d.width=this.parser.parse(f);break;case "length":d.length=this.parser.parse(f);break;case "text":g=this.parseText(f);f=0;for(var h=g.length;f<h;f++)g[f]=this.parser.parse(g[f],!1);d.text=g;break;case "font":d.font=f;break;case "fixed":d.fixed="true"==babel[f];break;case "decimals":d.decimals=this.parser.parse(f);break;case "model":d.model=babel[f];break;case "edges":d.edges="true"==babel[f];break;case "Nu":d.Nu=this.parser.parse(f);break;case "Nv":d.Nu=
this.parser.parse(f);break;case "name":d.name=f;break;case "backcolor":d.backcolor=this.convertColor(f);break;case "inirot":d.inirot=this.parser.parse(f);break;case "endrot":d.endrot=this.parser.parse(f);break;case "inipos":d.inipos=this.parser.parse(f);break;case "endpos":d.endpos=this.parser.parse(f);break;default:if(void 0!=d.family&&g.substring(0,d.family.length+1)==d.family+"."){switch(babel[g.substring(d.family.length+1)]){case "interval":d.family_interval=this.parser.parse(f);break;case "steps":d.family_steps=
this.parser.parse(f)}break}if(void 0!=d.parameter&&g.substring(0,d.parameter.length+1)==d.parameter+"."){switch(babel[g.substring(d.parameter.length+1)]){case "interval":d.parameter_interval=this.parser.parse(f);break;case "steps":d.parameter_steps=this.parser.parse(f)}break}console.log("----- attributo del grafico no identificado: <"+g+"> valor: <"+f+"> -----")}if("point"==d.type)return new a.Point3D(this.parent,d);if("segment"==d.type)return new a.Segment3D(this.parent,d);if("polygon"==d.type)return new a.Polygon3D(this.parent,
d);if("curve"==d.type)return new a.Curve3D(this.parent,d);if("triangle"==d.type)return new a.Triangle3D(this.parent,d);if("face"==d.type)return new a.Face3D(this.parent,d);if("polireg"==d.type)return new a.Polireg3D(this.parent,d);if("surface"==d.type)return new a.Surface3D(this.parent,d);if("text"==d.type)return new a.Text3D(this.parent,d);console.log(d.type)};a.LessonParser.prototype.parseAuxiliar=function(e){for(var d={},e=this.split(e),c=0,b=e.length;c<b;c++)e[c][1]=e[c][1].replace(/&squot;/g,
"'");for(var g,f,c=0,b=e.length;c<b;c++)switch(g=e[c][0],f=e[c][1],babel[g]){case "id":d.id=f;break;case "editable":d.editable="true"==babel[f];break;case "constant":d.constant="true"==babel[f];break;case "array":d.array="true"==babel[f];break;case "file":d.file=f;break;case "matrix":d.matrix="true"==babel[f];break;case "rows":d.rows=this.parser.parse(f);break;case "columns":d.columns=this.parser.parse(f);break;case "algorithm":d.algorithm="true"==babel[f];break;case "init":d.init=f;break;case "do":d.doExpr=
f;break;case "while":d.whileExpr=f;break;case "range":d.range=f;break;case "expresion":d.expresion=f;break;case "size":d.size=this.parser.parse(f);break;case "evaluate":d.evaluate=babel[f];break;case "event":d.event=babel[f];break;case "condition":d.condition=f;break;case "execution":d.execution=babel[f];break;case "msg_pos":d.msg_pos=babel[f];break;case "action":d.action=babel[f];break;case "parameter":d.parameter=f;break;case "sequence":d.sequence="true"==babel[f];break;default:var h=g.indexOf("."),
i=babel[g.substring(0,h)],h=babel[g.substring(h+1)];if("parameter"==i&&"font"==h){d.parameterFont=f;break}console.log("----- attributo de auxiliar no identificado: <"+g+"> valor: <"+f+"> -----")}d.sequence?new a.AuxSequence(this.parent,d):d.constant?(e=new a.Constant(this.parent,d),d.evaluate&&"always"==d.evaluate&&this.parent.auxiliaries.push(e)):d.algorithm&&d.evaluate?this.parent.auxiliaries.push(new a.Algorithm(this.parent,d)):d.array&&!d.matrix&&")"!=d.id.charAt(d.id.length-1)?(e=new a.Vector(this.parent,
d),d.evaluate&&"always"==d.evaluate&&this.parent.auxiliaries.push(e)):d.matrix&&")"!=d.id.charAt(d.id.length-1)?(e=new a.Matrix(this.parent,d),d.evaluate&&"always"==d.evaluate&&this.parent.auxiliaries.push(e)):d.event&&")"!=d.id.charAt(d.id.length-1)?this.parent.events.push(new a.Event(this.parent,d)):")"==d.id.charAt(d.id.length-1)?new a.Function(this.parent,d):new a.Variable(this.parent,d)};a.LessonParser.prototype.parseAction=function(e){var d=e.action,c=e.parent,e=e.parameter;if(d)switch(d){case "message":return new a.Message(c,
e);case "calculate":return new a.Calculate(c,e);case "openURL":return new a.OpenURL(c,e);case "openScene":return new a.OpenScene(c,e);case "about":return new a.About(c,e);case "config":return new a.Config(c,e);case "init":return new a.Init(c,e);case "clear":return new a.Clear(c,e);case "animate":return new a.Animate(c,e);case "initAnimation":return new a.InitAnimation(c,e);case "playAudio":return new a.PlayAudio(c,e);default:console.log("----- Accion no soportada aun: <"+d+"> -----")}else return{execute:function(){}}};
a.LessonParser.prototype.parseAnimation=function(e){for(var d={},e=this.split(e),c,b,g=0,f=e.length;g<f;g++)switch(c=e[g][0],b=e[g][1],babel[c]){case "delay":d.delay=b;break;case "controls":d.controls="true"==babel[b];break;case "auto":d.auto="true"==babel[b];break;case "loop":d.loop="true"==babel[b];break;case "init":d.init=b;break;case "do":d.doExpr=b;break;case "while":d.whileExpr=b;break;case "id":d.id=b;break;case "algorithm":d.algorithm="true"==babel[b];break;case "evaluate":d.evaluate="true"==
babel[b];break;default:console.log("----- attributo de la animacion no identificado: <"+c+">  <"+b+"> -----")}return new a.Animation(this.parent,d)};a.LessonParser.prototype.parsePleca=function(e,d){var e=this.split(e),c,b,g,f,h,i,j,k,l;b=c="";g=0;f="white";h="black";i="left";j="";k="SansSerif,PLAIN,22";l="SansSerif,PLAIN,20";for(var m,o,q=0,p=e.length;q<p;q++)switch(m=e[q][0],o=e[q][1],m){case "title":c=o;break;case "subtitle":b=o;break;case "subtitlines":g=o;break;case "bgcolor":f="#"+a.getColor(this.evaluator,
o);break;case "fgcolor":h="#"+a.getColor(this.evaluator,o);break;case "align":i=o;break;case "titleimage":j=o;break;case "titlefont":k=a.convertFont(o);break;case "subtitlefont":l=a.convertFont(o);break;default:console.log("----- attributo de la pleca no identificado: <"+m+">  <"+o+"> -----")}m=l.substring(0,l.indexOf("px"));m=m.substring(m.lastIndexOf(" "));var r,n;""!=j&&(r=this.parent.getImage(j),n=r.height);j=document.createElement("div");j.setAttribute("id","descartesPleca");n?(j.setAttribute("style",
"position: absolute; left: 0px; top: 0px; text-align: "+i+"; width: "+(d-30)+"px; height: "+(n-16)+"px; background: "+f+"; color: "+h+"; padding-top: 8px; padding-bottom: 8px; padding-left: 15px; padding-right: 15px; margin: 0px; overflow: hidden; z-index: 100;"),r.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index: -1; width: 100%; height: 100%"),j.appendChild(r)):j.setAttribute("style","position: absolute; left: 0px; top: 0px; text-align: "+i+"; width: "+(d-30)+"px; background: "+
f+"; color: "+h+"; padding-top: 8px; padding-bottom: 8px; padding-left: 15px; padding-right: 15px; margin: 0px; z-index: 100;");f=document.createElement("div");f.setAttribute("style","padding: 0px; margin: 0px; font: "+k+"; overflow: hidden; white-space: nowrap;");f.innerHTML=c;c=document.createElement("div");if(1==parseInt(g)){h=0;g=document.createElement("div");g.innerHTML=b;document.body.appendChild(g);k=m;do k-=h,g.setAttribute("style","padding: 0px; margin: 0px; font: "+l+"; font-size: "+k+"px; width: "+
(d-30)+"px; line-height: "+k+"px;"),h=g.offsetHeight,i=h/k,h=1;while(1<i&&8<k);document.body.removeChild(g);c.setAttribute("style","padding: 0px; margin: 0px; font: "+l+"; font-size: "+k+"px; line-height: 110%; overflow: hidden; white-space: nowrap;")}else c.setAttribute("style","padding: 0px; margin: 0px; font: "+l+"; line-height: 110%;");c.innerHTML=b;j.appendChild(f);j.appendChild(c);j.imageHeight=n;return j};a.LessonParser.prototype.split=function(a){for(var a=(a||"").replace(/\\'/g,"\u2019"),
d=[],c=0,b=0,g=!1,f=0,h=!1,i=!1;c<a.length;)" "==a.charAt(c)&&!g&&c++," "!=a.charAt(c)&&!g&&(g=!0,f=c),"="==a.charAt(c)&&"'"==a.charAt(c+1)&&!h&&(h=!0,d[b]=[a.substring(f,c)],f=c+2,c+=2),h&&"'"==a.charAt(c)&&(g=h=!1,d[b].push(a.substring(f,c)),b++),"="==a.charAt(c)&&"'"!=a.charAt(c+1)&&!h&&(i=!0,d[b]=[a.substring(f,c)],f=c+1,c++),i&&" "==a.charAt(c)&&(g=i=!1,d[b].push(a.substring(f,c)),b++),i&&c==a.length-1&&d[b].push(a.substring(f,a.length)),c++;return d};a.LessonParser.prototype.splitComa=function(a){for(var d=
[],c=[],b=0,g=0,f=a.length;g<f;g++)"("==a.charAt(g)?c.push(g):")"==a.charAt(g)?c.pop():","==a.charAt(g)&&0==c.length&&(d.push(a.substring(b,g)),b=g+1);d.push(a.substring(b));return d};a.LessonParser.prototype.convertColor=function(a){if(babel[a])return"net"==babel[a]?"red":babel[a];if(6==a.length)return"#"+a;if(8==a.length)return"rgba("+parseInt("0x"+a.substring(2,4),16)+","+parseInt("0x"+a.substring(4,6),16)+","+parseInt("0x"+a.substring(6,8),16)+","+(1-parseInt("0x"+a.substring(0,2),16)/255)+")";
if("("==a[0]){for(var d="(",a=this.splitComa(a.substring(1,a.length-1)),c,b=0,g=a.length;b<g;b++)c=parseInt(a[b],16),a[b]!=c.toString(16)?("["==a[b].charAt(0)&&"]"==a[b].charAt(a[b].length-1)&&(a[b]=a[b].substring(1,a[b].length-1)),d=d+a[b]+(b<g-1?",":")")):d=d+c/255+(b<g-1?",":")");return this.parser.parse(d)}return"#aa0000"};a.LessonParser.prototype.parseText=function(e){if(e.match(/^\{\\rtf1/))return(new a.RTFParser(this.parent.evaluator)).parse(e.substring(10,e.length-1));for(var e=e.split("\\n"),
d=0,c=e.length;d<c;d++)e[d]=this.parseTextElement(e[d]);return e};a.LessonParser.prototype.parseTextElement=function(a){for(var a=a.replace(/&squot;/g,"'"),d="'",c=0,b=-1;c<a.length;)"["==a.charAt(c)&&"\\"==a.charAt(c-1)?d=d.substring(0,d.length-1)+"[":"]"==a.charAt(c)&&"\\"==a.charAt(c-1)?d=d.substring(0,d.length-1)+"]":"["==a.charAt(c)&&-1==b?(b++,d+="'+("):"["==a.charAt(c)?(b++,d+=a.charAt(c)):"]"==a.charAt(c)&&0==b?(b--,d+=")+'"):("]"==a.charAt(c)&&(b=0>b?b:b-1),d+=a.charAt(c)),c++;return d+"'"};
return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Node=function(a,d){this.sep="";this.type=a;this.value=d;this.parent=null;this.childs=[]};a.Node.prototype.getRoot=function(){return null==this.parent?this:this.parent.getRoot()};a.Node.prototype.addChild=function(a){a.parent=this;this.childs.push(a)};a.Node.prototype.replaceLastChild=function(a){var d=this.childs.length-1;this.childs[d].parent=null;this.childs[d]=a;a.parent=this;return a};a.Node.prototype.toString=function(){var a=
"tipo: "+this.type+", valor: "+this.value+"\n";this.sep="   "+(this.parent?this.parent.sep:"");for(var d=0,c=this.childs.length;d<c;d++)a+=this.sep+this.childs[d].toString();return a};a.Node.prototype.contains=function(a){if(this.value==a)return!0;for(var d=0,c=this.childs.length;d<c;d++)if(this.childs[d].contains(a))return!0;return!1};a.Node.prototype.equalToMinus=function(){if("compOperator"==this.type){this.type="operator";this.value="-";var e=new a.Node("compOperator","=="),d=new a.Node("number",
"0");e.addChild(this);e.addChild(d);return this.getRoot()}return this};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Tokenizer=function(){};a.Tokenizer.prototype.tokenize=function(a){var d=a;a&&(a=a.replace(/\&sup(.+);/g,"^$1 "),a=a.replace(/&squot;/g,"'"),a.match(/\=\|\*/g)&&(a=a.replace("|*","'","g").replace("*|","'","g")));for(var c=[],b=!1,g=0,f,h=a,i=0,j=function(a,b,d){c.push({type:a,value:b});h=h.slice(d);g=g+d;i++};a&&g<a.length;)if(b=g,"'"==h[0]){for(f=1;"'"!=
h[f];)if(f<h.length)f++;else{console.log(">Error, simbolo no conocido: ["+h+"], en la cadena <<"+d+">>");return}f=h.substring(1,f);j("string",f,f.length+2)}else if(f=h.match(/^\s+/))h=h.slice(f[0].length),g+=f[0].length,i++;else if(f=h.match(/^[a-zA-Z_\u00C0-\u021B]+[a-zA-Z_0-9\u00C0-\u021B]*([.]*[0-9a-zA-Z_\u00C0-\u021B]+[0-9]*)*/))j("identifier",f[0],f[0].length);else if(f=h.match(/^[0-9]+[.][0-9]+|^[.][0-9]+|^[0-9]+/))j("number",f[0],f[0].length);else if(f=h.match(/^==|^!=|^<=|^<|^>=|^>|^#/))b=
f[0],"#"==b&&(b="!="),j("compOperator",b,f[0].length);else if(f=h.match(/^\!|^\~|^\&\&|^\&|^\|\||^\|/))b=f[0],"||"==b?b="|":"&&"==b?b="&":"~"==b&&(b="!"),j("boolOperator",b,f[0].length);else if((f=h.match(/^=/))&&!h.match(/^==/))j("asign",f[0],f[0].length);else if(f=h.match(/^[\?\:]/))j("conditional",f[0],f[0].length);else if(f=h.match(/^[\+\-\*\/\%\^]/))j("operator",f[0],f[0].length);else if(f=h.match(/^\[|^\]/))j("square_bracket",f[0],f[0].length);else if(f=h.match(/^\(|^\)/))j("parentheses",f[0],
f[0].length);else if(f=h.match(/^,/))j("separator",f[0],f[0].length);else if(f=h.match(/^;/))j("final_of_expresion",f[0],f[0].length);else if(b==g){console.log("Error, simbolo no conocido: ["+h+"], en la cadena <<"+d+">>");return}return c};a.Tokenizer.prototype.flatTokens=function(a){for(var a=a||[],d="",c=0,b=a.length;c<b;c++)d="string"==a[c].type?d+"&squot;"+a[c].value+"&squot;":d+a[c].value;return d};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Parser=function(e){this.evaluator=
e;this.tokenizer=new a.Tokenizer;this.vectors={};this.matrices={};this.variables={};this.functions={};this.variables.rnd=Math.random;this.variables.pi=Math.PI;this.variables.e=Math.E;this.variables.Infinity=Infinity;this.variables["-Infinity"]=-Infinity;this.functions.sqr=function(a){return a*a};this.functions.sqrt=this.functions["ra\u00edz"]=Math.sqrt;this.functions.exp=Math.exp;this.functions.log=Math.log;this.functions.log10=function(a){return Math.log(a)/Math.log(10)};this.functions.abs=Math.abs;
this.functions.ent=Math.floor;this.functions.sgn=function(a){return 0<a?1:0>a?-1:0};this.functions.ind=function(a){return a?1:0};this.functions.sin=this.functions.sen=Math.sin;this.functions.cos=Math.cos;this.functions.tan=Math.tan;this.functions.cot=function(a){return 1/Math.tan(a)};this.functions.sec=function(a){return 1/Math.cos(a)};this.functions.csc=function(a){return 1/Math.sin(a)};this.functions.sinh=this.functions.senh=function(a){return(Math.exp(a)-Math.exp(-a))/2};this.functions.cosh=function(a){return(Math.exp(a)+
Math.exp(-a))/2};this.functions.tanh=function(a){return(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))};this.functions.coth=function(a){return 1/this.functions.tanh(a)};this.functions.sech=function(a){return 1/this.functions.cosh(a)};this.functions.csch=function(a){return 1/this.functions.sinh(a)};this.functions.asin=this.functions.asen=Math.asin;this.functions.acos=Math.acos;this.functions.atan=Math.atan;this.functions.min=Math.min;this.functions.max=Math.max;this.functions.esCorrecto=function(d,
c){return a.esCorrecto(d,c)};this.functions.escorrecto=function(d,c){return a.escorrecto(d,c)};window.parent.location.href!==window.location.href&&(this.functions["parent.set"]=function(a,c){window.parent.postMessage({type:"set",name:a,value:c},"*")},this.functions["parent.update"]=function(){window.parent.postMessage({type:"update"},"*")},this.functions["parent.get"]=function(a,c){window.parent.postMessage({type:"get",name:a,value:c},"*")},this.functions["parent.exec"]=function(a,c){window.parent.postMessage({type:"exec",
name:a,value:c},"*")})};a.Parser.prototype.setVariable=function(a,d){this.variables[a]=d};a.Parser.prototype.getVariable=function(a){this.variables.hasOwnProperty(a)||(this.variables[a]=0);return this.variables[a]};a.Parser.prototype.setVector=function(a,d,c){this.vectors[a][d]=c};a.Parser.prototype.getVector=function(a){this.vectors.hasOwnProperty(a)||(this.vectors[a]=[0,0,0]);return this.vectors[a]};a.Parser.prototype.setMatrix=function(a,d,c,b){this.matrices[a][d][c]=b};a.Parser.prototype.getMatrix=
function(a){this.matrices.hasOwnProperty(a)||(this.matrices[a]=[[0,0,0],[0,0,0],[0,0,0]]);return this.matrices[a]};a.Parser.prototype.setFunction=function(a,d){this.functions[a]=d};a.Parser.prototype.getFunction=function(a){this.functions.hasOwnProperty(a)||(this.functions[a]=function(){return 0});return this.functions[a]};a.Parser.prototype.parse=function(e,d){var c=this.tokenizer.tokenize(e);c||(c=[]);for(var b=null,g,d=!d||!1,f=0,h=0,i=0,j,k,l=0,m=c.length;l<m;l++)if(g=c[l],j=g.value,k=g.type,
"identifier"==k&&(l+1<m&&"parentheses"==c[l+1].type&&"("==c[l+1].value?this.getFunction(j):l+1<m&&"square_bracket"==c[l+1].type&&"["==c[l+1].value?c[l+3]&&"square_bracket"==c[l+3].type&&"]"==c[l+3].value?this.getVector(j):this.getMatrix(j):this.getVariable(j)),"asign"==k&&d&&(k="compOperator",j="=="),"asign"==k)if(g=new a.Node(k,j),null!=b)if("identifier"==b.type)b.parent&&b.parent.replaceLastChild(g),g.addChild(b),b=g,d=!0;else if("square_bracket"==b.type)g.addChild(b.parent),b=g,d=!0;else{g.type=
"compOperator";g.value="==";for(d=!0;b.parent&&this.precedence(b.parent.value)>=this.precedence(g.value);)b=b.parent;b.parent&&b.parent.replaceLastChild(g);g.addChild(b);b=g}else{console.log("Error1: en la expresion <<"+e+">>, en el token {valor: "+j+", tipo: "+k+"}");break}else if("parentheses"==k&&"("==j||"square_bracket"==k&&"["==j)if(g=new a.Node(k,j),"("==j&&f++,"["==j&&h++,null==b)"("==j&&(b=new a.Node("(expr)","(expr)"),b.addChild(g)),"["==j&&(b=new a.Node("[expr]","[expr]"),b.addChild(g)),
b=g;else if("operator"==b.type||"boolOperator"==b.type||"compOperator"==b.type||"conditional"==b.type||"asign"==b.type)b.addChild(g),b=g;else if("sign"==b.type)b.addChild(g),b=g;else if("parentheses"==b.type&&"("==b.value)b.addChild(g),b=g;else if("square_bracket"==b.type&&"["==b.value)b.addChild(g),b=g;else if("parentheses"==b.type&&"()"==b.value)b.parent.addChild(g),b=g;else if("square_bracket"==b.type&&"[]"==b.value)b.parent.addChild(g),b=g;else if("identifier"==b.type)b.addChild(g),b=g;else{console.log("Error2: en la expresion <<"+
e+">>, en el token ["+l+"] {valor: "+j+", tipo: "+k+"}");break}else if("parentheses"==k&&")"==j)if(f--,null==b)console.log("Error3: en la expresion <<"+e+">>, en el token (valor:"+j+", tipo:"+k);else{for(;b&&b.parent&&"("!=b.value;)b=b.parent;if(b&&"("==b.value)b.value="()";else{console.log("Error4: en la expresion <<"+e+">>, en el token {valor: "+j+", tipo: "+k+"}");break}}else if("square_bracket"==k&&"]"==j)if(h--,null==b)console.log("Error5: en la expresion <<"+e+">>, en el token (valor:"+j+", tipo:"+
k);else{for(;b&&b.parent&&"["!=b.value;)b=b.parent;if(b&&"["==b.value)b.value="[]";else{console.log("Error6: en la expresion <<"+e+">>, en el token {valor: "+j+", tipo: "+k+"}");break}}else if("number"==k||"string"==k||"identifier"==k)if(g=new a.Node(k,j),null==b)b=g;else if("operator"==b.type||"compOperator"==b.type||"boolOperator"==b.type||"parentheses"==b.type&&"("==b.value||"square_bracket"==b.type&&"["==b.value||"sign"==b.type||"conditional"==b.type||"asign"==b.type)b.addChild(g),b=g;else{console.log("Error7: en la expresion <<"+
e+">>, en el token {valor: "+j+", tipo: "+k+"}");break}else if("operator"==k||"compOperator"==k||"boolOperator"==k)if(g=new a.Node(k,j),null==b)if("-"==j||"+"==j)g.type="sign",g.value="sign"+j,b=g;else if("!"==j)b=g;else{console.log("Error8: en la expresion <<"+e+">>, en el token {valor: "+j+", tipo: "+k+"}");break}else if("operator"==b.type||"compOperator"==b.type||"boolOperator"==b.type||"asign"==b.type||"conditional"==b.type||"square_bracket"==b.type&&"["==b.value&&("-"==j||"+"==j||"!"==j)||"parentheses"==
b.type&&"("==b.value&&("-"==j||"+"==j||"!"==j)){if("-"==j||"+"==j)g.type="sign",g.value="sign"+j;b.addChild(g);b=g}else if("number"==b.type||"parentheses"==b.type&&"()"==b.value||"square_bracket"==b.type&&"[]"==b.value||"string"==b.type||"identifier"==b.type||"conditional"==b.type||"asign"==b.type){for(;b.parent&&this.precedence(b.parent.value)>=this.precedence(g.value);)b=b.parent;b.parent&&b.parent.replaceLastChild(g);g.addChild(b);b=g}else{console.log("Error9: en la expresion <<"+e+">>, en el token {valor: "+
j+", tipo: "+k+"}");break}else if("conditional"==k)if(g=new a.Node(k,j),null!=b)if("?"==g.value){for(i++;b.parent&&this.precedence(b.parent.value)>this.precedence(g.value);)b=b.parent;b.parent&&b.parent.replaceLastChild(g);g.addChild(b);b=g}else{for(i--;b&&b.parent&&"?"!=b.value;)b=b.parent;if(b&&"?"==b.value)b.value="?:";else{console.log("Error10: en la expresion <<"+e+">>, en el token {valor: "+j+", tipo: "+k+"}");break}}else{console.log("Error11: en la expresion <<"+e+">>, en el token {valor: "+
j+", tipo: "+k+"}");break}else if("separator"==k)if(null!=b)for(;b.parent&&"("!=b.value&&"["!=b.value;)b=b.parent;else{console.log("Error12: en la expresion <<"+e+">>, en el token {valor: "+j+", tipo: "+k+"}");break}else{console.log("Error13: en la expresion <<"+e+">>, en el token {valor: "+j+", tipo: "+k+"}");break}0<f&&alert("Error, faltan parentesis por cerrar: "+e);0>f&&alert("Error, faltan parentesis por abrir: "+e);0<h&&alert("Error, faltan corchetes por cerrar: "+e);0>h&&alert("Error, faltan corchetes por abrir: "+
e);0!=i&&alert("Error, condicional incompleta: "+e);return b?b.getRoot():null};a.Parser.prototype.precedence=function(a){switch(a){case "=":return 1;case "(":return 2;case "[":return 2;case "?":return 2;case ":":return 3;case "?:":return 3;case "&":return 6;case "|":return 6;case "<":return 4;case "<=":return 4;case ">":return 4;case ">=":return 4;case "==":return 4;case "!=":return 4;case "+":return 5;case "-":return 5;case "/":return 6;case "*":return 6;case "sign-":return 6;case "sign+":return 6;
case "!":return 7;case "^":return 7;case "%":return 7;default:return 8}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=Math.floor;a.Evaluator=function(d){this.parent=d;this.parser=new a.Parser;this.variables=this.parser.variables;this.functions=this.parser.functions;this.vectors=this.parser.vectors;this.matrices=this.parser.matrices};a.Evaluator.prototype.setVariable=function(a,c){this.variables[a]=c};a.Evaluator.prototype.getVariable=function(a){return this.variables[a]};
a.Evaluator.prototype.setVector=function(a,c,b){c=0>c?0:e(c);this.vectors[a][c]=b};a.Evaluator.prototype.getVector=function(a,c){c=0>c?0:e(c);return this.vectors[a][c]};a.Evaluator.prototype.setMatrix=function(a,c,b,g){c=0>c?0:e(c);b=0>b?0:e(b);this.matrices[a][c][b]=g};a.Evaluator.prototype.getMatrix=function(a,c,b){c=0>c?0:e(c);b=0>b?0:e(b);return this.matrices[a][c][b]};a.Evaluator.prototype.setFunction=function(a,c){this.functions[a]=c};a.Evaluator.prototype.getFunction=function(a){return this.functions[a]};
a.Evaluator.prototype.evalExpression=function(a,c,b){this.decimals=void 0==c||0>c?2:c;this.fixed=b||!1;a=this.evalAux(a);return void 0==a?0:a};a.Evaluator.prototype.evalAux=function(a){if(null==a)return 0;var c=a.type,b=a.childs,g=a.value;if("number"==c)return parseFloat(g);if("string"==c)return g;if("identifier"==c&&0==b.length){if("rnd"==g)return Math.random();b=this.variables[g];return"object"==typeof b?this.evalAux(b):b}if("square_bracket"==c)return this.evalAux(b[0]);if("identifier"==c&&"square_bracket"==
b[0].type&&1==b[0].childs.length){var f=this.evalAux(b[0].childs[0]);try{return this.vectors[g][0>f?0:e(f)]}catch(h){return 0}}else if("identifier"==c&&"square_bracket"==b[0].type&&1<b[0].childs.length){f=this.evalAux(b[0].childs[0]);b=this.evalAux(b[0].childs[1]);try{return this.matrices[g][0>f?0:e(f)][0>b?0:e(b)]}catch(i){return 0}}else{if("identifier"==c&&"parentheses"==b[0].type){for(var j=[],c=0,f=b[0].childs.length;c<f;c++)j.push(this.evalAux(b[0].childs[c]));if("_Eval_"==g){b="string"==typeof j[0]?
"'"+j[0]+"'":j[0];if(!a.previousExpression||a.previousExpression!=j[0])a.previousExpression=b,a.previousParse=this.parser.parse(b);return this.evalAux(a.previousParse)}return this.functions[g].apply(this,j)}if("operator"==c){c=void 0==this.decimals||0>this.decimals?2:this.decimals;a=this.fixed||!1;f=this.evalAux(b[0]);b=this.evalAux(b[1]);if("+"==g)return"string"===typeof f&&"number"==typeof b?(b=a?b.toFixed(parseFloat(c)):parseFloat(b.toFixed(parseFloat(c))),b=(""+b).replace(".",this.parent.decimal_symbol)+
"",f+b):"number"===typeof f&&"string"==typeof b?(g=a?f.toFixed(parseFloat(c)):parseFloat(f.toFixed(parseFloat(c))),g=(""+g).replace(".",this.parent.decimal_symbol)+"",g+b):f+b;if("-"==g)return f-b;if("*"==g)return f*b;if("/"==g)return f/b;if("%"==g)return f-e(f/b)*b;if("^"==g)return Math.pow(f,b)}else if("compOperator"==c){f=this.evalAux(b[0]);b=this.evalAux(b[1]);if("<"==g)return(f<b)+0;if("<="==g)return(f<=b)+0;if(">"==g)return(f>b)+0;if(">="==g)return(f>=b)+0;if("=="==g)return(f==b)+0;if("!="==
g)return(f!=b)+0}else if("boolOperator"==c){f=1==this.evalAux(b[0])?1:0;if("&"==g)return f?1==this.evalAux(b[1])?1:0:0;if("|"==g)return f?1:1==this.evalAux(b[1])?1:0;if("!"==g)return!f+0}else{if("conditional"==c)return f=this.evalAux(b[0]),0<f?this.evalAux(b[1]):this.evalAux(b[2]);if("sign"==c)return"sign+"==g?this.evalAux(b[0]):-this.evalAux(b[0]);if("parentheses"==c)return this.evalAux(b[0]);if("(expr)"==c||"[expr]"==c){f=b.length;g=[];if(1==f&&1==b[0].childs.length&&"(expr)"==c)g=this.evalAux(b[0].childs[0]);
else for(c=0;c<f;c++){for(var a=[],j=0,k=b[c].childs.length;j<k;j++)a.push(this.evalAux(b[c].childs[j]));g[c]=a}return g}"asign"==c?(g=b[0],b=b[1],1==g.childs.length&&"square_bracket"==g.childs[0].type?(f=g.childs[0].childs,1==f.length?(f=this.evalAux(f[0]),f=0>f?0:e(f),this.vectors[g.value][f]=this.evalAux(b)):2==f.length&&(c=this.evalAux(f[0]),f=this.evalAux(f[1]),c=0>c?0:e(c),f=0>f?0:e(f),this.matrices[g.value][c][f]=this.evalAux(b))):this.variables[g.value]=this.evalAux(b)):console.log("Error en la evaluacion, expresion desconocida <"+
g+"> \n"+a)}}};return a}(descartesJS||{}),descartesJS=function(a){var e,d,c;if(a.loadLib)return a;var b=2,g=!1;a.RTFNode=function(a,b,d,c){this.evaluator=a;this.type="rtfNode";this.value=b;this.nodeType=d;this.style=c;this.styleString=c.toString();this.color=c.textColor;this.underline=c.textUnderline;this.overline=c.textOverline;this.parent=null;this.childs=[];"textBlock"==this.nodeType?this.draw=this.drawTextBlock:"textLineBlock"==this.nodeType?this.draw=this.drawTextLineBlock:"formula"==this.nodeType?
this.draw=this.drawFormula:"superIndex"==this.nodeType?this.draw=this.drawSuperIndex:"subIndex"==this.nodeType?this.draw=this.drawSubIndex:"dynamicText"==this.nodeType?(this.draw=this.drawDynamicText,this.decimal_symbol=this.evaluator.parent.decimal_symbol):"fraction"==this.nodeType?this.draw=this.drawFraction:"numerator"==this.nodeType||"denominator"==this.nodeType?this.draw=this.drawNumDen:"radical"==this.nodeType?this.draw=this.drawRadical:"limit"==this.nodeType?this.draw=this.drawLimit:"integral"==
this.nodeType?this.draw=this.drawIntegral:"sum"==this.nodeType?this.draw=this.drawSum:"matrix"==this.nodeType?this.draw=this.drawMatrix:"defparts"==this.nodeType?this.draw=this.drawDefparts:"text"==this.nodeType||"newLine"==this.nodeType?this.draw=this.drawText:"mathSymbol"==this.nodeType?this.draw=this.drawMathSymbol:"index"==this.nodeType||"radicand"==this.nodeType||"from"==this.nodeType||"to"==this.nodeType||"what"==this.nodeType||"element"==this.nodeType?this.draw=this.drawGenericBlock:"componentNumCtrl"==
this.nodeType?this.draw=this.drawComponentNumCtrl:"componentSpace"==this.nodeType&&(this.draw=this.drawComponentSpace)};a.RTFNode.prototype.getRoot=function(){return null==this.parent?this:this.parent.getRoot()};a.RTFNode.prototype.addChild=function(a){a.parent=this;this.childs.push(a)};a.RTFNode.prototype.toHTML=function(){var a="";if("textLineBlock"===this.nodeType||"textBlock"===this.nodeType)for(var b=0,d=this.childs.length;b<d;b++)a+=this.childs[b].toHTML();else"text"===this.nodeType?a="<span "+
this.style.toCSS()+">"+this.value+"</span>":"newLine"===this.nodeType&&(a="<br />");return a};c=d=e=0;a.RTFNode.prototype.getTextMetrics=function(){if("textBlock"==this.nodeType)for(var f=0,h=this.childs.length;f<h;f++)this.childs[f].getTextMetrics();else if("textLineBlock"==this.nodeType)this.getBlockMetric();else if("newLine"==this.nodeType){var i=a.getFontMetrics(this.styleString);this.baseline=i.baseline;this.descent=i.descent;this.ascent=i.ascent;this.width=i.width;this.height=i.height}else if("text"==
this.nodeType||"dynamicText"==this.nodeType){i=a.getFontMetrics(this.styleString);this.baseline=i.baseline;this.descent=i.descent;this.ascent=i.ascent;var j=this.value,k;"string"!=typeof this.value&&(f=void 0==this.decimals?b:this.evaluator.evalExpression(this.decimals),k=void 0==this.fixed?g:this.fixed,j=this.evaluator.evalExpression(this.value,f,k),parseFloat(j)==j&&(j=parseFloat(j).toFixed(f),j=k?j:parseFloat(j),j=j.toString().replace(".",this.decimal_symbol)),j+=" ");this.width=a.getTextWidth(j,
this.styleString);this.height=i.height}else if("formula"==this.nodeType)this.getBlockMetric();else if("superIndex"==this.nodeType)k=e,j=d,k=c,f=a.getFontMetrics(this.styleString),i=a.getTextWidth(" ",this.styleString),this.getBlockMetric(),0>this.height&&(this.ascent=f.ascent,this.descent=f.descent,this.height=this.ascent+this.descent,this.width=1.5*i),i=k/2-j+this.height,this.superIndexPos=i-this.ascent,this.ascent=i,this.descent=j,this.baseline=this.ascent,this.height=this.ascent+this.descent;else if("subIndex"==
this.nodeType)k=e,j=d,f=a.getFontMetrics(this.styleString),i=a.getTextWidth(" ",this.styleString),this.getBlockMetric(),0>this.height&&(this.ascent=f.ascent,this.descent=f.descent,this.height=this.ascent+this.descent,this.width=1.5*i),this.subIndexPos=j+1,this.ascent=k,this.descent=this.subIndexPos+this.descent,this.baseline=this.ascent,this.height=this.ascent+this.descent;else if("fraction"==this.nodeType){j=d;k=c;var l=this.childs[0],h=this.childs[1],f=a.getFontMetrics(l.styleString),i=a.getTextWidth(" ",
this.styleString);l.getBlockMetric();h.getBlockMetric();0>l.height&&(l.height=f.height,l.width=i);0>h.height&&(h.height=f.height,h.width=i);this.height=l.height+h.height-1;this.ascent=l.height+k/2-j;this.descent=this.height-this.ascent;this.baseline=this.ascent;this.width=Math.max(l.width,h.width)+i+8}else if("radical"==this.nodeType)j=this.childs[0],f=this.childs[1],j.getBlockMetric(),f.getBlockMetric(),this.ascent=f.height/2<j.height?f.height/2+j.height+2-f.descent:f.ascent+4,this.descent=f.descent,
this.baseline=this.ascent,this.height=this.ascent+this.descent,i=a.getTextWidth(" ",this.styleString),this.width=j.width+f.width+4*i;else if("sum"==this.nodeType)j=this.childs[0],k=this.childs[1],l=this.childs[2],j.getBlockMetric(),k.getBlockMetric(),l.getBlockMetric(),-1==j.ascent&&(i=a.getFontMetrics(j.styleString),j.ascent=i.ascent,j.descent=i.descent,j.height=i.height),-1==k.ascent&&(i=a.getFontMetrics(k.styleString),k.ascent=i.ascent,k.descent=i.descent,k.height=i.height),f=a.getFontMetrics(this.styleString),
this.ascent=f.height+k.height>l.ascent?f.height-f.descent+k.height:l.ascent,this.descent=j.height>l.descent?j.height+f.descent:l.descent,this.baseline=this.ascent,this.height=this.ascent+this.descent,i=this.style.clone(),i.fontType="Times New Roman",i.Bold="bold",i=i.toString(),f=a.getTextWidth(String.fromCharCode(8721),i),i=a.getTextWidth(" ",this.styleString),this.width=Math.max(j.width,k.width,f)+Math.max(l.width,i)+i;else if("integral"==this.nodeType)j=this.childs[0],k=this.childs[1],l=this.childs[2],
j.getBlockMetric(),k.getBlockMetric(),l.getBlockMetric(),-1==j.ascent&&(i=a.getFontMetrics(j.styleString),j.ascent=i.ascent,j.descent=i.descent,j.height=i.height),-1==k.ascent&&(i=a.getFontMetrics(k.styleString),k.ascent=i.ascent,k.descent=i.descent,k.height=i.height),f=a.getFontMetrics(this.styleString),this.ascent=f.height+k.height>l.ascent?f.height-f.descent+k.height:l.ascent,this.descent=j.height>l.descent?j.height+f.descent:l.descent,this.baseline=this.ascent,this.height=this.ascent+this.descent,
i=this.style.clone(),i.fontSize*=1.5,i.fontType="Times New Roman",i.Bold="bold",i=i.toString(),f=a.getTextWidth(String.fromCharCode(8747),i),i=a.getTextWidth(" ",this.styleString),this.width=Math.max(j.width,k.width,f)+Math.max(l.width,i)+2*i;else if("limit"==this.nodeType)j=this.childs[0],k=this.childs[1],l=this.childs[2],f=a.getFontMetrics(this.styleString),j.getBlockMetric(),k.getBlockMetric(),l.getBlockMetric(),-1==j.ascent&&(i=a.getFontMetrics(j.styleString),j.ascent=i.ascent,j.descent=i.descent,
j.height=i.height),-1==k.ascent&&(i=a.getFontMetrics(k.styleString),k.ascent=i.ascent,k.descent=i.descent,k.height=i.height),-1==l.ascent&&(i=a.getFontMetrics(l.styleString),l.ascent=i.ascent,l.descent=i.descent,l.height=i.height),this.ascent=l.ascent,this.descent=Math.max(f.height,l.descent),this.baseline=this.ascent,this.height=this.ascent+this.descent,i=a.getTextWidth(" ",this.styleString),f=a.getTextWidth(" "+String.fromCharCode(8594),this.styleString),0==j.width&&(j.width=i),0==k.width&&(k.width=
i),0==l.width&&(l.width=i),this.width=k.width+j.width+l.width+f+i;else if("matrix"==this.nodeType){i=a.getTextWidth(" ",this.styleString);f=a.getFontMetrics(this.styleString);j=d;k=f.ascent;for(var l=f.descent,m=f.height,o=i,q,p,f=0,h=this.childs.length;f<h;f++)this.childs[f].getBlockMetric(),q=this.childs[f].height,p=this.childs[f].width,m<q&&(m=q,k=this.childs[f].ascent,l=this.childs[f].descent),o<p&&(o=p);this.childWidth=o+2*i;this.childHeight=m;this.childAscent=k;this.childDescent=l;this.height=
this.rows*m;this.ascent=this.height/2+j;this.descent=this.height-this.ascent;this.width=this.columns*this.childWidth+i}else if("defparts"==this.nodeType){i=a.getTextWidth(" ",this.styleString);f=a.getFontMetrics(this.styleString);j=d;k=f.ascent;l=f.descent;m=f.height;o=i;f=0;for(h=this.childs.length;f<h;f++)this.childs[f].getBlockMetric(),q=this.childs[f].height,p=this.childs[f].width,m<q&&(m=q,k=this.childs[f].ascent,l=this.childs[f].descent),o<p&&(o=p);this.childWidth=o+2*i;this.childHeight=m;this.childAscent=
k;this.childDescent=l;this.height=this.parts*m;this.ascent=this.height/2+j;this.descent=this.height-this.ascent;this.width=o+i/2}else"mathSymbol"==this.nodeType?(i=a.getFontMetrics(this.styleString),this.baseline=i.baseline,this.descent=i.descent,this.ascent=i.ascent,this.width=a.getTextWidth(this.value,this.styleString)+a.getTextWidth(" ",this.styleString),this.height=i.height):"componentNumCtrl"==this.nodeType?(this.componentNumCtrl=this.evaluator.parent.getControlByCId(this.value),this.height=
this.ascent=this.descent=this.baseline=0,this.width=this.componentNumCtrl.w):"componentSpace"==this.nodeType?(this.componentSpace=this.evaluator.parent.getSpaceByCId(this.value),this.height=this.ascent=this.descent=this.baseline=0,this.width=this.componentSpace.w):console.log("elemento no conocido",this.nodeType)};a.RTFNode.prototype.getBlockMetric=function(){this.width=0;for(var a=-1,b=-1,g,j=0,k=this.childs.length;j<k;j++){g=this.childs[j];g.getTextMetrics();childAscent=g.ascent;childDescent=g.descent;
this.width+=g.width;var l=childDescent;g=g.height;e=childAscent;d=l;c=g;b<childAscent&&(b=childAscent);a<childDescent&&(a=childDescent)}this.ascent=b;this.descent=a;this.baseline=this.ascent;this.height=this.ascent+this.descent};a.RTFNode.prototype.drawTextBlock=function(a,d,c,e,k,l){this.stableWidth||(this.getTextMetrics(),b=e,g=k);for(var m=k=e=0,o=this.childs.length;m<o;m++)0<m&&(k+=this.childs[m-1].height),"center"==l?e=-this.childs[m].width/2:"right"==l&&(e=-this.childs[m].width),this.childs[m].draw(a,
d+e,c+k)};a.RTFNode.prototype.drawTextLineBlock=function(b,d,c){for(var e=0,g=0,l=this.childs.length;g<l;g++)0<g&&(e+=this.childs[g-1].width,"formula"==this.childs[g-1].nodeType&&(e+=2*a.getTextWidth(" ",this.childs[g].styleString))),this.childs[g].draw(b,d+e,c+this.baseline)};a.RTFNode.prototype.drawFormula=function(b,d,c){for(var g=a.getTextWidth(" ",this.styleString),e=0,l=0,m=this.childs.length;l<m;l++)0<l&&(e+=this.childs[l-1].width),this.childs[l].draw(b,d+g+e,c)};a.RTFNode.prototype.drawText=
function(a,b,d){null!=this.color&&(a.fillStyle=this.color);a.font=this.styleString;a.textAlign="start";a.textBaseline="alphabetic";a.fillText(this.value,b-1,d);if(this.underline){var c="bold"==this.style.textBold,e=c?1:0.5;a.lineWidth=c?2:1;null!=this.color&&(a.strokeStyle=this.color);a.beginPath();a.moveTo(b-1,parseInt(d+this.descent/2)+e);a.lineTo(b-1+this.width,parseInt(d+this.descent/2)+e);a.stroke()}this.overline&&(e=(c="bold"==this.style.textBold)?2:1.5,a.lineWidth=c?2:1,null!=this.color&&(a.strokeStyle=
this.color),a.beginPath(),a.moveTo(b-1,parseInt(d-this.ascent)+e),a.lineTo(b-1+this.width,parseInt(d-this.ascent)+e),a.stroke())};a.RTFNode.prototype.drawDynamicText=function(d,c,e){var j=Math.floor(0.5*a.getTextWidth(" ",this.styleString)),k=void 0==this.decimals?b:this.evaluator.evalExpression(this.decimals),l=void 0==this.fixed?g:this.fixed,m=this.evaluator.evalExpression(this.value,k,l);parseFloat(m)==m&&(m=l?parseFloat(m).toFixed(k):parseFloat(parseFloat(m).toFixed(k)),m=(""+m).replace(".",this.decimal_symbol));
null!=this.color&&(d.fillStyle=this.color);d.font=this.styleString;d.textAlign="start";d.textBaseline="alphabetic";this.width=a.getTextWidth(m,this.styleString);d.fillText(m,j+c,e);this.underline&&(l=(k="bold"==this.style.textBold)?1:0.5,d.lineWidth=k?2:1,null!=this.color&&(d.strokeStyle=this.color),d.beginPath(),d.moveTo(j+c-1,parseInt(e+this.descent/2)+l),d.lineTo(j+c-1+this.width,parseInt(e+this.descent/2)+l),d.stroke());this.overline&&(l=(k="bold"==this.style.textBold)?2:1.5,d.lineWidth=k?2:1,
null!=this.color&&(d.strokeStyle=this.color),d.beginPath(),d.moveTo(j+c-1,parseInt(e-this.ascent)+l),d.lineTo(j+c-1+this.width,parseInt(e-this.ascent)+l),d.stroke());this.width+=2*j};a.RTFNode.prototype.drawRadical=function(b,d,c){var e=Math.floor(a.getTextWidth(" ",this.styleString));this.childs[0].draw(b,d,Math.floor(c+this.childs[1].descent-this.childs[1].height/2-this.childs[0].descent));this.childs[1].draw(b,d+1.5*e+this.childs[0].width,c);b.lineWidth=1;null!=this.color&&(b.strokeStyle=this.color);
b.beginPath();b.moveTo(d,Math.floor(c+this.childs[1].descent-this.childs[1].height/2));b.lineTo(d+this.childs[0].width,Math.floor(c+this.childs[1].descent-this.childs[1].height/2));b.lineTo(d+this.childs[0].width+0.5*e,c+this.childs[1].descent);b.lineTo(d+this.childs[0].width+1*e,c-this.childs[1].ascent);b.lineTo(d+this.childs[0].width+2*e+this.childs[1].width,c-this.childs[1].ascent);b.stroke()};a.RTFNode.prototype.drawFraction=function(b,d,c){this.childs[0].draw(b,d+(this.width-this.childs[0].width)/
2,c-this.ascent);this.childs[1].draw(b,d+(this.width-this.childs[1].width)/2,c-this.ascent+this.childs[0].height-1);var e=Math.floor(0.5*a.getTextWidth(" ",this.styleString));b.lineWidth=1;null!=this.color&&(b.strokeStyle=this.color);b.beginPath();b.moveTo(d+e,parseInt(c-this.ascent+this.childs[0].height)+0.5);b.lineTo(d-e+this.width-1,parseInt(c-this.ascent+this.childs[0].height)+0.5);b.stroke()};a.RTFNode.prototype.drawNumDen=function(a,b,d){for(var c=0,e=0,g=this.childs.length;e<g;e++)0<e&&(c+=
this.childs[e-1].width),this.childs[e].draw(a,b+c,d+this.baseline)};a.RTFNode.prototype.drawSubIndex=function(a,b,d){for(var c=0,e=0,g=this.childs.length;e<g;e++)0<e&&(c+=this.childs[e-1].width),this.childs[e].draw(a,b+c,d+this.subIndexPos)};a.RTFNode.prototype.drawSuperIndex=function(a,b,d){for(var c=0,e=0,g=this.childs.length;e<g;e++)0<e&&(c+=this.childs[e-1].width),this.childs[e].draw(a,b+c,d-this.superIndexPos)};a.RTFNode.prototype.drawLimit=function(b,d,c){a.getTextWidth(" ",this.styleString);
var e=a.getFontMetrics(this.styleString),g=" "+String.fromCharCode(8594),l=a.getTextWidth(g,this.styleString);this.childs[0].draw(b,d,c+e.descent+this.childs[0].ascent);this.childs[1].draw(b,d+this.childs[0].width+l,c+e.descent+this.childs[1].ascent);this.childs[2].draw(b,d+l+this.childs[0].width+this.childs[1].width,c);null!=this.color&&(b.fillStyle=this.color);b.font=this.styleString;b.textAlign="start";b.textBaseline="alphabetic";b.fillText("l\u00edm",d+this.childs[0].width,c);b.fillText(g,d+this.childs[0].width,
c+e.descent+this.childs[0].ascent)};a.RTFNode.prototype.drawIntegral=function(b,d,c){var e=this.style.clone();e.fontSize*=1.5;e.fontType="Times New Roman";e.Bold="bold";var e=e.toString(),g=a.getTextWidth(String.fromCharCode(8747),e),l=a.getFontMetrics(e),m=Math.max(this.childs[0].width,this.childs[1].width,Math.floor(1.5*g)),o=a.getTextWidth(" ",this.styleString);this.childs[0].draw(b,d+g,c+l.descent+this.childs[0].ascent);this.childs[1].draw(b,d+g+o/2,c-this.ascent+this.childs[1].ascent);this.childs[2].draw(b,
d+m+g,c);null!=this.color&&(b.fillStyle=this.color);b.font=e;b.textAlign="start";b.textBaseline="alphabetic";b.fillText(String.fromCharCode(8747),d,c+l.descent/2)};a.RTFNode.prototype.drawSum=function(b,d,c){var e=this.style.clone();e.fontType="Times New Roman";e.Bold="bold";var e=e.toString(),g=a.getTextWidth(String.fromCharCode(8721),e),l=a.getFontMetrics(this.styleString),m=Math.max(this.childs[0].width,this.childs[1].width,g);this.childs[0].draw(b,d+(m-this.childs[0].width)/2,c+l.descent+this.childs[0].ascent);
this.childs[1].draw(b,d+(m-this.childs[1].width)/2,c-l.ascent-this.childs[1].descent);this.childs[2].draw(b,d+m,c);null!=this.color&&(b.fillStyle=this.color);b.font=e;b.textAlign="start";b.textBaseline="alphabetic";b.fillText(String.fromCharCode(8721),d+Math.floor((m-g)/2),c-5)};a.RTFNode.prototype.drawMatrix=function(b,d,c){for(var e,g,l=a.getTextWidth(" ",this.styleString),m=0,o=this.childs.length;m<o;m++)e=m%this.columns,g=Math.floor(m/this.columns),this.childs[m].draw(b,2*l+d+e*this.childWidth,
c-this.ascent+this.childAscent+g*this.childHeight);b.lineWidth=1;null!=this.color&&(b.strokeStyle=this.color);b.beginPath();b.moveTo(Math.floor(d+l)+0.5,c-this.ascent+0.5);b.lineTo(Math.floor(d+l/2)+0.5,c-this.ascent+0.5);b.lineTo(Math.floor(d+l/2)+0.5,c+this.descent+0.5);b.lineTo(Math.floor(d+l)+0.5,c+this.descent+0.5);b.moveTo(Math.floor(d+this.width-l)-0.5,c-this.ascent+0.5);b.lineTo(Math.floor(d+this.width-l/2)-0.5,c-this.ascent+0.5);b.lineTo(Math.floor(d+this.width-l/2)-0.5,c+this.descent+0.5);
b.lineTo(Math.floor(d+this.width-l)-0.5,c+this.descent+0.5);b.stroke()};a.RTFNode.prototype.drawDefparts=function(b,d,c){for(var e=a.getTextWidth(" ",this.styleString),g=0,l=this.childs.length;g<l;g++)this.childs[g].draw(b,d+e/4,c-this.ascent+this.childAscent+g%this.parts*this.childHeight);b.lineWidth=1;null!=this.color&&(b.strokeStyle=this.color);b.beginPath();b.moveTo(Math.floor(d+e/3)+0.5,c-this.ascent+0.5);b.lineTo(Math.floor(d+e/6)+0.5,c-this.ascent+0.5+(e/3-e/6));b.lineTo(Math.floor(d+e/6)+
0.5,c+this.descent-this.height/2-(e/3-e/6));b.lineTo(d+0.5,c+this.descent-this.height/2);b.lineTo(Math.floor(d+e/6)+0.5,c+this.descent-this.height/2+(e/3-e/6));b.lineTo(Math.floor(d+e/6)+0.5,c+this.descent+0.5-(e/3-e/6));b.lineTo(Math.floor(d+e/3)+0.5,c+this.descent+0.5);b.stroke()};a.RTFNode.prototype.drawMathSymbol=function(b,d,c){var e=a.getTextWidth(" ",this.styleString);b.lineWidth=1;null!=this.color&&(b.strokeStyle=this.color,b.fillStyle=this.color);b.beginPath();"("==this.value?(b.moveTo(d+
e,c-this.parent.ascent+this.height/10),b.quadraticCurveTo(d+e/5,c+this.parent.descent-this.parent.height/2,d+e,c+this.parent.descent-this.height/10),b.stroke()):")"==this.value?(b.moveTo(d+e,c-this.parent.ascent+this.height/10),b.quadraticCurveTo(d+e+4*e/5,c+this.parent.descent-this.parent.height/2,d+e,c+this.parent.descent-this.height/10),b.stroke()):(b.font=this.styleString,b.textAlign="center",b.textBaseline="alphabetic",b.fillText(this.value,d+this.width/2,c))};a.RTFNode.prototype.drawGenericBlock=
function(a,b,d){for(var c=0,e=0,g=this.childs.length;e<g;e++)0<e&&(c+=this.childs[e-1].width),this.childs[e].draw(a,b+c,d)};a.RTFNode.prototype.drawComponentNumCtrl=function(a,b,d){this.getTextMetrics();this.componentNumCtrl.expresion=this.evaluator.parser.parse("("+b+","+(d-this.parent.ascent)+","+this.componentNumCtrl.w+","+this.componentNumCtrl.h+")")};a.RTFNode.prototype.drawComponentSpace=function(a,b,d){this.getTextMetrics();this.componentSpace.xExpr=this.evaluator.parser.parse(b+"");this.componentSpace.yExpr=
this.evaluator.parser.parse(d-this.parent.ascent+"")};a.RTFNode.prototype.draw=function(a,b,d){console.log(">>> Dibujo desconocido ",this.nodeType);this.childs[0].draw(a,b,d)};a.getFontMetrics=function(a){var b=document.createElement("span");b.setAttribute("style","font: "+a+"; margin: 0; padding: 0;");b.appendChild(document.createTextNode("\u00c1p Texto"));a=document.createElement("div");a.setAttribute("style","display: inline-block; width: 1px; height: 0px;");var d=document.createElement("div");
d.setAttribute("style","margin: 0; padding: 0;");d.appendChild(b);d.appendChild(a);document.body.appendChild(d);var c={};a.style.verticalAlign="baseline";c.ascent=a.offsetTop-b.offsetTop;a.style.verticalAlign="bottom";c.height=a.offsetTop-b.offsetTop;c.descent=c.height-c.ascent;c.baseline=c.ascent;document.body.removeChild(d);return c};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.RTFTokenizer=function(){};a.RTFTokenizer.prototype.tokenize=function(a){a&&(a=a.replace(/(\\\w+)(\\u\d+)/g,
"$1 $2"),a=a.replace(/\\u(\d+) /g,function(a,b){return String.fromCharCode(parseInt(b))}),a=a.replace(/\'/g,"&squot;"),a=a.replace(/&amp;/g,"&"),a=a.replace(/&lt;/g,"<"),a=a.replace(/&gt;/g,">"));for(var d=[],c=a,b=0,g=0,f,h,i,j,k=function(a,f,e){d.push({type:a,value:f});c=c.slice(e);b=b+e};a&&b<a.length;)if(h=b,"{"==c[0])g++,k("openBlock",g,1);else if("}"==c[0])k("closeBlock",g,1),g--,""==c&&(b=a.length);else if((f=c.match(/^\\([\w\*]*)\\/))&&f[1])f=f[1],k("controlWord",f,f.length+1),b-=1;else if((f=
c.match(/^\\(\w*)\s/))&&f[1])f=f[1],k("controlWord",f,f.length+2);else if((f=c.match(/^\\(\w*)\{/))&&f[1])f=f[1],k("controlWord",f,f.length+1),b-=1;else if((f=c.match(/^\\(\w*)\}/))&&f[1])f=f[1],k("controlWord",f,f.length+1),b-=1;else if((f=c.match(/^\\(\w*)\;\\/))&&f[1])f=f[1],k("controlWord",f,f.length+2),b-=1;else if((f=c.match(/^\\(\w*)\;\}/))&&f[1])f=f[1],k("controlWord",f,f.length+2),b-=1;else if((f=c.match(/^\\(\w*)/))&&f[1])f=f[1],k("controlWord",f,f.length+1),b=a.length;else if("{"!=c[0]&&
"}"!=c[0]&&"\\"!=c[0])f=c.indexOf("{"),h=c.indexOf("}"),i=c.indexOf("\\"),j=c.length,f=-1==f?j+1:f,h=-1==h?j+1:h,i=-1==i?j+1:i,f=Math.min(f,h,i),-1!=f&&0!=f?(k("text",c.substring(0,f),f),""==c&&(b=a.length)):(k("text",c,c.length+1),b=a.length);else if(h==b){console.log("Error, simbolo no conocido: <<["+c+"]>>");return}return d};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.RTFParser=function(e){this.evaluator=e;this.tokenizer=new a.RTFTokenizer};a.RTFParser.prototype.parse=
function(e){var e=this.tokenizer.tokenize(e),e=checkMathSymboslInFormula(e),d={},c,b=2;if("openBlock"==e[0].type&&"fonttbl"==e[1].value){for(c=e[0].value;"closeBlock"!=e[b].type&&e[b].value!=c;)d[e[b].value]=e[b+2].value.substring(0,e[b+2].value.length-1),b+=3;b++}var g={},f=0,h,i,j;if("openBlock"==e[b].type&&"colortbl"==e[b+1].value){c=e[b++].value;for(b++;"closeBlock"!=e[b].type&&e[b].value!=c;)h=parseInt(e[b++].value.substring(3)).toString(16),i=parseInt(e[b++].value.substring(5)).toString(16),
j=parseInt(e[b++].value.substring(4)).toString(16),g[f++]="#"+(2>h.length?"0"+h:h)+(2>i.length?"0"+i:i)+(2>j.length?"0"+j:j);b++}c=new a.RTFNode(this.evaluator,"","textBlock","",!1,"");f=new a.RTFNode(this.evaluator,"","textLineBlock","",!1,"");c.addChild(f);for(var k,l,m,o=j=i=h=!1,q=!1,p=!1,r=[new a.FontStyle(20,"Arial","","",!1,!1,null)],n=r[0],t=!0,v=-1,u=-1,s=[],y=!1,x=!1,z=!1,B=e.length;b<B;b++)if("controlWord"==e[b].type&&d[e[b].value])n.fontType=d[e[b].value];else if("controlWord"==e[b].type&&
e[b].value.match(/^fs(\d+)/))n.fontSize=parseInt(e[b].value.match(/^fs(\d+)/)[1]/2);else if("controlWord"==e[b].type&&"b"==e[b].value)n.textBold="bold";else if("controlWord"==e[b].type&&"b0"==e[b].value)n.textBold="";else if("controlWord"==e[b].type&&"i"==e[b].value)n.textItalic="italic";else if("controlWord"==e[b].type&&"i0"==e[b].value)n.textItalic="";else if("controlWord"==e[b].type&&"ul"==e[b].value)n.textUnderline=!0;else if("controlWord"==e[b].type&&"ulnone"==e[b].value)n.textUnderline=!1;else if("controlWord"==
e[b].type&&"ol"==e[b].value)n.textOverline=!0;else if("controlWord"==e[b].type&&"olnone"==e[b].value)n.textOverline=!1;else if("controlWord"==e[b].type&&e[b].value.match(/^cf(\d+)/))n.textColor=g[parseInt(e[b].value.substring(2))];else if("openBlock"==e[b].type)v=e[b].value,n=n.clone(),r.push(n),s.push(null);else if("closeBlock"==e[b].type)e[b].value==u&&(u=-1,h=!1),r.pop(),n=r[r.length-1],s.pop();else if("controlWord"==e[b].type&&"par"==e[b].value){f.addChild(new a.RTFNode(this.evaluator,"","newLine",
n));c=new a.RTFNode(this.evaluator,"","textLineBlock",n);if("textBlock"!=f.nodeType)for(f=f.parent;"textBlock"!=f.nodeType;)f=f.parent;f.addChild(c);f=c}else if("controlWord"==e[b].type&&"mjaformula"==e[b].value)y=!0,u=v,h=!0,c=new a.RTFNode(this.evaluator,"","formula",n.clone()),f.addChild(c),f=c,s[s.length-1]=c;else if("controlWord"==e[b].type&&("fraction"==e[b].value||"radicand"==e[b].value||"radical"==e[b].value||"what"==e[b].value||"sum"==e[b].value||"integral"==e[b].value||"limit"==e[b].value)){var w=
s[s.length-2].style.clone();c=new a.RTFNode(this.evaluator,"",e[b].value,w);s[s.length-2].addChild(c);s[s.length-1]=c}else if("controlWord"==e[b].type&&"index"==e[b].value||"to"==e[b].value||"from"==e[b].value)w=s[s.length-2].style.clone(),w.fontSize=parseInt(w.fontSize-0.2*w.fontSize),8>w.fontSize&&(w.fontSize=8),c=new a.RTFNode(this.evaluator,"",e[b].value,w),s[s.length-2].addChild(c),s[s.length-1]=c;else if("controlWord"==e[b].type&&("num"==e[b].value||"den"==e[b].value))w=s[s.length-2].style.clone(),
w.fontSize=Math.round(w.fontSize-0.1*w.fontSize),8>w.fontSize&&(w.fontSize=8),"num"==e[b].value?c=new a.RTFNode(this.evaluator,"","numerator",w):"den"==e[b].value&&(c=new a.RTFNode(this.evaluator,"","denominator",w)),s[s.length-2].addChild(c),s[s.length-1]=c;else if("controlWord"==e[b].type&&("subix"==e[b].value||"supix"==e[b].value))w=s[s.length-2].style.clone(),w.fontSize=Math.floor(w.fontSize-w.fontSize/3),8>w.fontSize&&(w.fontSize=8),"subix"==e[b].value?c=new a.RTFNode(this.evaluator,"","subIndex",
w):"supix"==e[b].value&&(c=new a.RTFNode(this.evaluator,"","superIndex",w)),c.originalStyle=s[s.length-2].style.clone(),s[s.length-2].addChild(c),s[s.length-1]=c;else if("controlWord"==e[b].type&&("defparts"==e[b].value||"matrix"==e[b].value||"element"==e[b].value))w=s[s.length-2].style.clone(),c=new a.RTFNode(this.evaluator,"",e[b].value,w),s[s.length-2].addChild(c),s[s.length-1]=c,"defparts"==e[b].value?m=c:"matrix"==e[b].value&&(l=c);else if("controlWord"==e[b].type&&"parts"==e[b].value)p=!0;else if("text"==
e[b].type&&p)m.parts=parseInt(e[b].value),p=!1;else if("controlWord"==e[b].type&&"rows"==e[b].value)o=!0;else if("text"==e[b].type&&o)l.rows=parseInt(e[b].value),o=!1;else if("controlWord"==e[b].type&&"columns"==e[b].value)q=!0;else if("text"==e[b].type&&q)l.columns=parseInt(e[b].value),q=!1;else if("controlWord"==e[b].type&&"expr"==e[b].value)t=!1,i=!0;else if("controlWord"==e[b].type&&"decimals"==e[b].value)j=!0;else if("text"==e[b].type&&j)k.decimals=this.evaluator.parser.parse(e[b].value),j=!1;
else if("controlWord"==e[b].type&&"fixed1"==e[b].value)k.fixed=!0;else if("controlWord"==e[b].type&&"fixed0"==e[b].value)k.fixed=!1;else if(!("controlWord"==e[b].type&&"component"==e[b].value))if("controlWord"==e[b].type&&"NumCtrl"==e[b].value)x=!0;else if("controlWord"==e[b].type&&"Space"==e[b].value)z=!0;else if("text"==e[b].type&&x)c=new a.RTFNode(this.evaluator,e[b].value,"componentNumCtrl",n.clone()),f.addChild(c),x=!1;else if("text"==e[b].type&&z)c=new a.RTFNode(this.evaluator,e[b].value,"componentSpace",
n.clone()),f.addChild(c),z=!1;else if("text"==e[b].type&&i)w=s[s.length-2].style.clone(),textContent=this.evaluator.parser.parse("''+("+e[b].value+")"),c=new a.RTFNode(this.evaluator,textContent,"dynamicText",w),s[s.length-2].addChild(c),k=s[s.length-1]=c,i=!1;else if("text"==e[b].type&&!i&&!h){textContent=e[b].value;c=new a.RTFNode(this.evaluator,textContent,"text",n.clone());if("textLineBlock"!=f.nodeType)for(f=f.parent;"textLineBlock"!=f.nodeType;)f=f.parent;f.addChild(c)}else if("text"==e[b].type&&
!i&&h)textContent=e[b].value,c=new a.RTFNode(this.evaluator,textContent,"text",s[s.length-1].style.clone()),s[s.length-1].addChild(c);else if("("==e[b].type||")"==e[b].type||"+"==e[b].type||"-"==e[b].type||"*"==e[b].type||"="==e[b].type)c=new a.RTFNode(this.evaluator,e[b].type,"mathSymbol",s[s.length-1].style.clone()),s[s.length-1].addChild(c);if(null!=f){var A=f.getRoot();A.stableWidth=t;A.getTextMetrics();A.hasFormula=y}return A};a.FontStyle=function(a,d,c,b,g,f,h){this.fontSize=a;this.fontType=
d;this.textItalic=c;this.textBold=b;this.textUnderline=g;this.textOverline=f;this.textColor=h};a.FontStyle.prototype.toString=function(){return(this.textBold+" "+this.textItalic+" "+this.fontSize+"px "+this.fontType).trim()};a.FontStyle.prototype.toCSS=function(){var a="style='font-family: "+this.fontType+"; font-size: "+this.fontSize+"px; ";this.textUnderline&&!this.textOverline&&(a+="text-decoration: underline; ");!this.textUnderline&&this.textOverline&&(a+="text-decoration: overline; ");this.textUnderline&&
this.textOverline&&(a+="text-decoration: underline overline; ");this.textBold&&!this.textItalic&&(a+="font-style: normal; font-weight: bold; ");!this.textBold&&this.textItalic&&(a+="font-style: italic; font-weight: normal; ");this.textBold&&this.textItalic&&(a+="font-style: italic; font-weight: bold; ");!this.textBold&&!this.textItalic&&(a+="font-style: normal; font-weight: normal; ");this.textColor&&(a+="color: "+this.textColor+"; ");return a+"'"};a.FontStyle.prototype.clone=function(){return new a.FontStyle(this.fontSize,
this.fontType,this.textItalic,this.textBold,this.textUnderline,this.textOverline,this.textColor)};checkMathSymboslInFormula=function(a){for(var d=[],c=!1,b=!1,g=[],f=0,h=a.length;f<h;f++){"openBlock"==a[f].type&&g.push(a[f].value);"closeBlock"==a[f].type&&(g.pop(),0>=g.length&&(c=!1));if("controlWord"==a[f].type&&("expr"==a[f].value||"decimals"==a[f].value))b=!0;"controlWord"==a[f].type&&"mjaformula"==a[f].value&&(c=!0);if("text"==a[f].type&&c&&!b){for(var i=0,j=a[f].value,k="",l=0,m=j.length;l<m;l++)if("("==
j.charAt(l)||")"==j.charAt(l)||"+"==j.charAt(l)||"-"==j.charAt(l)||"*"==j.charAt(l)||"="==j.charAt(l))k=j.substring(i,l),""!=k&&d.push({type:"text",value:k}),d.push({type:j.charAt(l),value:j.charAt(l)}),i=l+1;k=j.substring(i,l);""!=k&&d.push({type:"text",value:k})}else d.push(a[f]),"text"==a[f].type&&b&&(b=!1)}return d};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=Math.floor;a.Space=function(a,c){this.parent=a;this.evaluator=this.parent.evaluator;var b=this.evaluator.parser;
this.values=c;this.type="R2";this.xExpr=b.parse("0");this.yExpr=b.parse("0");this.w=parseInt(a.container.width);this.h=parseInt(a.container.height);this.drawif=b.parse("1");this.fixed=2!=this.parent.version?!1:!0;this.scale=48;this.Oy=this.Ox=0;this.image=new Image;this.image.onload=function(){this.ready=1};this.imageSrc="";this.bg_display="topleft";this.background="descinst.com.mja.descartes.DescartesJS.class"==this.parent.code?"#f0f8fa":"#ffffff";this.net=2!=this.parent.version?"#c0c0c0":"";this.net10=
2!=this.parent.version?"#808080":"";this.axes=2!=this.parent.version?"#808080":"";this.text="#ffafaf";this.numbers=!1;this.y_axis=this.x_axis="";this.sensitive_to_mouse_movements=!1;this.cID="";this.mouse_y=this.mouse_x=0;this.ctrs=[];this.graphics=[];this.zIndex=a.zIndex;this.plecaHeight=this.parent.plecaHeight||0;this.displaceRegionNorth=this.parent.displaceRegionNorth||0;this.displaceRegionWest=this.parent.displaceRegionWest||0;for(var e in c)c.hasOwnProperty(e)&&(this[e]=c[e]);this.init()};a.Space.prototype.init=
function(){this.displaceRegionNorth=this.parent.displaceRegionNorth||0;this.displaceRegionWest=this.parent.displaceRegionWest||0;var a=this.parent,c=this.evaluator,b=this.id,e,f=parseInt(this.parent.container.height),h=parseInt(this.parent.container.width);c.setVariable(b+"._w",this.w);c.setVariable(b+"._h",this.h);this.x=c.evalExpression(this.xExpr)+this.displaceRegionWest;this.y=c.evalExpression(this.yExpr)+this.plecaHeight+this.displaceRegionNorth;this.container&&(this.container.style.left=this.x+
"px",this.container.style.top=this.y+"px");0<=this.y?(e=f-this.y,this.h>e&&(this.h=e)):(e=this.h+this.y,this.h=e>=f?f:e);0<=this.x?(e=h-this.x,this.w>e&&(this.w=e)):(e=this.w+this.x,this.w=e>=h?h:e);if(""!=this.imageSrc||!this.imageSrc.toLowerCase().match(/vacio.gif$/))this.image=a.getImage(this.imageSrc);this.OxExpr&&(h=this.OxExpr,"%"==h[h.length-1]?this.Ox=this.w*parseFloat(h)/100:(a=parseFloat(h),a!=h&&(a=0),this.Ox=a));this.OyExpr&&(h=this.OyExpr,"%"==h[h.length-1]?this.Oy=this.h*parseFloat(h)/
100:(a=parseFloat(h),a!=h&&(a=0),this.Oy=a));2!=this.parent.version?(c.setVariable(b+"._w",this.w),c.setVariable(b+"._h",this.h),c.setVariable(b+".escala",this.scale),c.setVariable(b+".Ox",this.Ox),c.setVariable(b+".Oy",this.Oy),c.setVariable(b+".mouse_x",0),c.setVariable(b+".mouse_y",0),c.setVariable(b+".mouse_pressed",0)):(c.setVariable("_w",this.w),c.setVariable("_h",this.h),c.setVariable("escala",this.scale),c.setVariable("Ox",this.Ox),c.setVariable("Oy",this.Oy),c.setVariable("mouse_x",0),c.setVariable("mouse_y",
0),c.setVariable("mouse_pressed",0))};a.Space.prototype.addCtr=function(a){this.ctrs.push(a)};a.Space.prototype.addGraph=function(a){this.graphics.push(a)};a.Space.prototype.getRelativeX=function(a){return(a-e(this.w/2+this.Ox))/this.scale};a.Space.prototype.getRelativeY=function(a){return(-a+e(this.h/2+this.Oy))/this.scale};a.Space.prototype.getAbsoluteX=function(a){return a*this.scale+e(this.w/2+this.Ox)};a.Space.prototype.getAbsoluteY=function(a){return-a*this.scale+e(this.h/2+this.Oy)};a.Space.prototype.findOffset=
function(){var a=this.container,c;for(this.offsetTop=this.offsetLeft=0;a;){c=null;a.getAttribute&&(c=a.getAttribute("class"));if(c&&("DescartesSpace2DContainer"==c||"DescartesAppContainer"==c))this.offsetLeft+=a.offsetLeft,this.offsetTop+=a.offsetTop;a=a.parentNode}};a.Space.prototype.getCursorPosition=function(d){d=a.getCursorPosition(d);return{x:d.x-this.offsetLeft,y:d.y-this.offsetTop}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var e=Math.floor,d=Math.round,c=2*Math.PI;
a.Space2D=function(b,d){a.Space.call(this,b,d);this.backgroundCanvas=document.createElement("canvas");this.backgroundCanvas.setAttribute("id",this.id+"_background");this.backgroundCanvas.setAttribute("width",this.w+"px");this.backgroundCanvas.setAttribute("height",this.h+"px");this.backgroundCtx=this.backgroundCanvas.getContext("2d");this.canvas=document.createElement("canvas");this.canvas.setAttribute("id",this.id+"_canvas");this.canvas.setAttribute("width",this.w+"px");this.canvas.setAttribute("height",
this.h+"px");this.canvas.setAttribute("class","DescartesSpace2DCanvas");this.canvas.setAttribute("style","z-index: "+this.zIndex+";");this.ctx=this.canvas.getContext("2d");this.graphicControlContainer=document.createElement("div");this.graphicControlContainer.setAttribute("id",this.id+"_graphicControls");this.graphicControlContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index: "+this.zIndex+";");this.numericalControlContainer=document.createElement("div");this.numericalControlContainer.setAttribute("id",
this.id+"_numericalControls");this.numericalControlContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index: "+this.zIndex+";");this.container=document.createElement("div");this.container.setAttribute("id",this.id);this.container.setAttribute("class","DescartesSpace2DContainer");this.container.setAttribute("style","left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.container.appendChild(this.backgroundCanvas);this.container.appendChild(this.canvas);this.container.appendChild(this.graphicControlContainer);
this.container.appendChild(this.numericalControlContainer);b.container.insertBefore(this.container,b.loader);this.findOffset();this.drawBefore=0<this.evaluator.evalExpression(this.drawif);this.registerMouseEvents()};a.extend(a.Space2D,a.Space);a.Space2D.prototype.update=function(a){var d=2!=this.parent.version?this.id+".Ox":"Ox",c=2!=this.parent.version?this.id+".Oy":"Oy",e=2!=this.parent.version?this.id+".escala":"escala",i=this.evaluator;i.setVariable(this.id+"._w",this.w);i.setVariable(this.id+
"._h",this.h);var j=this.x!=i.evalExpression(this.xExpr)+this.displaceRegionWest,k=this.y!=i.evalExpression(this.yExpr)+this.parent.plecaHeight+this.displaceRegionNorth;this.spaceChange=a||j||k||this.drawBefore!=0<i.evalExpression(this.drawif)||this.Ox!=i.getVariable(d)||this.Oy!=i.getVariable(c)||this.scale!=i.getVariable(e);this.x=j?i.evalExpression(this.xExpr)+this.displaceRegionWest:this.x;this.y=k?i.evalExpression(this.yExpr)+this.parent.plecaHeight+this.displaceRegionNorth:this.y;this.Ox=i.getVariable(d);
this.Oy=i.getVariable(c);this.scale=i.getVariable(e);this.drawBefore=0<i.evalExpression(this.drawif);1.0E-6>this.scale?(this.scale=1.0E-6,i.setVariable(e,0)):1E6<this.scale&&(this.scale=1E6,i.setVariable(e,1E6));j&&(this.container.style.left=this.x+"px");k&&(this.container.style.top=this.y+"px");(j||k)&&this.findOffset();if(0<i.evalExpression(this.drawif)){this.container.style.display="block";d=0;for(c=this.graphics.length;d<c;d++)a=this.graphics[d],""!=a.trace&&!this.spaceChange&&!this.click&&!a.background&&
a.drawTrace();this.drawBackground();this.draw()}else this.container.style.display="none"};a.Space2D.prototype.drawBackground=function(){if(this.spaceChange){var b=this.evaluator,d=this.backgroundCtx;d.clearRect(0,0,this.backgroundCanvas.width,this.backgroundCanvas.height);d.fillStyle=a.getColor(b,this.background);d.fillRect(0,0,this.backgroundCanvas.width,this.backgroundCanvas.height);this.image&&""!=this.image.src&&this.image.ready&&this.image.complete&&("topleft"==this.bg_display?d.drawImage(this.image,
0,0):"stretch"==this.bg_display?d.drawImage(this.image,0,0,this.w,this.h):"patch"==this.bg_display?(d.fillStyle=d.createPattern(this.image,"repeat"),d.fillRect(0,0,this.canvas.width,this.canvas.height)):"center"==this.bg_display&&d.drawImage(this.image,(this.w-this.image.width)/2,(this.h-this.image.height)/2));for(var c=this.scale,h=0;c>this.w+this.h;)c/=10,h++;for(;c<(this.w+this.h)/10;)c*=10;d.lineWidth=1;""!=this.net&&(d.strokeStyle=a.getColor(b,this.net),this.drawMarks(d,c/10,-1));""!=this.net10&&
(d.strokeStyle=a.getColor(b,this.net10),this.drawMarks(d,c,-1));""!=this.axes&&(d.strokeStyle=a.getColor(b,this.axes),d.beginPath(),d.moveTo(e(this.w/2+this.Ox)+0.5,0),d.lineTo(e(this.w/2+this.Ox)+0.5,this.h),d.moveTo(0,e(this.h/2+this.Oy)+0.5),d.lineTo(this.w,e(this.h/2+this.Oy)+0.5),d.stroke(),this.drawMarks(d,c,4),this.drawMarks(d,c/2,2),this.drawMarks(d,c/2/5,1));if(""!=this.x_axis||""!=this.y_axis)d.fillStyle=a.getColor(b,this.axes),d.font="12px Arial",d.textAlign="right",d.textBaseline="top",
d.fillText(this.x_axis,e(this.w)-2,e(this.h/2+this.Oy)),d.fillText(this.y_axis,e(this.w/2+this.Ox)-2,0);this.numbers&&""!=this.axes&&(d.fillStyle=a.getColor(b,this.axes),d.font="12px Arial",d.textAlign="start",d.textBaseline="bottom",c>(this.w+this.h)/2?this.drawNumbers(d,c/5,c<=this.scale?h+1:h):c>(this.w+this.h)/4?this.drawNumbers(d,c/2,c<=this.scale?h+1:h):this.drawNumbers(d,c,h));b=0;for(d=this.graphics.length;b<d;b++)c=this.graphics[b],c.background&&c.draw()}};a.Space2D.prototype.draw=function(){var b=
this.ctx;b.clearRect(0,0,this.canvas.width,this.canvas.height);for(var d=0,f=this.graphics.length;d<f;d++){var h=this.graphics[d];h.background||h.draw()}d=0;for(f=this.ctrs.length;d<f;d++)h=this.ctrs[d],"graphic"==h.type&&h.draw();if(""!=this.text&&this.click&&"LEFT"==this.whichButton){b.fillStyle=a.getColor(this.evaluator,this.text);b.strokeStyle=b.fillStyle;b.font="12px Courier New";b.textAlign="center";b.textBaseline="bottom";var d=1>=this.scale?this.mouse_x.toFixed(0):this.mouse_x.toFixed(this.scale.toString().length),
f=1>=this.scale?this.mouse_y.toFixed(0):this.mouse_y.toFixed(this.scale.toString().length),d="("+d+","+f+")",f=b.measureText(d).width,h=this.getAbsoluteX(this.mouse_x),i=this.getAbsoluteY(this.mouse_y),j=e(h),k=e(i-10);j+f/2>this.w?j=this.w-f/2:0>j-f/2&&(j=f/2);k+1>this.h?k=this.h:0>k-14&&(k=15);b.fillText(d,j,k);b.beginPath();b.arc(h,i,2.5,0,c,!0);b.stroke()}};a.Space2D.prototype.drawMarks=function(a,c,f){var h=this.w,i=this.h,j,k=0,l=h,m=0,o=i,q=e(h/2+this.Ox),p=e(i/2+this.Oy);0<=f&&(k=q-f,l=q+
f,m=p-f,o=p+f);a.beginPath();for(f=-d(q/c);(j=q+d(f*c))<h;f++)a.moveTo(j+0.5,m+0.5),a.lineTo(j+0.5,o+0.5);for(f=-d(p/c);(h=p+d(f*c))<i;f++)a.moveTo(k+0.5,h+0.5),a.lineTo(l+0.5,h+0.5);a.stroke()};a.Space2D.prototype.drawNumbers=function(a,c){for(var f=this.w,h=this.h,i,j=e(f/2+this.Ox),k=e(h/2+this.Oy),l=-d(j/c);(i=j+d(l*c))<f;l++)a.fillText(parseFloat((l*c/this.scale).toFixed(4)),i+2,k-2);for(l=-d(k/c);(f=k+d(l*c))<h;l++)a.fillText(parseFloat((-l*c/this.scale).toFixed(4)),j+2,f-2)};a.Space2D.prototype.registerMouseEvents=
function(){function b(a){l.click=1;l.parent.evaluator.setVariable(l.id+".mouse_pressed",1);l.parent.deactivateGraphiControls();i(a);l.parent.update();window.addEventListener("touchmove",k,!1);window.addEventListener("touchend",d,!1);a.preventDefault()}function d(a){l.click=0;l.parent.evaluator.setVariable(l.id+".mouse_pressed",0);window.removeEventListener("touchmove",k,!1);window.removeEventListener("touchend",d,!1);l.parent.update();a.preventDefault();l.parent.update()}function c(a){l.click=1;l.parent.evaluator.setVariable(l.id+
".mouse_pressed",1);l.parent.deactivateGraphiControls();l.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"RIGHT"==l.whichButton&&(window.addEventListener("mouseup",h,!1),l.fixed||(l.clickPosForZoom=l.getCursorPosition(a).y,l.tempScale=l.scale,window.addEventListener("mousemove",j,!1)));"LEFT"==l.whichButton&&(l.parent.evaluator.setVariable(l.id+".mouse_pressed",1),i(a),window.addEventListener("mousemove",k,!1),window.addEventListener("mouseup",
h,!1));a.preventDefault()}function h(a){l.click=0;l.parent.evaluator.setVariable(l.id+".mouse_pressed",0);a.preventDefault();"RIGHT"==l.whichButton&&window.removeEventListener("mousemove",j,!1);l.sensitive_to_mouse_movements||window.removeEventListener("mousemove",k,!1);window.removeEventListener("mouseup",h,!1);l.parent.update();l.parent.update()}function i(a){l.posAnte=l.getCursorPosition(a);l.mouse_x=l.getRelativeX(l.posAnte.x);l.mouse_y=l.getRelativeY(l.posAnte.y);l.parent.evaluator.setVariable(l.id+
".mouse_x",l.mouse_x);l.parent.evaluator.setVariable(l.id+".mouse_y",l.mouse_y);l.parent.update()}function j(a){l.clickPosForZoomNew=l.getCursorPosition(a).y;l.evaluator.setVariable(2!=l.parent.version?l.id+".escala":"escala",l.tempScale+l.tempScale/45*((l.clickPosForZoom-l.clickPosForZoomNew)/10));l.parent.update();a.preventDefault()}function k(a){if(!l.fixed){l.posNext=l.getCursorPosition(a);var b=e(l.posAnte.x-l.posNext.x),d=e(l.posAnte.y-l.posNext.y),c=2!=l.parent.version?l.id+".Oy":"Oy";l.parent.evaluator.setVariable(2!=
l.parent.version?l.id+".Ox":"Ox",l.Ox-b);l.parent.evaluator.setVariable(c,l.Oy-d);l.posAnte.x-=b;l.posAnte.y-=d}l.click&&i(a);a.preventDefault()}var l=this,m=a.hasTouchSupport;this.canvas.oncontextmenu=function(){return!1};m&&(this.sensitive_to_mouse_movements&&this.canvas.addEventListener("touchmove",i,!1),this.canvas.addEventListener("touchstart",b,!1));m||(this.sensitive_to_mouse_movements&&this.canvas.addEventListener("mousemove",i,!1),this.canvas.addEventListener("mousedown",c,!1))};return a}(descartesJS||
{}),descartesJS=function(a){if(a.loadLib)return a;a.SpaceAP=function(e,d){a.Space.call(this,e,d);this.exportarVars=this.importarVars=null;var c=e.evaluator;this.file=this.file.match(/^\[/)&&this.file.match(/\]$/)?c.parser.parse(this.file.substring(1,this.file.length-1)):this.file.match(/^\'/)&&this.file.match(/\'$/)?c.parser.parse(this.file):c.parser.parse("'"+this.file+"'");this.oldFile=c.evalExpression(this.file);this.initFile()};a.extend(a.SpaceAP,a.Space);a.SpaceAP.prototype.initFile=function(){this.firstUpdate=
!0;var e;if(this.oldFile){var d=document.getElementById(this.oldFile);e=d&&"descartes/spaceApFile"==d.type?d.text:a.openExternalFile(this.oldFile);null!=e&&(e=e.split("\n"))}if(e&&e.toString().match(/<applet/gi)){for(var d="",c=!1,b=0,g=e.length;b<g&&!(e[b].match("<applet")&&(c=!0),c&&(d+=e[b]),e[b].match("</applet"));b++);b=document.createElement("div");b.innerHTML=d;b.firstChild.setAttribute("width",this.w);b.firstChild.setAttribute("height",this.h);d=this.descApp?this.descApp.container:null;this.descApp=
new a.DescartesApp(b.firstChild);this.descApp.container.setAttribute("class","DescartesAppContainer");this.descApp.container.setAttribute("style","position: absolute; overflow: hidden; background-color: "+this.background+"; width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");d?this.parent.container.replaceChild(this.descApp.container,d):this.parent.container.insertBefore(this.descApp.container,this.parent.loader);d=this.descApp.spaces;b=0;
for(g=d.length;b<g;b++)d[b].findOffset();this.descApp.container.style.display=0<this.evaluator.evalExpression(this.drawif)?"block":"none";var f=this;this.descApp.update=function(){this.updateAuxiliaries();this.updateEvents();this.updateControls();this.updateSpaces();f.exportar()}}else d=this.descApp?this.descApp.container:null,this.descApp={},this.descApp.container=document.createElement("div"),this.descApp.container.setAttribute("class","DescartesAppContainer"),b="position: absolute; overflow: hidden; background-color: "+
this.background+"; width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";",this.image&&("topleft"==this.bg_display?b+="background-image: url("+this.imageSrc+"); background-repeat:no-repeat;":"stretch"==this.bg_display?b+="background-image: url("+this.imageSrc+"); background-repeat:no-repeat; background-size: 100% 100%;":"patch"==this.bg_display?b+="background-image: url("+this.imageSrc+");":"center"==this.bg_display&&(b+="background-image: url("+
this.imageSrc+"); background-repeat:no-repeat; background-position: center center;")),this.descApp.container.setAttribute("style",b),d?this.parent.container.replaceChild(this.descApp.container,d):this.parent.container.insertBefore(this.descApp.container,this.parent.loader),this.descApp.container.style.display=0<this.evaluator.evalExpression(this.drawif)?"block":"none"};a.SpaceAP.prototype.update=function(){var a=this.evaluator.evalExpression(this.file);if(this.oldFile!=a)this.oldFile=a,this.initFile();
else{var a=this.x!=this.evaluator.evalExpression(this.xExpr),d=this.y!=this.evaluator.evalExpression(this.yExpr)+this.plecaHeight;this.x=a?this.evaluator.evalExpression(this.xExpr):this.x;this.y=d?this.evaluator.evalExpression(this.yExpr)+this.plecaHeight:this.y;a&&(this.descApp.container.style.left=this.x+"px");d&&(this.descApp.container.style.top=this.y+"px");if(a||d)for(var a=this.descApp.spaces,d=0,c=a.length;d<c;d++)a[d].findOffset();this.descApp.container.style.display=0<this.evaluator.evalExpression(this.drawif)?
"block":"none";if(this.firstUpdate&&(this.firstUpdate=!1,null==this.importarVars)){this.importarVars=[];for(var b in this.evaluator.variables)this.evaluator.variables.hasOwnProperty(b)&&b.match(/^public./)&&this.importarVars.push({varName:b,value:this.evaluator.getVariable(b)})}this.importar()}};a.SpaceAP.prototype.importar=function(){for(var a,d=!1,c=0,b=this.importarVars.length;c<b;c++)a=this.evaluator.getVariable(this.importarVars[c].varName),a!=this.importarVars[c].value&&(this.importarVars[c].value=
a,this.descApp.evaluator.setVariable(this.importarVars[c].varName,this.importarVars[c].value),d=!0);d&&this.descApp.update()};a.SpaceAP.prototype.exportar=function(){};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.SpaceHTML_IFrame=function(e,d){a.Space.call(this,e,d);var c=this.parent.evaluator;this.file=this.file.match(/^\[/)&&this.file.match(/\]$/)?c.parser.parse(this.file.substring(1,this.file.length-1)):this.file.match(/^\'/)&&this.file.match(/\'$/)?c.parser.parse(this.file):
c.parser.parse("'"+this.file+"'");this.oldFile=c.evalExpression(this.file);this.MyIFrame=document.createElement("iframe");this.MyIFrame.setAttribute("src",this.oldFile);this.MyIFrame.setAttribute("id",this.id);this.MyIFrame.setAttribute("marginheight",0);this.MyIFrame.setAttribute("marginwidth",0);this.MyIFrame.setAttribute("frameborder",0);this.MyIFrame.setAttribute("scrolling","auto");this.MyIFrame.setAttribute("style","position: absolute; width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+
"px; top: "+this.y+"px;");this.MyIFrame.style.display=0<this.evaluator.evalExpression(this.drawif)?"block":"none";this.parent.container.insertBefore(this.MyIFrame,this.parent.loader);var b=this;this.MyIFrame.onload=function(){var a=this;b.evaluator.setFunction(b.id+".set",function(b,d){a.contentWindow.postMessage({type:"set",name:b,value:d},"*")});b.evaluator.setFunction(b.id+".update",function(){a.contentWindow.postMessage({type:"update"},"*")});b.evaluator.setFunction(b.id+".get",function(b,d){a.contentWindow.postMessage({type:"get",
name:b,value:d},"*")});b.evaluator.setFunction(b.id+".exec",function(b,d){a.contentWindow.postMessage({type:"exec",name:b,value:d},"*")})};this.evaluator.setVariable(this.id+"._scroll",0)};a.extend(a.SpaceHTML_IFrame,a.Space);a.SpaceHTML_IFrame.prototype.update=function(a){a&&(this.y=this.x=Math.Infinity);var a=this.evaluator,d=this.x!=a.evalExpression(this.xExpr)+this.displaceRegionWest,c=this.y!=a.evalExpression(this.yExpr)+this.parent.plecaHeight+this.displaceRegionNorth;this.x=d?a.evalExpression(this.xExpr)+
this.displaceRegionWest:this.x;this.y=c?a.evalExpression(this.yExpr)+this.parent.plecaHeight+this.displaceRegionNorth:this.y;var b=a.evalExpression(this.file);b!=this.oldFile&&(this.oldFile=b,this.MyIFrame.setAttribute("src",b));d&&(this.MyIFrame.style.left=this.x+"px");c&&(this.MyIFrame.style.top=this.y+"px");this.MyIFrame.style.display=0<a.evalExpression(this.drawif)?"block":"none";this.scrollVar=a.getVariable(this.id+"._scroll");1==this.scrollVar?this.MyIFrame.setAttribute("scrolling","yes"):-1==
this.scrollVar?this.MyIFrame.setAttribute("scrolling","no"):this.MyIFrame.setAttribute("scrolling","auto")};return a}(descartesJS||{}),babel=function(a){a.falso=a["false"]=a.fals=a.gezurra=a.faux=a.fals="false";a.verdadero=a["true"]=a.veritable=a.egia=a.vrai=a.verdadeiro=a.veritable="true";a.no=a.ez=a.non=a["n\u00e3o"]="false";a["s\u00ed"]=a.yes=a.bai=a.oui=a.si=a["sim "]="true";a.negro=a.black=a.negre=a.beltza=a.noir=a.preto="#000000";a.maxenta=a.magenta="#ff00ff";a.azul=a.blue=a.blau=a.urdina=a.bleu=
"#0000ff";a.turquesa=a.cyan=a.turkesa=a.turquoise="#00ffff";a.verde=a.green=a.verd=a.berdea=a.vert="#00ff00";a.amarillo=a.yellow=a.groc=a.horia=a.jaune=a.amarelo="#ffff00";a.naranja=a.orange=a.taronja=a.laranja=a.laranxa="#ffc800";a.rojo=a.red=a.vermell=a.gorria=a.rouge=a.vermello=a.vermelho="#ff0000";a.pink=a.rosa=a.arrosa=a.rose="#ffafaf";a.grisObscuro=a.darkGray=a.grisFosc=a["gris iluna"]=a.grisObscur=a.grisEscuro=a.cinzaEscuro="#404040";a.gris=a.gray=a.grisa=a.cinza="#808080";a.grisClaro=a.lightGray=
a.grisClar=a["gris argia"]=a.grisClair=a.cinzaClaro="#c0c0c0";a.blanco=a.white=a.blanc=a.zuria=a.branco="#ffffff";a.escala=a.scale=a.eskala=a["\u00e9chelle"]="scale";a.nombre=a.name=a.nom=a.izena=a.nome="name";a.ikusgai=a["vis\u00edvel"]=a.visible="visible";a.rastro=a.trace=a.rastre=a.arrastoa="trace";a.fondo=a.background=a.fons=a.hondoa=a.fond=a.fundo="background";a.colour=a.color=a.kolorea=a.couleur=a.cor="color";a["par\u00e1metro"]=a.parameter=a.parametroa=a["par\u00e2metro"]=a["par\u00e0metre"]=
"parameter";a["sucesi\u00f3n"]=a.sequence=a["successi\u00f3"]=a.segida=a.succession=a["seq\u00fc\u00eancia"]="sequence";a["tama\u00f1o"]=a.size=a.neurria=a.taille=a.tamanho=a["grand\u00e0ria"]="size";a.decimales=a.decimals=a.hamartarra=a["d\u00e9cimales"]=a.decimais="decimals";a.red=a.net=a.xarxa=a.sarea=a["r\u00e9seau"]=a.rede=a.malha="net";a.red10=a.net10=a.xarxa10=a.sarea10=a["r\u00e9seau10"]=a.rede10=a.malha10="net10";a.ejes=a.axes=a.eixos=a.ardatzak=a.eixes="axes";a.texto=a.text=a.testua=a.texte=
"text";a["cr\u00e9ditos"]=a.about=a["cr\u00e8dits"]=a.kreditoak=a["cr\u00e9dits"]=a.sobre="about";a.config=a.konfig=a["configura\u00e7\u00e3o"]="config";a.inicio=a.init=a.inici=a.hasiera=a.commencement=a["in\u00edcio"]="init";a.limpiar=a.clear=a.neteja=a.ezabatu=a.nettoye=a.limpar="clear";a.incr=a.gehi=a.incremento="incr";a.min=a.inf="min";a.max=a.sup=a["m\u00e1x"]="max";a.relleno=a.fill=a.ple=a.betea=a.plein=a.recheo=a.preencher="fill";a["relleno+"]=a["fill+"]=a["ple+"]=a["betea+"]=a["plein+"]=a["recheo+"]=
a["preencher+"]="fillP";a["relleno-"]=a["fill-"]=a["ple-"]=a["betea-"]=a["plein-"]=a["recheo-"]=a["preencher-"]="fillM";a.flecha=a.arrow=a.fletxa=a.gezia=a["fl\u00e8che"]=a.frecha=a.seta="arrow";a.ancho=a.width=a.ample=a.zabalera=a.large=a.largura="width";a.punta=a.spear=a.muturra=a.pointe=a.ponta="spear";a["regi\u00f3n"]=a.region=a["regi\u00f3"]=a.eskualde=a["r\u00e9gion"]=a["rexi\u00f3n"]=a["regi\u00e3o"]="region";a.norte=a.north=a.nord=a.ipar="north";a.sur=a.south=a.sud=a.hego=a.sul="south";a.este=
a.east=a.est=a.ekialde=a.leste="east";a.oeste=a.west=a.oest=a.hegoalde=a.ouest="west";a.exterior=a.external=a.kanpoalde=a.externo="external";a["expresi\u00f3n"]=a.expresion=a["expresi\u00f3"]=a.adierazpen=a["express\u00e3o"]="expresion";a.tipo=a.type=a.tipus=a.mota="type";a["posici\u00f3n"]=a.position=a["posici\u00f3"]=a.posizio=a["posi\u00e7\u00e3o"]="position";a["constricci\u00f3n"]=a.constraint=a["constricci\u00f3"]=a.beharte=a.constriction=a["constrici\u00f3n"]=a["restri\u00e7\u00e3o"]="constraint";
a.valor=a.value=a.balio=a.valeur="value";a["ecuaci\u00f3n"]=a.equation=a["equaci\u00f3"]=a.ekuazio=a["\u00e9quation"]=a["equa\u00e7\u00e3o"]="equation";a.curva=a.curve=a.corba=a.kurba=a.courbe="curve";a.texto=a.text=a.testu=a.texte="text";a.punto=a.point=a.punt=a.puntu=a.ponto="point";a.segmento=a.segment=a.zuzenki="segment";a.arco=a.arc=a.arku="arc";a["pol\u00edgono"]=a.polygon=a["pol\u00edgon"]=a.poligono=a.polygone="polygon";a.imagen=a.image=a.imatge=a.irudi=a.imaxe=a.imagem="image";a["Versi\u00f3n"]=
a.Version=a["Versi\u00f3"]=a["Vers\u00e3o"]="version";a.Idioma=a.Language=a.Hizkuntza=a.Langue="language";a["O.x"]="O.x";a["O.y"]="O.y";a.Botones=a.Buttons=a.Botons=a.Botoiak=a.Boutons=a["Bot\u00f3ns"]=a["Bot\u00f5es"]=a.Botons="Buttons";a["Animaci\u00f3n"]=a.Animation=a["Animaci\u00f3"]=a.Animazio=a["Anima\u00e7\u00e3o"]="Animation";a.constante=a.constant=a.Konstante="constant";a.fuente=a.font=a.iturri=a.source=a.fonte="font";a["num\u00e9rico"]=a.numeric=a["num\u00e8ric"]=a.zenbakizko=a["num\u00e9rique"]=
"numeric";a["gr\u00e1fico"]=a.graphic=a["gr\u00e0fic"]=a.grafiko=a.graphique="graphic";a.texto=a.text=a.testu=a.texte="text";a.inicio=a.init=a.inici=a.hasiera=a.commencement=a["in\u00edcio"]="init";a.hacer=a["do"]=a.fer=a.egin=a.faire=a.facer=a.fazer="do";a.mientras=a["while"]=a.mentre=a.bitartean=a["tandis que"]=a.mentres=a.enquanto="while";a.evaluar=a.evaluate=a.avalua=a.ebaluatu=a["\u00e9valuer"]=a.avaliar="evaluate";a.variable=a.aldagaia=a["vari\u00e1vel"]="variable";a["funci\u00f3n"]=a["function"]=
a["funci\u00f3"]=a.funtzio=a.fonction=a["fun\u00e7\u00e3o"]="function";a.algoritmo=a.algorithm=a.algorisme=a.algorithme="algorithm";a.vector=a.array=a.bektore=a.vecteur=a.matriz="array";a["dibujar-si"]=a["draw-if"]=a["marraztu-baldin"]=a["dessiner-si"]=a["debuxar-se"]=a["desenhar-se"]=a["dibuixa-si"]="drawif";a.dominio=a.range=a.domini=a["izate-eremua"]=a.domain=a["dom\u00ednio"]="range";a.pausa=a.delay=a.eten="delay";a["eje-x"]=a["x-axis"]=a["eix-x"]=a["x-ardatza"]=a["axe-x"]=a["eixe-x"]=a["eixo-x"]=
"x-axis";a["eje-y"]=a["y-axis"]=a["eix-y"]=a["y-ardatza"]=a["axe-y"]=a["eixe-y"]=a["eixo-y"]="y-axis";a["n\u00fameros"]=a.numbers=a.nombres=a.zenbakiak="numbers";a["exponencial-si"]=a["exponential-if"]=a["esponentzial-baldin"]=a["exponentiel-si"]=a["exponencial-se"]="exponentialif";a.familia=a.family=a["fam\u00edlia"]=a.famille="family";a.intervalo=a.interval=a.tarte=a.intervalle="interval";a.pasos=a.steps=a.passos=a.pausoak=a.pas="steps";a.centro=a.center=a.centre=a.zentro="center";a.radio=a.radius=
a.radi=a.erradio=a.rayon=a.raio="radius";a.fin=a.end=a.fi=a.bukaera=a.fim="end";a["una-sola-vez"]=a["only-once"]=a["una-sola-vegada"]=a["behin-bakarrik"]=a["une-seule-fois"]=a["unha-soa-vez"]=a["apenas-uma-vez"]="onlyOnce";a.siempre=a.always=a.sempre=a.beti=a.toujours="always";a["color-int"]=a["int-colour"]=a["barruko-kolore"]=a["couleur-int"]=a["cor-int"]="colorInt";a.repetir=a.loop=a.repeteix=a.errepikatu=a["r\u00e9p\u00e9ter"]="loop";a.controles=a.controls=a.kontrolak=a["contr\u00f4les"]=a.controis=
"controls";a.animar=a.animate=a.anima=a.animatu=a.animer="animate";a.auto="auto";a.alto=a.height=a.alt=a.altu=a.haut=a.altura="height";a.x=a.left="x";a.y=a.top="y";a.espacio=a.space=a.espai=a.espazio=a.espace=a.espazo=a["espa\u00e7o"]="space";a.Nu="Nu";a.Nv="Nv";a.ancho=a.depth=a.amplada=a.zabalera=a.largeur=a.ancho=a.profundidade=a.amplada="width";a.largo=a.length=a.llargada=a.luzera=a.longueur=a.longo=a.comprimento=a.llargada="length";a.alto=a.height=a["al\u00e7ada"]=a.altu=a.hauteur=a.alto=a.altura=
a["al\u00e7ada"]="height";a.color_reverso=a.backcolor=a.color_revers=a["atzealde kolorea"]=a.couleur_revers=a.cor_reverso=a.cor_de_fundo="backcolor";a.aristas=a.edges=a.arestes=a.ertzak=a["ar\u00eates"]=a.arestas="edges";a.rotini=a.inirot="inirot";a.posini=a.inipos="inipos";a["tri\u00e1ngulo"]=a.triangle=a.hirukia=a["tri\u00e2ngulo"]="triangle";a.cara=a.face=a.aurpegi="face";a.polireg=a.regpoly=a["pol\u00edgonoRegular"]="polireg";a.superficie=a.surface=a["superf\u00edcie"]=a.azalera="surface";a.macro=
a.makro="macro";a.id="id";a.modelo=a.model=a.eredu=a["mod\u00e8le"]="model";a.color=a.kolore=a.couleur=a.cor="color";a.luz=a.light=a.llum=a.argia=a["lumi\u00e8re"]="light";a.metal=a.metall=a["m\u00e9tal"]="metal";a.alambre=a.wire=a.filferro=a.alanbre=a["fil de fer"]=a.arame="wire";a.cortar=a.split=a.talla=a.moztu=a.couper=a.dividir="split";a.despliegue=a.render=a.desplegament=a.zabaltze=a["d\u00e8ploiement"]=a.despregamento=a.processar="render";a.orden=a.sort=a.ordre=a.ordena=a.orde=a.ordenar="sort";
a.pintor=a.painter=a.margolari=a.peintre="painter";a["trazado de rayos"]=a["ray trace"]=a["tra\u00e7at de raigs"]=a["izpi trazadura"]=a["trace de rayons"]=a["trazado de raios"]=a["tra\u00e7ado de raios"]="raytrace";a.imagen=a.bg_image=a.imatge=a.irudia=a.imaxe=a.imagem_de_fundo="image";a.despl_imagen=a.bg_display=a.despl_imatge=a["irudi desplazamendu"]=a.despl_image=a.despr_imaxe=a["apresenta\u00e7\u00e3o_de_imagem"]="bg_display";a["arr-izq"]=a.topleft=a["dalt-esq"]=a["goi-ezk"]=a["au-dessus-gau"]=
a["arr-esq"]=a["acima-esquerda"]="topleft";a["expand."]=a.stretch=a.hedatu=a["expandir "]="stretch";a.mosaico=a.patch=a.mosaic=a.mosaiko=a["mosa\u00efque"]="patch";a.centrada=a.center=a.zentratu=a["centr\u00e9e"]=a.centrado="center";a.archivo=a.file=a.fitxer=a.artxibo=a.fichier=a.arquivo="file";a.filas_norte=a.rows_north=a.files_nord=a["HTML kodea"]=a.files_nord=a.filas_norte=a.linhas_norte=a.files_nord="rowsNorth";a.filas_sur=a.rows_south=a.files_sud=a.ipar_lerro=a.files_sud=a.filas_sur=a.linhas_sul=
a.files_sud="rowsSouth";a.ancho_este=a.width_east=a.ample_est=a.hego_lerro=a.ample_est=a.ancho_leste=a.largura_leste=a.ample_est="widthEast";a.ancho_oeste=a.width_west=a.ample_oest=a.ekialde_zabalera=a.ample_ouest=a.ancho_oeste=a.largura_oeste=a.ample_oest="widthWest";a.fijo=a.fixed=a.fix=a.hegoalde_zabalera=a.fixe=a.fixo="fixed";a["Reiniciar Animaci\u00f3n"]=a["Init Animation"]=a["Reinicia Animaci\u00f3"]=a.finko=a["Recommencer l'Animation"]=a["Reiniciar Anima\u00e7\u00e3o"]="initAnimation";a["Explicaci\u00f3n"]=
a.Explanation=a.Azalpena=a.Explication=a["Explica\u00e7\u00e3o"]=a["Explicaci\u00f3"]="Explanation";a.tooltip=a.dica="tooltip";a.discreto=a.discrete=a.discret=a.diskretu="discrete";a.interfaz=a.gui=a["interf\u00edcie"]=a.interfaze=a["interface"]="gui";a.pulsador=a.spinner=a.polsador=a.pultsadore=a.bouton="spinner";a["campo de texto"]=a.textfield=a["camp de text"]=a["testu esarrua"]=a["champ de texte"]="textfield";a["men\u00fa"]=a.choice=a.menu=a.escolha="menu";a.barra=a.scrollbar=a.barre="scrollbar";
a.opciones=a.options=a.opcions=a.aukerak=a["opci\u00f3ns"]=a["op\u00e7\u00f5es"]="options";a.interior=a.barruko=a["int\u00e9rieur"]="interior";a["condici\u00f3n"]=a.condition=a["condici\u00f3"]=a.baldintza=a["condi\u00e7\u00e3o"]="condition";a["acci\u00f3n"]=a.action=a["acci\u00f3"]=a.ekintza=a["a\u00e7\u00e3o"]="action";a.evento=a.event=a.esdeveniment=a.gertaera=a["\u00e9v\u00e9nement"]="event";a["abrir URL"]=a["open URL"]=a["obre URL"]=a["URL zabaldu"]=a["ouvrir URL"]="openURL";a["abrir Escena"]=
a["open Scene"]=a["obre Escena"]=a["eszena zabaldu"]=a["ouvrir Escena"]=a["abrir Cena"]="openScene";a["bot\u00f3n"]=a.button=a["bot\u00f3"]=a.botoi=a.bouton=a["bot\u00e3o"]="button";a.mensaje=a.message=a.mezua=a.mensaxe=a.mensagem=a.missatge="message";a.alternar=a.alternate=a.alterna=a.txandakatu=a.alterner="alternate";a["ejecuci\u00f3n"]=a.execution=a["execuci\u00f3"]=a.gauzatze=a["ex\u00e9cution"]=a["execuci\u00f3n"]=a["execu\u00e7\u00e3o"]="execution";a.calcular=a.calculate=a.calcula=a.kalkulatu=
a.calculer="calculate";a.coord_abs=a.abs_coord=a.koor_abs="abs_coord";a.negrita=a.bold=a.negreta=a.lodi=a["caract\u00e8re gras"]=a.negra=a.negrito="bold";a.cursiva=a.italics=a.etzana=a.italique=a["it\u00e1lico"]="italics";a.subrayada=a.underlined=a.subratllat=a.azpimarratua=a.soulignement=a["subli\u00f1ada"]=a.sublinhado="underlined";a.imagen=a.image=a.imatge=a.irundia=a.imaxe=a.imagem="image";a.pos_mensajes=a.msg_pos=a.pos_missatges=a.mezuen_pos=a.pos_messages=a.pos_mensaxes="msg_pos";a.izquierda=
a.left=a.esquerra=a.eskerrean=a.gauche=a.esquerda=a.esquerda=a.esquerra="left";a.derecha=a.right=a.dreta=a.eskuinan=a.droite=a.dereita=a.direita=a.dreta="right";a["sensible_a_los_movimientos_del_rat\u00f3n"]=a.sensitive_to_mouse_movements=a["sensible_als_moviments_del_ratol\u00ed"]=a["xagu mugimenduarekiko sentikorra"]=a.sensible_aux_mouvements_du_souris=a.sensible_aos_movementos_do_rato=a["sens\u00edvel_aos_movimentos_do_mouse"]="sensitive_to_mouse_movements";a.reproducir=a.play=a.reprodueix=a.erreproduzitu=
a.reproduire=a.reproduzir="playAudio";a["activo-si"]=a["active-if"]=a["actiu-si"]=a["altiboa-baldin"]=a["actif-si"]=a["activo-se"]=a["ativo-se"]="activeif";a.rotfin=a.finrot=a.bukrot="endrot";a.posfin=a.finpos=a.bukpos="endpos";a.editable=a.editagarria=a["edit\u00e1vel"]="editable";a.tipo=a.type=a.tipus=a.mota="type";a.R2="R2";a.R3="R3";a.vectores=a.bektoreak=a.vecteurs=a.vetores=a.vectors="vectors";a["fuente puntos"]=a["font size"]=a["font punts"]=a["puntu iturria"]=a["source points"]=a["fonte puntos"]=
a["fonte pontos"]="font_size";a.SansSerif="SansSerif";a.Serif="Serif";a.Monoespaciada=a.Monospaced=a.Monoespazada="Monospaced";a["ecuaci\u00f3n"]=a.equation=a["equaci\u00f3"]=a.ekuazio=a["\u00e9quation"]=a["equa\u00e7\u00e3o"]="equation";a.punto=a.dot=a.punt=a.puntu=a.point=a.ponto="point";a.escenario=a.scenario=a.escenari=a.agertoki=a["sc\u00e8ne"]=a["cen\u00e1rio"]="scenario";a.cID="cID";a.matriz=a.matrix=a.matriu=a.matrice="matrix";a.filas=a.rows=a.files="rows";a.columnas=a.columns=a.colonnes=
"columns";a.solo_texto=a.only_text=a.seulement_texte=a["s\u00f3_texto"]=a.tan_sols_texte="onlyText";a.evaluar=a.evaluate="evaluate";a.respuesta=a.answer="answer";a.decimal_symbol=a["signo decimal"]=a["decimal symbol"]="decimal_symbol";a.info="info";a.color_contorn_text=a.color_text_border=a.color_borde_texto=a.muga_testuaren_kolorea=a.couleur_contour_texte=a.cor_borde_texto=a.colore_bordo_testo=a.cor_borda_texto=a.color_contorn_text="border";a.video=a["vid\u00e9o"]="video";a.audio=a["\u00e0udio"]=
"audio";a.autoplay="autoplay";a.loop="loop";a.poster="poster";a.opacidad=a.opacity=a["opacit\u00e9"]=a.opacitat=a.opacidade="opacity";a.alinear=a.align=a["ali\u00f1ar"]=a.aligner="align";return a}(babel||{}),descartesJS=function(a){if(a.loadLib)return a;a.Vector2D=function(a,d){this.x=a;this.y=d};a.Vector2D.AXIS_X=new a.Vector2D(1,0);a.Vector2D.AXIS_Y=new a.Vector2D(0,1);a.Vector2D.prototype.vectorLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.Vector2D.prototype.dotProduct=function(a){return this.x*
a.x+this.y*a.y};a.Vector2D.prototype.angleBetweenVectors=function(a){return Math.acos(this.dotProduct(a)/(this.vectorLength()*a.vectorLength()))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.DescartesApp=function(a){this.applet=a;this.externalVariables={};this.parentContainer=a.parentNode;this.width=a.getAttribute("width");this.height=a.getAttribute("height");this.decimal_symbol=".";this.childs=a.getElementsByTagName("param");this.code=a.getAttribute("code");this.saveState=
[];this.images={};this.images.length=-1;this.audios={};this.audios.length=-1;this.firstRun=!0;this.arquimedes=this.code.match("descinst.DescartesWeb2_0.class");this.init()};a.DescartesApp.prototype.init=function(){this.spaces=[];this.externalSpace={container:document.createElement("div"),controls:[]};this.northSpace={container:document.createElement("div"),controls:[]};this.southSpace={container:document.createElement("div"),controls:[]};this.eastSpace={container:document.createElement("div"),controls:[]};
this.westSpace={container:document.createElement("div"),controls:[]};this.specialSpace={container:document.createElement("div"),controls:[]};this.editableRegion={container:document.createElement("div"),textFields:[]};this.controls=[];this.auxiliaries=[];this.events=[];this.evaluator=new a.Evaluator(this);this.plecaHeight=this.tabindex=this.zIndex=0;this.lessonParser=new a.LessonParser(this);this.numberOfIframes=0;void 0!=this.container&&this.parentContainer.removeChild(this.container);this.container=
document.createElement("div");this.loader=document.createElement("div");this.parentContainer.appendChild(this.container);this.container.width=this.width;this.container.height=this.height;this.container.setAttribute("class","DescartesAppContainer");this.container.setAttribute("style","width: "+this.width+"px; height:"+this.height+"px;");this.container.appendChild(this.loader);this.loader.width=this.width;this.loader.height=this.height;this.loader.setAttribute("class","DescartesLoader");this.loader.setAttribute("style",
"width: "+this.width+"px; height:"+this.height+"px; z-index: 1000;");if(this.firstRun){var d=this,c="url("+e(this.loader.width,this.loader.height)+")";this.imageLoader=document.createElement("div");this.imageLoader.width=this.width;this.imageLoader.height=this.height;this.imageLoader.setAttribute("class","DescartesLoaderImage");this.imageLoader.setAttribute("style","background-image: "+c+"; width: "+this.width+"px; height:"+this.height+"px;");this.loader.appendChild(this.imageLoader);c=new Image;
c.onload=function(){d.imageLoader.setAttribute("style","background-image: url("+this.src+"); width: "+d.width+"px; height:"+d.height+"px; top: 0px; left: 0px")};c.src="images/DescartesLoader.png";this.loaderBar=document.createElement("canvas");this.loaderBar.width=this.width;this.loaderBar.height=this.height;this.loaderBar.setAttribute("class","DescartesLoaderBar");this.loaderBar.setAttribute("style","width: "+this.width+"px; height:"+this.height+"px;");this.loaderBar.ctx=this.loaderBar.getContext("2d");
this.loader.appendChild(this.loaderBar);this.barWidth=Math.floor(this.loader.width/10);this.barHeight=Math.floor(this.loader.height/70);this.timer=setInterval(function(){d.drawLoaderGraph(d.loaderBar.ctx,d.loaderBar.width,d.loaderBar.height)},10);this.firstRun=!1;this.initPreloader()}else this.initBuildApp()};a.DescartesApp.prototype.initAudio=function(d){var c=this;this.audios[d]=new Audio(d);this.audios[d].filename=d;var b=function(){this.ready=1},e=function(){!this.canPlayType("audio/"+this.filename.substring(this.filename.length-
3))&&"mp3"==this.filename.substring(this.filename.length-3)?(c.audios[d]=new Audio(this.filename.replace("mp3","ogg")),c.audios[d].filename=this.filename.replace("mp3","ogg"),c.audios[d].addEventListener("canplaythrough",b,!1),c.audios[d].addEventListener("load",b,!1),c.audios[d].addEventListener("error",e,!1),c.audios[d].load()):(console.log("El archivo '"+d+"' no puede ser reproducido"),this.errorload=1)};this.audios[d].addEventListener("canplaythrough",b,!1);this.audios[d].addEventListener("load",
b,!1);this.audios[d].addEventListener("error",e,!1);a.hasTouchSupport?(this.audios[d].load(),this.audios[d].play(),setTimeout(function(){console.log("detenido");c.audios[d].pause()},10),this.audios[d].ready=1):this.audios[d].load()};a.DescartesApp.prototype.initPreloader=function(){for(var a=0,c=this.childs.length;a<c;a++){var b=this.childs[a].value.match(/[\w-//]*(.png|.jpg|.gif|.svg|.PNG|.JPG|.GIF|.SVG)/g);if(b)for(var e,f=0,h=b.length;f<h;f++)e=b[f],!e.toLowerCase().match(/vacio.gif$/)&&""!=e.substring(0,
e.length-4)&&(this.images[e]=new Image,this.images[e].addEventListener("load",function(){this.ready=1},!1),this.images[e].addEventListener("error",function(){this.errorload=1},!1),this.images[e].src=e);if(b=this.childs[a].value.match(/[\w-//]*(.mp3|.wav|.MP3|.WAV)/g)){f=0;for(h=b.length;f<h;f++)e=b[f],this.initAudio(e)}this.childs[a].value.match(/vector|array|bektore|vecteur|matriz/g)&&this.childs[a].value.match(/archivo|file|fitxer|artxibo|fichier|arquivo/g)&&this.lessonParser.parseAuxiliar(this.childs[a].value)}var i=
this,j;for(j in this.images)this.images.hasOwnProperty(j)&&this.images.length++;for(j in this.audios)this.audios.hasOwnProperty(j)&&this.audios.length++;var k=function(){i.readys=0;var a=i.images.length,b;for(b in i.images)i.images.hasOwnProperty(b)&&(i.images[b].ready||i.images[b].errorload)&&i.readys++;var d=i.audios.length;for(b in i.audios)i.audios.hasOwnProperty(b)&&(i.audios[b].ready||i.audios[b].errorload)&&i.readys++;i.readys!=a+d?setTimeout(k,30):i.initBuildApp()};k()};a.DescartesApp.prototype.getImage=
function(a){if(a)return this.images[a]||(this.images[a]=new Image,this.images[a].src=a,this.images[a].addEventListener("load",function(){this.ready=1},!1),this.images[a].addEventListener("error",function(){this.errorload=1},!1)),this.images[a]};a.DescartesApp.prototype.getAudio=function(a){var c=this;if(!this.audios[a]){this.audios[a]=new Audio(a);this.audios[a].addEventListener("canplaythrough",function(){this.ready=1},!1);var b=function(){!this.canPlayType("audio/"+a.substring(a.length-3))&&"mp3"==
a.substring(a.length-3)?(c.audios[a]=new Audio(a.replace("mp3","ogg")),c.audios[a].addEventListener("canplaythrough",onCanPlayThrough,!1),c.audios[a].addEventListener("load",onCanPlayThrough,!1),c.audios[a].addEventListener("error",b,!1),c.audios[a].load()):(console.log("El archivo '"+a+"' no puede ser reproducido"),this.errorload=1)};this.audios[a].addEventListener("error",b,!1);this.audios[a].play();setTimeout(function(){c.audios[a].pause()},10)}return this.audios[a]};a.DescartesApp.prototype.drawLoaderGraph=
function(a,c,b){var e=2*(this.barWidth-2)/(this.images.length+this.audios.length);a.translate(c/2,b-50);a.scale(2,2);a.strokeRect(-this.barWidth,-this.barHeight,2*this.barWidth,this.barHeight);a.fillStyle="gray";a.fillRect(-this.barWidth+2,-this.barHeight+2,2*(this.barWidth-2),this.barHeight-4);a.fillStyle="#1f375d";a.fillRect(-this.barWidth+2,-this.barHeight+2,this.readys*e,this.barHeight-4);a.setTransform(1,0,0,1,0,0)};var e=function(a,c){var b=document.createElement("canvas");b.width=a;b.height=
c;var e=b.getContext("2d");e.save();e.strokeStyle="#1f375d";e.fillStyle="#1f375d";e.lineCap="round";e.lineWidth=2;e.beginPath();e.translate((a-360)/2,(c-195)/2);e.scale(3,3);e.moveTo(3,25);e.lineTo(3,1);e.lineTo(21,1);e.bezierCurveTo(33,1,41,15,41,25);e.stroke();e.beginPath();e.moveTo(1,63);e.lineTo(1,64);e.moveTo(5,62);e.lineTo(5,64);e.moveTo(9,61);e.lineTo(9,64);e.moveTo(13,60);e.lineTo(13,64);e.moveTo(17,58);e.lineTo(17,64);e.moveTo(21,56);e.lineTo(21,64);e.moveTo(25,53);e.lineTo(25,64);e.moveTo(29,
50);e.lineTo(29,64);e.moveTo(33,46);e.lineTo(33,64);e.moveTo(37,41);e.lineTo(37,64);e.moveTo(41,32);e.lineTo(41,64);e.stroke();e.font="20px Arial";e.fillText("escartes",45,33);e.fillText("JS",98,64);e.restore();return b.toDataURL()};a.DescartesApp.prototype.initBuildApp=function(){for(var a=this.childs,c=this.lessonParser,b=[],e=[],f=[],h=[],i=[],j=[],k,l=0,m=a.length;l<m;l++){k=a[l];if("pleca"==k.name){var o=c.parsePleca(k.value,this.width);this.container.insertBefore(o,this.loader);this.plecaHeight=
o.imageHeight?o.imageHeight:o.offsetHeight}"Buttons"==babel[k.name]?this.buttonsConfig=c.parseButtonsConfig(k.value):"decimal_symbol"==babel[k.name]?this.decimal_symbol=k.value:"version"==babel[k.name]?this.version=parseInt(k.value):"language"==babel[k.name]?this.language=k.value:"enable"==babel[k.getAttribute("enable")]?this.enable=babel[k.getAttribute("enable")]:k.name.match("rtf")?h.push("space='descartesJS_scenario' type='text' expresion='[10,20]' background='yes' text='"+k.value+"'"):"E"==k.name.charAt(0)?
(k.value.match(/'HTMLIFrame'/)&&this.numberOfIframes++,b.push(k.value)):"C"==k.name.charAt(0)&&"_"==k.name.charAt(1)?e.push(k.value):"A"==k.name.charAt(0)&&"Animation"!=babel[k.name]?f.push(k.value):"G"==k.name.charAt(0)?h.push(k.value):"S"==k.name.charAt(0)?i.push(k.value):"Animation"==babel[k.name]&&j.push(k.value)}this.scenarioRegion={container:document.createElement("div"),scroll:0};this.scenarioRegion.container.setAttribute("id","descartesJS_Scenario_Region");this.scenarioRegion.scenarioSpace=
this.lessonParser.parseSpace("tipo='R2' id='descartesJS_scenario' x='0' y='0' fijo='yes' red='no' red10='no' ejes='no' text='no' ancho='"+this.width+"' alto='"+this.height+"'");this.scenarioRegion.container.appendChild(this.scenarioRegion.scenarioSpace.container);this.arquimedes&&(this.container.appendChild(this.scenarioRegion.container),this.spaces.push(this.scenarioRegion.scenarioSpace));l=0;for(m=b.length;l<m;l++)a=c.parseSpace(b[l]),this.arquimedes&&this.scenarioRegion.container.appendChild(a.container),
this.spaces.push(a),this.zIndex++;l=0;for(m=h.length;l<m;l++)if(b=c.parseGraphic(h[l]))b.visible&&(this.editableRegionVisible=!0),b.space.addGraph(b);l=0;for(m=i.length;l<m;l++)(b=c.parse3DGraphic(i[l]))&&b.space.addGraph(b);l=0;for(m=e.length;l<m;l++)this.controls.push(c.parseControl(e[l]));l=0;for(m=f.length;l<m;l++)c.parseAuxiliar(f[l]);l=0;for(m=j.length;l<m;l++)this.animation=c.parseAnimation(j[l]);this.configRegions();this.updateAuxiliaries();l=0;for(m=this.controls.length;l<m;l++)this.controls[l].init();
this.updateControls();this.updateSpaces(!0);var q=this;this.numberOfIframes?setTimeout(function(){q.finishInit()},250*this.numberOfIframes):this.finishInit()};a.DescartesApp.prototype.finishInit=function(){this.update();this.loader.style.display="none";this.parentContainer.style="overflow: hidden;";clearTimeout(this.timer);this.enable&&(this.blocker=document.createElement("div"),this.blocker.setAttribute("class","blocker"),this.blocker.setAttribute("style","width: "+this.width+"px; height: "+this.height+
"px"),this.container.appendChild(this.blocker))};a.DescartesApp.prototype.configRegions=function(){var d=this.evaluator.parser,c=this.buttonsConfig,b=this.container,e=0,f=0,h=0,i=h=0,j=0,k=0,l=0,m=0,k=this.northSpace.controls,o=this.southSpace.controls,q=this.eastSpace.controls,p=this.westSpace.controls;if(0<c.rowsNorth||0<k.length||c.about||c.config){0>=c.rowsNorth?(e=c.height,c.rowsNorth=1):e=c.height*c.rowsNorth;var r=this.northSpace.container;r.setAttribute("id","descartesJS_northRegion");r.setAttribute("style",
"width: "+b.width+"; height: "+e+"px; background: #c0c0c0; position: absolute; left: 0px; top: 0px; z-index: 100;");b.insertBefore(r,this.loader);var j=b.width,n=0;c.about&&(n=100,j-=n);c.config&&(j-=100);for(var r=Math.ceil(k.length/c.rowsNorth),t=j/r,h=0,v=k.length;h<v;h++)k[h].expresion=d.parse("("+(n+t*(h%r))+","+c.height*Math.floor(h/r)+","+t+","+c.height+")"),k[h].drawif=d.parse("1");if(c.about){var u;"espa\u00f1ol"==this.language?u="cr\u00e9ditos":"english"==this.language&&(u="about");new a.Button(this,
{region:"north",name:u,font_size:d.parse("15"),expresion:d.parse("(0, 0, 100, "+e+")")})}c.config&&("espa\u00f1ol"==this.language?u="config":"english"==this.language&&(u="config"),new a.Button(this,{region:"north",name:u,font_size:d.parse("15"),action:"config",expresion:d.parse("("+(j+100)+", 0, 100, "+e+")")}))}if(0<c.rowsSouth||0<o.length||c.init||c.clear){0>=c.rowsSouth?(f=c.height,c.rowsSouth=1):f=c.height*c.rowsSouth;k=b.width;n=0;c.init&&(n=100,k-=n);c.clear&&(k-=100);r=this.southSpace.container;
r.setAttribute("id","descartesJS_southRegion");r.setAttribute("style","width: "+b.width+"; height: "+f+"px; background: #c0c0c0; position: absolute; left: 0px; top: "+(b.height-f)+"px; z-index: 100;");b.insertBefore(r,this.loader);r=Math.ceil(o.length/c.rowsSouth);t=k/r;h=0;for(v=o.length;h<v;h++)o[h].expresion=d.parse("("+(n+t*(h%r))+","+c.height*Math.floor(h/r)+","+t+","+c.height+")"),o[h].drawif=d.parse("1");c.init&&("espa\u00f1ol"==this.language?u="inicio":"english"==this.language&&(u="init"),
new a.Button(this,{region:"south",name:u,font_size:d.parse("15"),action:"init",expresion:d.parse("(0, 0, 100, "+f+")")}));c.clear&&("espa\u00f1ol"==this.language?u="limpiar":"english"==this.language&&(u="clear"),new a.Button(this,{region:"south",name:u,font_size:d.parse("15"),action:"clear",expresion:d.parse("("+(k+100)+", 0, 100, "+f+")")}))}if(0<q.length){h=b.height-e-f;l=c.widthEast;r=this.eastSpace.container;r.setAttribute("id","descartesJS_eastRegion");r.setAttribute("style","width: "+l+"; height: "+
h+"px; background: #c0c0c0; position: absolute; left: "+(b.width-l)+"px; top: "+e+"px; z-index: 100;");b.insertBefore(r,this.loader);h=0;for(v=q.length;h<v;h++)q[h].expresion=d.parse("(0,"+c.height*h+","+l+","+c.height+")"),q[h].drawif=d.parse("1")}if(0<p.length){h=b.height-e-f;m=c.widthWest;r=this.westSpace.container;r.setAttribute("id","descartesJS_westRegion");r.setAttribute("style","width: "+m+"; height: "+h+"px; background: #c0c0c0; position: absolute; left: 0px; top: "+e+"px; z-index: 100;");
b.insertBefore(r,this.loader);h=0;for(v=p.length;h<v;h++)p[h].expresion=d.parse("(0,"+c.height*h+","+m+","+c.height+")"),p[h].drawif=d.parse("1")}if(this.editableRegionVisible){i=c.height;r=this.editableRegion.container;r.setAttribute("id","descartesJS_editableRegion");r.setAttribute("style","width: "+b.width+"px; height: "+i+"px; position: absolute; left: 0px; top: "+(b.height-f-c.height)+"px; z-index: 100; background: #c0c0c0; overflow: hidden;");b.insertBefore(r,this.loader);d=this.editableRegion.textFields;
c=b.width/d.length;h=0;for(v=d.length;h<v;h++)"div"==d[h].type?(r.appendChild(d[h].container),d[h].container.setAttribute("style","font-family: Arial; width: "+(c-4)+"px; height: "+(i-5)+"px; position: absolute; left: "+h*c+"px; top: 0px; border: 2px groove white;"),p=d[h].container.firstChild,u=p.offsetWidth,p.setAttribute("style","font-family: Arial; padding-top: 0%; background-color: lightgray; position: absolute; left: 0px; top: 0px; width: "+u+"px;"),p.firstChild.textContent=p.firstChild.textContent.substring(1,
p.firstChild.textContent.length-1),d[h].container.lastChild.setAttribute("style","font-family: 'Courier New'; width: "+(c-u-8)+"px; height: "+(i-9)+"px; position: absolute; left: "+u+"px; top: 0px; border: 2px groove white;")):(r.appendChild(d[h]),d[h].setAttribute("style","font-family: 'Courier New'; width: "+c+"px; height: "+i+"px; position: absolute; left: "+h*c+"px; top: 0px; border: 2px groove white;"))}this.displaceRegionNorth=e;this.displaceRegionWest=m;b.width-=l;b.height=b.height-f-i;h=0;
for(v=this.spaces.length;h<v;h++)this.spaces[h].init("joel")};a.DescartesApp.prototype.update=function(){this.updateAuxiliaries();this.updateEvents();this.updateControls();this.updateSpaces()};a.DescartesApp.prototype.deactivateGraphiControls=function(){for(var a,c=0,b=this.controls.length;c<b;c++)a=this.controls[c],"graphic"==a.type&&a.deactivate()};a.DescartesApp.prototype.updateAuxiliaries=function(){for(var a=0,c=this.auxiliaries.length;a<c;a++)this.auxiliaries[a].update()};a.DescartesApp.prototype.updateEvents=
function(){for(var a=0,c=this.events.length;a<c;a++)this.events[a].update()};a.DescartesApp.prototype.updateControls=function(){for(var a=0,c=this.controls.length;a<c;a++)this.controls[a].update()};a.DescartesApp.prototype.updateSpaces=function(a){for(var c=0,b=this.spaces.length;c<b;c++)this.spaces[c].update(a)};a.DescartesApp.prototype.clear=function(){for(var a=0,c=this.spaces.length;a<c;a++)this.spaces[a].spaceChange=!0,this.spaces[a].drawBackground()};a.DescartesApp.prototype.play=function(){this.animation&&
this.animation.play()};a.DescartesApp.prototype.stop=function(){this.animation&&this.animation.stop()};a.DescartesApp.prototype.reinitAnimation=function(){this.animation&&this.animation.reinit()};a.DescartesApp.prototype.getControlById=function(a){for(var c,b=0,e=this.controls.length;b<e;b++)if(c=this.controls[b],c.id==a)return c;return{update:function(){}}};a.DescartesApp.prototype.getSpaceByCId=function(a){for(var c,b=0,e=this.spaces.length;b<e;b++)if(c=this.spaces[b],c.cID==a)return c;return{update:function(){},
w:0}};a.DescartesApp.prototype.getControlByCId=function(a){for(var c,b=0,e=this.controls.length;b<e;b++)if(c=this.controls[b],c.cID==a)return c;return{update:function(){},w:0}};a.DescartesApp.prototype.getState=function(){var a=this.evaluator.variables,c,b="",e;for(e in a)a.hasOwnProperty(e)&&(c=a[e],"string"==typeof c&&(c="'"+c+"'"),"rnd"!=e&&"pi"!=e&&"e"!=e&&"Infinity"!=e&&"-Infinity"!=e&&"object"!=typeof c&&(b=""!=b?b+"\n"+e+"="+c:e+"="+c));return b};a.DescartesApp.prototype.setState=function(a){for(var a=
a.split("\\n"),c,b=0,e=a.length;b<e;b++)c=this.evaluator.parser.parse(a[b],!0),this.evaluator.evalExpression(c),this.saveState.push(c)};a.DescartesApp.prototype.getEvaluation=function(){for(var a=0,c=0,b="",e=0,f=this.controls.length;e<f;e++)"textfield"==this.controls[e].gui&&this.controls[e].evaluate&&(a++,c+=this.controls[e].ok,this.controls[e].value=""==this.controls[e].value?"''":this.controls[e].value,b+=" \\n "+this.controls[e].id+"="+this.controls[e].value+"|"+this.controls[e].ok);return"questions="+
a+" \\n correct="+c+" \\n wrong="+(a-c)+b};a.DescartesApp.prototype.showSolution=function(){for(var a=0,c=this.controls.length;a<c;a++)"textfield"==this.controls[a].gui&&this.controls[a].evaluate&&this.controls[a].changeValue(this.controls[a].getFirstAnswer());this.update()};a.DescartesApp.prototype.showAnswer=function(){for(var a=0,c=this.saveState.length;a<c;a++)this.evaluator.evalExpression(this.saveState[a]);this.update()};return a}(descartesJS||{}),descartesJS=function(a){function e(){var a=
document.getElementById("StyleDescartesApps");a&&a.parentNode.removeChild(a);a=document.createElement("style");a.id="StyleDescartesApps";a.type="text/css";a.setAttribute("rel","stylesheet");a.innerHTML="applet.DescartesJS {display:none;} applet {display:none;}";document.head.appendChild(a)}function d(){for(var b=0,d=a.apps.length;b<d;b++)for(var c=0,e=a.apps[b].spaces.length;c<e;c++)a.apps[b].spaces[c].findOffset()}function c(){a.getFeatures();if(a.hasCanvasSupport){for(var b=document.getElementsByTagName("*"),
c=[],e=0,h=b.length;e<h;e++)"DescartesAppContainer"==b[e].className&&c.push(b[e]);e=0;for(h=c.length;e<h;e++)c[e].parentNode.removeChild(c[e]);for(var c=document.getElementsByTagName("applet"),b=[],h=0,i=c.length;h<i;h++)e=c[h],(e.getAttribute("code").match("DescartesJS")||e.getAttribute("code").match("Descartes.class"))&&b.push(e);e=0;for(h=b.length;e<h;e++)c=b[e],a.apps.push(new a.DescartesApp(c)),c.className="DescartesJS";document.getElementById("StyleDescartesApps").innerHTML="applet.DescartesJS {display:none;}";
window.addEventListener("resize",d,!1)}else document.getElementById("StyleDescartesApps").innerHTML="applet {display:block;}"}a.apps=[];a.getDescartesApps=function(){return a.apps};(!window.hasOwnProperty("debugDescartesJS")||!debugDescartesJS)&&e();a.receiveMessage=function(b){if(0!==a.apps.length)if((b=b.data)&&"set"===b.type)a.apps[0].evaluator.setVariable(b.name,b.value);else if(b&&"update"===b.type)a.apps[0].update();else if(b&&"exec"===b.type){var c=a.apps[0].evaluator.getFunction(b.name),d=
[];""!==b.value&&(d=b.value.toString().split(","));c&&c.apply(a.evaluator,d)}};void 0===a.loadLib&&(a.loadLib=!0,window.addEventListener("load",c,!1),window.addEventListener("message",a.receiveMessage,!1));return a}(descartesJS||{});
